{"file_contents":{"index.php":{"content":"<?php\n// Redirect to user dashboard or login page\nheader('Location: user/index.php');\nexit;\n?>","size_bytes":94},"replit.md":{"content":"# eSports Tournament Management System\n\n## Project Overview\nA comprehensive eSports tournament management system built with PHP/MySQL. The platform manages tournament registrations, match scheduling, screenshot uploads, result management, and final tournament winner selection.\n\n## Project Architecture\n\n### Key Components\n- **User System**: Registration, authentication, wallet management\n- **Tournament Management**: Creation, registration, match generation\n- **Match System**: Individual match results, screenshot uploads\n- **Admin Panel**: Tournament oversight, result verification, final winner selection\n- **Payment System**: Entry fees, prize distribution\n\n### Database Structure\n- `tournaments` - Tournament information and settings\n- `matches` - Individual match data\n- `match_screenshots` - User-uploaded match evidence\n- `tournament_registrations` - User tournament signups\n- `users` - Player accounts and profiles\n\n## Current Implementation Status\n\n### Match Flow\n1. **User Match View**: Users can view their matches in `user/matches.php`\n2. **Screenshot Upload**: Users upload match evidence via upload form\n3. **Admin Review**: Admins review screenshots in `admin/results.php` \n4. **Match Winner**: Admin selects individual match winner (not tournament winner)\n5. **Tournament Winners**: Final tournament positions selected in `admin/tournament_results.php`\n\n### Key Distinction\n- **Match Winners**: Individual game results (determined per match)\n- **Tournament Winners**: Overall tournament rankings (Champion, Runner-up, 3rd Place)\n\n## Recent Changes (2025-08-20)\n\n### Fixed Issues\n✓ Tournament thumbnail display - Fixed SQL GROUP BY clause missing thumbnail field\n✓ Screenshot viewing - Added screenshot display in admin results page with modal viewer\n✓ Clarified match vs tournament winners - Added explanatory text in admin interface\n✓ Enhanced admin screenshot review - Screenshots now visible when reviewing match results\n\n### Enhanced Features\n✓ Admin can now view uploaded screenshots before deciding match winners\n✓ Clear separation between individual match results and overall tournament winners\n✓ Modal popup for detailed screenshot viewing\n✓ Added upload timestamps for screenshot evidence\n\n## User Preferences\n- User prefers clear explanations of tournament vs match winner distinctions\n- Values comprehensive tournament management functionality\n- Needs admin tools for reviewing user-submitted evidence\n\n## Technical Notes\n- Uses PHP with PDO for database connections\n- Bootstrap 5 for responsive UI\n- Font Awesome icons for enhanced UX\n- File uploads handled with validation and security checks","size_bytes":2640},"admin/dashboard.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n// Get dashboard statistics\ntry {\n    // Total users\n    $stmt = $pdo->query(\"SELECT COUNT(*) as total FROM users WHERE status = 'active'\");\n    $totalUsers = $stmt->fetch()['total'];\n    \n    // Total tournaments\n    $stmt = $pdo->query(\"SELECT COUNT(*) as total FROM tournaments\");\n    $totalTournaments = $stmt->fetch()['total'];\n    \n    // Active tournaments\n    $stmt = $pdo->query(\"SELECT COUNT(*) as total FROM tournaments WHERE status = 'active'\");\n    $activeTournaments = $stmt->fetch()['total'];\n    \n    // Total prize pool\n    $stmt = $pdo->query(\"SELECT SUM(prize_pool) as total FROM tournaments WHERE status IN ('active', 'upcoming')\");\n    $totalPrizePool = $stmt->fetch()['total'] ?? 0;\n    \n    // Recent registrations\n    $stmt = $pdo->query(\"\n        SELECT tr.*, u.username, t.name as tournament_name \n        FROM tournament_registrations tr\n        JOIN users u ON tr.user_id = u.id\n        JOIN tournaments t ON tr.tournament_id = t.id\n        ORDER BY tr.created_at DESC \n        LIMIT 10\n    \");\n    $recentRegistrations = $stmt->fetchAll();\n    \n    // Pending payments\n    $stmt = $pdo->query(\"\n        SELECT COUNT(*) as total \n        FROM payments \n        WHERE status = 'pending'\n    \");\n    $pendingPayments = $stmt->fetch()['total'];\n    \n} catch (PDOException $e) {\n    $totalUsers = $totalTournaments = $activeTournaments = $totalPrizePool = $pendingPayments = 0;\n    $recentRegistrations = [];\n}\n\n$flash = getFlashMessage();\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Admin Dashboard - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <div class=\"col-lg-10 main-content\">\n                <div class=\"d-flex justify-content-between align-items-center mb-4\">\n                    <h2 class=\"text-light\">\n                        <i class=\"fas fa-tachometer-alt text-accent\"></i> Dashboard\n                    </h2>\n                    <div class=\"text-light-50\">\n                        Welcome, <?= htmlspecialchars($_SESSION['admin_username']) ?>\n                    </div>\n                </div>\n                \n                <?php if ($flash): ?>\n                    <div class=\"alert alert-<?= $flash['type'] === 'success' ? 'success' : 'danger' ?>\">\n                        <?= htmlspecialchars($flash['message']) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <!-- Statistics Cards -->\n                <div class=\"row mb-4\">\n                    <div class=\"col-lg-3 col-md-6 mb-3\">\n                        <div class=\"gaming-card stat-card\">\n                            <div class=\"d-flex justify-content-between align-items-center\">\n                                <div>\n                                    <h3 class=\"text-accent mb-0\"><?= number_format($totalUsers) ?></h3>\n                                    <p class=\"text-light-50 mb-0\">Total Users</p>\n                                </div>\n                                <i class=\"fas fa-users fa-2x text-accent\"></i>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-lg-3 col-md-6 mb-3\">\n                        <div class=\"gaming-card stat-card\">\n                            <div class=\"d-flex justify-content-between align-items-center\">\n                                <div>\n                                    <h3 class=\"text-accent mb-0\"><?= number_format($totalTournaments) ?></h3>\n                                    <p class=\"text-light-50 mb-0\">Total Tournaments</p>\n                                </div>\n                                <i class=\"fas fa-trophy fa-2x text-accent\"></i>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-lg-3 col-md-6 mb-3\">\n                        <div class=\"gaming-card stat-card\">\n                            <div class=\"d-flex justify-content-between align-items-center\">\n                                <div>\n                                    <h3 class=\"text-success mb-0\"><?= number_format($activeTournaments) ?></h3>\n                                    <p class=\"text-light-50 mb-0\">Active Tournaments</p>\n                                </div>\n                                <i class=\"fas fa-play-circle fa-2x text-success\"></i>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-lg-3 col-md-6 mb-3\">\n                        <div class=\"gaming-card stat-card\">\n                            <div class=\"d-flex justify-content-between align-items-center\">\n                                <div>\n                                    <h3 class=\"text-warning mb-0\"><?= formatTaka($totalPrizePool) ?></h3>\n                                    <p class=\"text-light-50 mb-0\">Total Prize Pool</p>\n                                </div>\n                                <i class=\"fas fa-coins fa-2x text-warning\"></i>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"row\">\n                    <!-- Recent Registrations -->\n                    <div class=\"col-lg-8 mb-4\">\n                        <div class=\"gaming-card\">\n                            <div class=\"d-flex justify-content-between align-items-center mb-3\">\n                                <h4 class=\"text-accent mb-0\">\n                                    <i class=\"fas fa-user-plus\"></i> Recent Registrations\n                                </h4>\n                                <a href=\"tournaments.php\" class=\"btn btn-sm btn-outline-accent\">\n                                    View All\n                                </a>\n                            </div>\n                            \n                            <?php if (empty($recentRegistrations)): ?>\n                                <div class=\"text-center text-light-50 py-4\">\n                                    <i class=\"fas fa-inbox fa-3x mb-3\"></i>\n                                    <p>No recent registrations</p>\n                                </div>\n                            <?php else: ?>\n                                <div class=\"table-responsive\">\n                                    <table class=\"table table-dark table-hover\">\n                                        <thead>\n                                            <tr>\n                                                <th>User</th>\n                                                <th>Tournament</th>\n                                                <th>Status</th>\n                                                <th>Date</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            <?php foreach ($recentRegistrations as $reg): ?>\n                                                <tr>\n                                                    <td><?= htmlspecialchars($reg['username']) ?></td>\n                                                    <td><?= htmlspecialchars($reg['tournament_name']) ?></td>\n                                                    <td>\n                                                        <span class=\"badge bg-<?= $reg['status'] === 'approved' ? 'success' : ($reg['status'] === 'pending' ? 'warning' : 'danger') ?>\">\n                                                            <?= ucfirst($reg['status']) ?>\n                                                        </span>\n                                                    </td>\n                                                    <td><?= timeAgo($reg['created_at']) ?></td>\n                                                </tr>\n                                            <?php endforeach; ?>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            <?php endif; ?>\n                        </div>\n                    </div>\n                    \n                    <!-- Quick Actions -->\n                    <div class=\"col-lg-4 mb-4\">\n                        <div class=\"gaming-card\">\n                            <h4 class=\"text-accent mb-3\">\n                                <i class=\"fas fa-bolt\"></i> Quick Actions\n                            </h4>\n                            \n                            <div class=\"d-grid gap-2\">\n                                <a href=\"tournaments.php?action=create\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-plus\"></i> Create Tournament\n                                </a>\n                                <a href=\"payments.php\" class=\"btn btn-warning\">\n                                    <i class=\"fas fa-credit-card\"></i> Review Payments\n                                    <?php if ($pendingPayments > 0): ?>\n                                        <span class=\"badge bg-danger\"><?= $pendingPayments ?></span>\n                                    <?php endif; ?>\n                                </a>\n                                <a href=\"users.php\" class=\"btn btn-info\">\n                                    <i class=\"fas fa-users\"></i> Manage Users\n                                </a>\n                                <a href=\"matches.php\" class=\"btn btn-success\">\n                                    <i class=\"fas fa-gamepad\"></i> Manage Matches\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>\n\n<?php\n// Create includes directory and files if they don't exist\n$includesDir = __DIR__ . '/includes';\nif (!is_dir($includesDir)) {\n    mkdir($includesDir, 0755, true);\n}\n\n// Create navbar.php\n$navbarContent = '<?php\n// Admin Navigation Bar\n?>\n<nav class=\"navbar navbar-expand-lg navbar-dark bg-primary fixed-top\">\n    <div class=\"container-fluid\">\n        <a class=\"navbar-brand fw-bold\" href=\"dashboard.php\">\n            <i class=\"fas fa-shield-alt text-accent\"></i> eSports Admin\n        </a>\n        \n        <div class=\"ms-auto\">\n            <div class=\"dropdown\">\n                <button class=\"btn btn-outline-light dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\">\n                    <i class=\"fas fa-user\"></i> <?= htmlspecialchars($_SESSION[\\'admin_username\\']) ?>\n                </button>\n                <ul class=\"dropdown-menu dropdown-menu-dark\">\n                    <li><a class=\"dropdown-item\" href=\"../index.php\"><i class=\"fas fa-home\"></i> View Site</a></li>\n                    <li><hr class=\"dropdown-divider\"></li>\n                    <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</nav>';\n\nfile_put_contents($includesDir . '/navbar.php', $navbarContent);\n\n// Create sidebar.php\n$sidebarContent = '<?php\n// Admin Sidebar\n?>\n<div class=\"col-lg-2 sidebar bg-secondary p-0\">\n    <div class=\"sidebar-content\">\n        <ul class=\"nav flex-column\">\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER[\\'PHP_SELF\\']) === \\'dashboard.php\\' ? \\'active\\' : \\'\\' ?>\" \n                   href=\"dashboard.php\">\n                    <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER[\\'PHP_SELF\\']) === \\'tournaments.php\\' ? \\'active\\' : \\'\\' ?>\" \n                   href=\"tournaments.php\">\n                    <i class=\"fas fa-trophy\"></i> Tournaments\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER[\\'PHP_SELF\\']) === \\'matches.php\\' ? \\'active\\' : \\'\\' ?>\" \n                   href=\"matches.php\">\n                    <i class=\"fas fa-gamepad\"></i> Matches\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER[\\'PHP_SELF\\']) === \\'payments.php\\' ? \\'active\\' : \\'\\' ?>\" \n                   href=\"payments.php\">\n                    <i class=\"fas fa-credit-card\"></i> Payments\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER[\\'PHP_SELF\\']) === \\'users.php\\' ? \\'active\\' : \\'\\' ?>\" \n                   href=\"users.php\">\n                    <i class=\"fas fa-users\"></i> Users\n                </a>\n            </li>\n        </ul>\n    </div>\n</div>';\n\nfile_put_contents($includesDir . '/sidebar.php', $sidebarContent);\n?>\n","size_bytes":13767},"admin/index.php":{"content":"<?php\nrequire_once '../config/config.php';\nredirect('dashboard.php');\n?>\n","size_bytes":73},"admin/login.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\n\n// Redirect if already logged in\nif (isAdminLoggedIn()) {\n    redirect('dashboard.php');\n}\n\n$error = '';\n$success = '';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $username = sanitizeInput($_POST['username'] ?? '');\n        $password = $_POST['password'] ?? '';\n        \n        if (empty($username) || empty($password)) {\n            $error = 'All fields are required';\n        } else {\n            $auth = new Auth($pdo);\n            $result = $auth->loginAdmin($username, $password);\n            \n            if ($result['success']) {\n                redirect('dashboard.php', $result['message'], 'success');\n            } else {\n                $error = $result['message'];\n            }\n        }\n    }\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Admin Login - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body class=\"auth-page\">\n    <div class=\"container-fluid h-100\">\n        <div class=\"row h-100\">\n            <div class=\"col-lg-6 d-none d-lg-flex align-items-center justify-content-center bg-primary\">\n                <div class=\"text-center text-light\">\n                    <i class=\"fas fa-shield-alt display-1 text-accent mb-4\"></i>\n                    <h2 class=\"mb-3\">Admin Portal</h2>\n                    <p class=\"lead\">Manage tournaments, users, and payments</p>\n                </div>\n            </div>\n            <div class=\"col-lg-6 d-flex align-items-center justify-content-center\">\n                <div class=\"w-100\" style=\"max-width: 400px;\">\n                    <div class=\"gaming-card\">\n                        <div class=\"text-center mb-4\">\n                            <h3 class=\"text-accent\">\n                                <i class=\"fas fa-cog\"></i> Admin Login\n                            </h3>\n                        </div>\n                        \n                        <?php if ($error): ?>\n                            <div class=\"alert alert-danger\">\n                                <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                            </div>\n                        <?php endif; ?>\n                        \n                        <?php if ($success): ?>\n                            <div class=\"alert alert-success\">\n                                <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                            </div>\n                        <?php endif; ?>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"username\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-user\"></i> Username\n                                </label>\n                                <input type=\"text\" class=\"form-control gaming-input\" id=\"username\" \n                                       name=\"username\" required>\n                            </div>\n                            \n                            <div class=\"mb-4\">\n                                <label for=\"password\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-lock\"></i> Password\n                                </label>\n                                <input type=\"password\" class=\"form-control gaming-input\" id=\"password\" \n                                       name=\"password\" required>\n                            </div>\n                            \n                            <button type=\"submit\" class=\"btn btn-accent w-100 mb-3\">\n                                <i class=\"fas fa-sign-in-alt\"></i> Login as Admin\n                            </button>\n                        </form>\n                        \n                        <div class=\"text-center\">\n                            <a href=\"../index.php\" class=\"text-light-50\">\n                                <i class=\"fas fa-arrow-left\"></i> Back to Home\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n","size_bytes":5178},"admin/logout.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\n\n$auth = new Auth($pdo);\n$result = $auth->logout();\n\nredirect('../index.php', $result['message'], 'success');\n?>\n","size_bytes":193},"admin/matches.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$action = $_GET['action'] ?? 'list';\n$matchId = $_GET['id'] ?? null;\n$tournamentId = $_GET['tournament_id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle form submissions\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        switch ($action) {\n            case 'create':\n                $tournament = (int)($_POST['tournament_id'] ?? 0);\n                $team1 = (int)($_POST['team1_id'] ?? 0);\n                $team2 = (int)($_POST['team2_id'] ?? 0);\n                $scheduledDate = $_POST['scheduled_date'] ?? '';\n                $round = sanitizeInput($_POST['round'] ?? '');\n                \n                if ($tournament && $team1 && $team2 && $team1 !== $team2) {\n                    try {\n                        $stmt = $pdo->prepare(\"\n                            INSERT INTO matches (tournament_id, team1_id, team2_id, scheduled_date, round, status, created_at)\n                            VALUES (?, ?, ?, ?, ?, 'scheduled', CURRENT_TIMESTAMP)\n                        \");\n                        $stmt->execute([$tournament, $team1, $team2, $scheduledDate, $round]);\n                        $success = 'Match created successfully';\n                        $action = 'list';\n                    } catch (PDOException $e) {\n                        $error = 'Database error: ' . $e->getMessage();\n                    }\n                } else {\n                    $error = 'Please fill all required fields and select different teams';\n                }\n                break;\n                \n            case 'update_result':\n                $winnerId = (int)($_POST['winner_id'] ?? 0);\n                $score1 = (int)($_POST['score1'] ?? 0);\n                $score2 = (int)($_POST['score2'] ?? 0);\n                $notes = sanitizeInput($_POST['notes'] ?? '');\n                \n                if ($matchId && $winnerId) {\n                    try {\n                        $stmt = $pdo->prepare(\"\n                            UPDATE matches \n                            SET winner_id = ?, score1 = ?, score2 = ?, notes = ?, status = 'completed', completed_at = CURRENT_TIMESTAMP\n                            WHERE id = ?\n                        \");\n                        $stmt->execute([$winnerId, $score1, $score2, $notes, $matchId]);\n                        $success = 'Match result updated successfully';\n                        $action = 'list';\n                    } catch (PDOException $e) {\n                        $error = 'Database error: ' . $e->getMessage();\n                    }\n                } else {\n                    $error = 'Please select a winner';\n                }\n                break;\n        }\n    }\n}\n\n// Get matches based on action\nif ($action === 'list') {\n    $whereClause = '';\n    $params = [];\n    \n    if ($tournamentId) {\n        $whereClause = 'WHERE m.tournament_id = ?';\n        $params[] = $tournamentId;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name,\n               u1.username as team1_name, u2.username as team2_name,\n               uw.username as winner_name\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        LEFT JOIN users uw ON m.winner_id = uw.id\n        $whereClause\n        ORDER BY m.scheduled_date DESC, m.created_at DESC\n    \");\n    $stmt->execute($params);\n    $matches = $stmt->fetchAll();\n}\n\n// Get tournament options for create form\nif ($action === 'create') {\n    $stmt = $pdo->query(\"SELECT id, name FROM tournaments WHERE status IN ('active', 'upcoming') ORDER BY name\");\n    $tournaments = $stmt->fetchAll();\n}\n\n// Get match details for result update\nif ($action === 'result' && $matchId) {\n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name,\n               u1.username as team1_name, u2.username as team2_name\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        WHERE m.id = ?\n    \");\n    $stmt->execute([$matchId]);\n    $match = $stmt->fetch();\n    \n    if (!$match) {\n        $error = 'Match not found';\n        $action = 'list';\n    }\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Match Management - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <div class=\"col-lg-10 main-content\">\n                <div class=\"d-flex justify-content-between align-items-center mb-4\">\n                    <h2 class=\"text-light\">\n                        <i class=\"fas fa-gamepad text-accent\"></i> Match Management\n                        <?php if ($tournamentId): ?>\n                            <small class=\"text-light-50\">- Tournament Filter Active</small>\n                        <?php endif; ?>\n                    </h2>\n                    <div>\n                        <?php if ($action === 'list'): ?>\n                            <a href=\"?action=create<?= $tournamentId ? '&tournament_id=' . $tournamentId : '' ?>\" class=\"btn btn-accent\">\n                                <i class=\"fas fa-plus\"></i> Create Match\n                            </a>\n                            <?php if ($tournamentId): ?>\n                                <a href=\"?\" class=\"btn btn-outline-light ms-2\">\n                                    <i class=\"fas fa-times\"></i> Clear Filter\n                                </a>\n                            <?php endif; ?>\n                        <?php else: ?>\n                            <a href=\"?<?= $tournamentId ? 'tournament_id=' . $tournamentId : '' ?>\" class=\"btn btn-outline-light\">\n                                <i class=\"fas fa-arrow-left\"></i> Back to List\n                            </a>\n                        <?php endif; ?>\n                    </div>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($action === 'list'): ?>\n                    <!-- Match List -->\n                    <div class=\"gaming-card\">\n                        <?php if (empty($matches)): ?>\n                            <div class=\"text-center text-light-50 py-5\">\n                                <i class=\"fas fa-gamepad fa-4x mb-3\"></i>\n                                <h4>No Matches Found</h4>\n                                <p>Create your first match to get started</p>\n                                <a href=\"?action=create<?= $tournamentId ? '&tournament_id=' . $tournamentId : '' ?>\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-plus\"></i> Create Match\n                                </a>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-dark table-hover\">\n                                    <thead>\n                                        <tr>\n                                            <th>Tournament</th>\n                                            <th>Teams</th>\n                                            <th>Scheduled</th>\n                                            <th>Round</th>\n                                            <th>Status</th>\n                                            <th>Result</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($matches as $match): ?>\n                                            <tr>\n                                                <td><?= htmlspecialchars($match['tournament_name']) ?></td>\n                                                <td>\n                                                    <div class=\"d-flex align-items-center\">\n                                                        <span class=\"badge bg-info me-2\"><?= htmlspecialchars($match['team1_name']) ?></span>\n                                                        <i class=\"fas fa-vs text-accent mx-2\"></i>\n                                                        <span class=\"badge bg-warning\"><?= htmlspecialchars($match['team2_name']) ?></span>\n                                                    </div>\n                                                </td>\n                                                <td><?= formatDate($match['scheduled_date']) ?></td>\n                                                <td><?= htmlspecialchars($match['round']) ?></td>\n                                                <td>\n                                                    <span class=\"badge bg-<?= $match['status'] === 'completed' ? 'success' : ($match['status'] === 'live' ? 'danger' : 'info') ?>\">\n                                                        <?= ucfirst($match['status']) ?>\n                                                    </span>\n                                                </td>\n                                                <td>\n                                                    <?php if ($match['status'] === 'completed'): ?>\n                                                        <span class=\"text-success fw-bold\">\n                                                            <?= htmlspecialchars($match['winner_name']) ?> Wins\n                                                        </span>\n                                                        <br><small class=\"text-light-50\"><?= $match['score1'] ?> - <?= $match['score2'] ?></small>\n                                                    <?php else: ?>\n                                                        <span class=\"text-light-50\">Pending</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                                <td>\n                                                    <div class=\"btn-group\" role=\"group\">\n                                                        <?php if ($match['status'] !== 'completed'): ?>\n                                                            <a href=\"?action=result&id=<?= $match['id'] ?>\" class=\"btn btn-sm btn-success\">\n                                                                <i class=\"fas fa-trophy\"></i> Result\n                                                            </a>\n                                                        <?php endif; ?>\n                                                        <a href=\"?action=delete&id=<?= $match['id'] ?>\" \n                                                           class=\"btn btn-sm btn-outline-danger\"\n                                                           onclick=\"return confirm('Are you sure you want to delete this match?')\">\n                                                            <i class=\"fas fa-trash\"></i>\n                                                        </a>\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                    \n                <?php elseif ($action === 'create'): ?>\n                    <!-- Create Match Form -->\n                    <div class=\"gaming-card\">\n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"tournament_id\" class=\"form-label text-light\">Tournament *</label>\n                                    <select class=\"form-control gaming-input\" id=\"tournament_id\" name=\"tournament_id\" required onchange=\"loadTeams(this.value)\">\n                                        <option value=\"\">Select Tournament</option>\n                                        <?php foreach ($tournaments as $tournament): ?>\n                                            <option value=\"<?= $tournament['id'] ?>\" \n                                                    <?= $tournamentId == $tournament['id'] ? 'selected' : '' ?>>\n                                                <?= htmlspecialchars($tournament['name']) ?>\n                                            </option>\n                                        <?php endforeach; ?>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"round\" class=\"form-label text-light\">Round</label>\n                                    <input type=\"text\" class=\"form-control gaming-input\" id=\"round\" name=\"round\" \n                                           placeholder=\"e.g., Quarter Final, Semi Final\">\n                                </div>\n                            </div>\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"team1_id\" class=\"form-label text-light\">Team 1 *</label>\n                                    <select class=\"form-control gaming-input\" id=\"team1_id\" name=\"team1_id\" required>\n                                        <option value=\"\">Select Team 1</option>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"team2_id\" class=\"form-label text-light\">Team 2 *</label>\n                                    <select class=\"form-control gaming-input\" id=\"team2_id\" name=\"team2_id\" required>\n                                        <option value=\"\">Select Team 2</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"scheduled_date\" class=\"form-label text-light\">Scheduled Date</label>\n                                <input type=\"datetime-local\" class=\"form-control gaming-input\" id=\"scheduled_date\" name=\"scheduled_date\">\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-save\"></i> Create Match\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                    \n                <?php elseif ($action === 'result' && isset($match)): ?>\n                    <!-- Update Result Form -->\n                    <div class=\"gaming-card\">\n                        <div class=\"row mb-4\">\n                            <div class=\"col-md-12\">\n                                <h4 class=\"text-accent\">Update Match Result</h4>\n                                <p class=\"text-light-50\">\n                                    <?= htmlspecialchars($match['tournament_name']) ?> - <?= htmlspecialchars($match['round']) ?>\n                                </p>\n                                <div class=\"d-flex align-items-center justify-content-center mb-3\">\n                                    <span class=\"badge bg-info fs-6 me-3\"><?= htmlspecialchars($match['team1_name']) ?></span>\n                                    <i class=\"fas fa-vs text-accent fa-2x mx-3\"></i>\n                                    <span class=\"badge bg-warning fs-6 ms-3\"><?= htmlspecialchars($match['team2_name']) ?></span>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"winner_id\" class=\"form-label text-light\">Winner *</label>\n                                    <select class=\"form-control gaming-input\" id=\"winner_id\" name=\"winner_id\" required>\n                                        <option value=\"\">Select Winner</option>\n                                        <option value=\"<?= $match['team1_id'] ?>\"><?= htmlspecialchars($match['team1_name']) ?></option>\n                                        <option value=\"<?= $match['team2_id'] ?>\"><?= htmlspecialchars($match['team2_name']) ?></option>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"score1\" class=\"form-label text-light\"><?= htmlspecialchars($match['team1_name']) ?> Score</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"score1\" name=\"score1\" min=\"0\">\n                                </div>\n                                \n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"score2\" class=\"form-label text-light\"><?= htmlspecialchars($match['team2_name']) ?> Score</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"score2\" name=\"score2\" min=\"0\">\n                                </div>\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"notes\" class=\"form-label text-light\">Match Notes</label>\n                                <textarea class=\"form-control gaming-input\" id=\"notes\" name=\"notes\" rows=\"3\" \n                                          placeholder=\"Any additional notes about the match result...\"></textarea>\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-success\">\n                                    <i class=\"fas fa-trophy\"></i> Update Result\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n    <script>\n        function loadTeams(tournamentId) {\n            if (!tournamentId) {\n                document.getElementById('team1_id').innerHTML = '<option value=\"\">Select Team 1</option>';\n                document.getElementById('team2_id').innerHTML = '<option value=\"\">Select Team 2</option>';\n                return;\n            }\n            \n            fetch(`../api/get_teams.php?tournament_id=${tournamentId}`)\n                .then(response => response.json())\n                .then(data => {\n                    const team1Select = document.getElementById('team1_id');\n                    const team2Select = document.getElementById('team2_id');\n                    \n                    team1Select.innerHTML = '<option value=\"\">Select Team 1</option>';\n                    team2Select.innerHTML = '<option value=\"\">Select Team 2</option>';\n                    \n                    data.teams.forEach(team => {\n                        team1Select.innerHTML += `<option value=\"${team.id}\">${team.name}</option>`;\n                        team2Select.innerHTML += `<option value=\"${team.id}\">${team.name}</option>`;\n                    });\n                })\n                .catch(error => console.error('Error loading teams:', error));\n        }\n        \n        // Load teams if tournament is pre-selected\n        document.addEventListener('DOMContentLoaded', function() {\n            const tournamentSelect = document.getElementById('tournament_id');\n            if (tournamentSelect && tournamentSelect.value) {\n                loadTeams(tournamentSelect.value);\n            }\n        });\n    </script>\n</body>\n</html>\n","size_bytes":22142},"admin/payments.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$action = $_GET['action'] ?? 'list';\n$paymentId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle payment approval/rejection\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && ($action === 'approve' || $action === 'reject')) {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $status = $action === 'approve' ? 'completed' : 'failed';\n        $notes = sanitizeInput($_POST['notes'] ?? '');\n        \n        try {\n            $stmt = $pdo->prepare(\"\n                UPDATE payments \n                SET status = ?, admin_notes = ?, processed_at = CURRENT_TIMESTAMP, processed_by = ?\n                WHERE id = ?\n            \");\n            $stmt->execute([$status, $notes, $_SESSION['admin_id'], $paymentId]);\n            \n            if ($action === 'approve') {\n                // Update user registration status\n                $stmt = $pdo->prepare(\"\n                    UPDATE tournament_registrations tr\n                    JOIN payments p ON tr.id = p.registration_id\n                    SET tr.status = 'approved'\n                    WHERE p.id = ?\n                \");\n                $stmt->execute([$paymentId]);\n            }\n            \n            $success = 'Payment ' . $action . 'd successfully';\n            $action = 'list';\n        } catch (PDOException $e) {\n            $error = 'Database error: ' . $e->getMessage();\n        }\n    }\n}\n\n// Get payments list\nif ($action === 'list') {\n    $status = $_GET['status'] ?? '';\n    $whereClause = '';\n    $params = [];\n    \n    if ($status) {\n        $whereClause = 'WHERE p.status = ?';\n        $params[] = $status;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT p.*, u.username, u.email, t.name as tournament_name,\n               tr.team_name, a.username as processed_by_name\n        FROM payments p\n        JOIN tournament_registrations tr ON p.registration_id = tr.id\n        JOIN users u ON tr.user_id = u.id\n        JOIN tournaments t ON tr.tournament_id = t.id\n        LEFT JOIN admins a ON p.processed_by = a.id\n        $whereClause\n        ORDER BY p.created_at DESC\n    \");\n    $stmt->execute($params);\n    $payments = $stmt->fetchAll();\n    \n    // Get status counts\n    $stmt = $pdo->query(\"\n        SELECT status, COUNT(*) as count \n        FROM payments \n        GROUP BY status\n    \");\n    $statusCounts = [];\n    while ($row = $stmt->fetch()) {\n        $statusCounts[$row['status']] = $row['count'];\n    }\n}\n\n// Get payment details for approval\nif (($action === 'approve' || $action === 'reject' || $action === 'view') && $paymentId) {\n    $stmt = $pdo->prepare(\"\n        SELECT p.*, u.username, u.email, u.phone, t.name as tournament_name,\n               tr.team_name, tr.created_at as registration_date\n        FROM payments p\n        JOIN tournament_registrations tr ON p.registration_id = tr.id\n        JOIN users u ON tr.user_id = u.id\n        JOIN tournaments t ON tr.tournament_id = t.id\n        WHERE p.id = ?\n    \");\n    $stmt->execute([$paymentId]);\n    $payment = $stmt->fetch();\n    \n    if (!$payment) {\n        $error = 'Payment not found';\n        $action = 'list';\n    }\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Payment Management - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <div class=\"col-lg-10 main-content\">\n                <div class=\"d-flex justify-content-between align-items-center mb-4\">\n                    <h2 class=\"text-light\">\n                        <i class=\"fas fa-credit-card text-accent\"></i> Payment Management\n                    </h2>\n                    <?php if ($action !== 'list'): ?>\n                        <a href=\"?\" class=\"btn btn-outline-light\">\n                            <i class=\"fas fa-arrow-left\"></i> Back to List\n                        </a>\n                    <?php endif; ?>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($action === 'list'): ?>\n                    <!-- Payment Statistics -->\n                    <div class=\"row mb-4\">\n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= !$_GET['status'] ?? '' ? 'border-accent' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-light mb-0\"><?= array_sum($statusCounts) ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Total Payments</p>\n                                        </div>\n                                        <i class=\"fas fa-credit-card fa-2x text-light\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                        \n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?status=pending\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= ($_GET['status'] ?? '') === 'pending' ? 'border-warning' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-warning mb-0\"><?= $statusCounts['pending'] ?? 0 ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Pending</p>\n                                        </div>\n                                        <i class=\"fas fa-clock fa-2x text-warning\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                        \n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?status=completed\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= ($_GET['status'] ?? '') === 'completed' ? 'border-success' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-success mb-0\"><?= $statusCounts['completed'] ?? 0 ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Completed</p>\n                                        </div>\n                                        <i class=\"fas fa-check-circle fa-2x text-success\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                        \n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?status=failed\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= ($_GET['status'] ?? '') === 'failed' ? 'border-danger' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-danger mb-0\"><?= $statusCounts['failed'] ?? 0 ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Failed</p>\n                                        </div>\n                                        <i class=\"fas fa-times-circle fa-2x text-danger\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                    </div>\n                    \n                    <!-- Payment List -->\n                    <div class=\"gaming-card\">\n                        <?php if (empty($payments)): ?>\n                            <div class=\"text-center text-light-50 py-5\">\n                                <i class=\"fas fa-credit-card fa-4x mb-3\"></i>\n                                <h4>No Payments Found</h4>\n                                <p>No payment records match your criteria</p>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-dark table-hover\">\n                                    <thead>\n                                        <tr>\n                                            <th>Transaction ID</th>\n                                            <th>User</th>\n                                            <th>Tournament</th>\n                                            <th>Amount</th>\n                                            <th>Method</th>\n                                            <th>Status</th>\n                                            <th>Date</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($payments as $payment): ?>\n                                            <tr>\n                                                <td>\n                                                    <code class=\"text-accent\"><?= htmlspecialchars($payment['transaction_id']) ?></code>\n                                                </td>\n                                                <td>\n                                                    <strong><?= htmlspecialchars($payment['username']) ?></strong>\n                                                    <br><small class=\"text-light-50\"><?= htmlspecialchars($payment['email']) ?></small>\n                                                </td>\n                                                <td>\n                                                    <?= htmlspecialchars($payment['tournament_name']) ?>\n                                                    <br><small class=\"text-light-50\">Team: <?= htmlspecialchars($payment['team_name']) ?></small>\n                                                </td>\n                                                <td class=\"fw-bold\"><?= formatTaka($payment['amount']) ?></td>\n                                                <td>\n                                                    <span class=\"badge bg-info\"><?= strtoupper($payment['method']) ?></span>\n                                                </td>\n                                                <td>\n                                                    <span class=\"badge bg-<?= $payment['status'] === 'completed' ? 'success' : ($payment['status'] === 'pending' ? 'warning' : 'danger') ?>\">\n                                                        <?= ucfirst($payment['status']) ?>\n                                                    </span>\n                                                </td>\n                                                <td><?= formatDate($payment['created_at']) ?></td>\n                                                <td>\n                                                    <div class=\"btn-group\" role=\"group\">\n                                                        <a href=\"?action=view&id=<?= $payment['id'] ?>\" class=\"btn btn-sm btn-outline-info\">\n                                                            <i class=\"fas fa-eye\"></i>\n                                                        </a>\n                                                        <?php if ($payment['status'] === 'pending'): ?>\n                                                            <a href=\"?action=approve&id=<?= $payment['id'] ?>\" class=\"btn btn-sm btn-success\">\n                                                                <i class=\"fas fa-check\"></i>\n                                                            </a>\n                                                            <a href=\"?action=reject&id=<?= $payment['id'] ?>\" class=\"btn btn-sm btn-danger\">\n                                                                <i class=\"fas fa-times\"></i>\n                                                            </a>\n                                                        <?php endif; ?>\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                    \n                <?php elseif (($action === 'approve' || $action === 'reject') && isset($payment)): ?>\n                    <!-- Payment Approval Form -->\n                    <div class=\"gaming-card\">\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <h4 class=\"text-<?= $action === 'approve' ? 'success' : 'danger' ?>\">\n                                    <i class=\"fas fa-<?= $action === 'approve' ? 'check' : 'times' ?>\"></i>\n                                    <?= ucfirst($action) ?> Payment\n                                </h4>\n                                \n                                <table class=\"table table-dark\">\n                                    <tr>\n                                        <th>Transaction ID:</th>\n                                        <td><code class=\"text-accent\"><?= htmlspecialchars($payment['transaction_id']) ?></code></td>\n                                    </tr>\n                                    <tr>\n                                        <th>User:</th>\n                                        <td><?= htmlspecialchars($payment['username']) ?> (<?= htmlspecialchars($payment['email']) ?>)</td>\n                                    </tr>\n                                    <tr>\n                                        <th>Tournament:</th>\n                                        <td><?= htmlspecialchars($payment['tournament_name']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Team:</th>\n                                        <td><?= htmlspecialchars($payment['team_name']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Amount:</th>\n                                        <td class=\"fw-bold\"><?= formatTaka($payment['amount']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Method:</th>\n                                        <td><span class=\"badge bg-info\"><?= strtoupper($payment['method']) ?></span></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Status:</th>\n                                        <td>\n                                            <span class=\"badge bg-warning\">Pending</span>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th>Date:</th>\n                                        <td><?= formatDate($payment['created_at']) ?></td>\n                                    </tr>\n                                </table>\n                            </div>\n                            \n                            <div class=\"col-md-6\">\n                                <form method=\"POST\">\n                                    <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                                    \n                                    <div class=\"mb-3\">\n                                        <label for=\"notes\" class=\"form-label text-light\">Admin Notes</label>\n                                        <textarea class=\"form-control gaming-input\" id=\"notes\" name=\"notes\" rows=\"5\" \n                                                  placeholder=\"Enter notes about this payment...\"></textarea>\n                                    </div>\n                                    \n                                    <div class=\"alert alert-<?= $action === 'approve' ? 'success' : 'warning' ?>\">\n                                        <i class=\"fas fa-info-circle\"></i>\n                                        <?php if ($action === 'approve'): ?>\n                                            Approving this payment will automatically approve the tournament registration.\n                                        <?php else: ?>\n                                            Rejecting this payment will mark the registration as failed. The user will need to pay again.\n                                        <?php endif; ?>\n                                    </div>\n                                    \n                                    <div class=\"text-end\">\n                                        <button type=\"submit\" class=\"btn btn-<?= $action === 'approve' ? 'success' : 'danger' ?>\">\n                                            <i class=\"fas fa-<?= $action === 'approve' ? 'check' : 'times' ?>\"></i>\n                                            <?= ucfirst($action) ?> Payment\n                                        </button>\n                                    </div>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                    \n                <?php elseif ($action === 'view' && isset($payment)): ?>\n                    <!-- Payment Details View -->\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-4\">\n                            <i class=\"fas fa-credit-card\"></i> Payment Details\n                        </h4>\n                        \n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <h5 class=\"text-light mb-3\">Payment Information</h5>\n                                <table class=\"table table-dark\">\n                                    <tr>\n                                        <th>Transaction ID:</th>\n                                        <td><code class=\"text-accent\"><?= htmlspecialchars($payment['transaction_id']) ?></code></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Amount:</th>\n                                        <td class=\"fw-bold\"><?= formatTaka($payment['amount']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Method:</th>\n                                        <td><span class=\"badge bg-info\"><?= strtoupper($payment['method']) ?></span></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Status:</th>\n                                        <td>\n                                            <span class=\"badge bg-<?= $payment['status'] === 'completed' ? 'success' : ($payment['status'] === 'pending' ? 'warning' : 'danger') ?>\">\n                                                <?= ucfirst($payment['status']) ?>\n                                            </span>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th>Date:</th>\n                                        <td><?= formatDate($payment['created_at']) ?></td>\n                                    </tr>\n                                    <?php if ($payment['processed_at']): ?>\n                                        <tr>\n                                            <th>Processed:</th>\n                                            <td><?= formatDate($payment['processed_at']) ?></td>\n                                        </tr>\n                                    <?php endif; ?>\n                                </table>\n                            </div>\n                            \n                            <div class=\"col-md-6\">\n                                <h5 class=\"text-light mb-3\">User & Tournament Information</h5>\n                                <table class=\"table table-dark\">\n                                    <tr>\n                                        <th>User:</th>\n                                        <td><?= htmlspecialchars($payment['username']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Email:</th>\n                                        <td><?= htmlspecialchars($payment['email']) ?></td>\n                                    </tr>\n                                    <?php if ($payment['phone']): ?>\n                                        <tr>\n                                            <th>Phone:</th>\n                                            <td><?= htmlspecialchars($payment['phone']) ?></td>\n                                        </tr>\n                                    <?php endif; ?>\n                                    <tr>\n                                        <th>Tournament:</th>\n                                        <td><?= htmlspecialchars($payment['tournament_name']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Team Name:</th>\n                                        <td><?= htmlspecialchars($payment['team_name']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Registration Date:</th>\n                                        <td><?= formatDate($payment['registration_date']) ?></td>\n                                    </tr>\n                                </table>\n                                \n                                <?php if ($payment['admin_notes']): ?>\n                                    <div class=\"mt-3\">\n                                        <h6 class=\"text-light\">Admin Notes:</h6>\n                                        <div class=\"alert alert-info\">\n                                            <?= nl2br(htmlspecialchars($payment['admin_notes'])) ?>\n                                        </div>\n                                    </div>\n                                <?php endif; ?>\n                                \n                                <?php if ($payment['status'] === 'pending'): ?>\n                                    <div class=\"mt-3\">\n                                        <a href=\"?action=approve&id=<?= $payment['id'] ?>\" class=\"btn btn-success me-2\">\n                                            <i class=\"fas fa-check\"></i> Approve\n                                        </a>\n                                        <a href=\"?action=reject&id=<?= $payment['id'] ?>\" class=\"btn btn-danger\">\n                                            <i class=\"fas fa-times\"></i> Reject\n                                        </a>\n                                    </div>\n                                <?php endif; ?>\n                            </div>\n                        </div>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>\n","size_bytes":25277},"admin/registrations.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$action = $_GET['action'] ?? 'list';\n$registrationId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle approval/rejection\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && $action === 'approve') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $status = sanitizeInput($_POST['status'] ?? '');\n        $adminNotes = sanitizeInput($_POST['admin_notes'] ?? '');\n        \n        if (in_array($status, ['approved', 'rejected'])) {\n            try {\n                $stmt = $pdo->prepare(\"\n                    UPDATE tournament_registrations \n                    SET status = ?, updated_at = CURRENT_TIMESTAMP \n                    WHERE id = ?\n                \");\n                $stmt->execute([$status, $registrationId]);\n                \n                // Create notification for user\n                $stmt = $pdo->prepare(\"\n                    SELECT tr.user_id, t.name as tournament_name\n                    FROM tournament_registrations tr\n                    JOIN tournaments t ON tr.tournament_id = t.id\n                    WHERE tr.id = ?\n                \");\n                $stmt->execute([$registrationId]);\n                $reg = $stmt->fetch();\n                \n                if ($reg) {\n                    $message = $status === 'approved' \n                        ? \"Your registration for '{$reg['tournament_name']}' has been approved!\"\n                        : \"Your registration for '{$reg['tournament_name']}' has been rejected.\";\n                    \n                    $stmt = $pdo->prepare(\"\n                        INSERT INTO notifications (user_id, title, message, type, created_at)\n                        VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP)\n                    \");\n                    $stmt->execute([\n                        $reg['user_id'],\n                        'Registration ' . ucfirst($status),\n                        $message,\n                        $status === 'approved' ? 'success' : 'warning'\n                    ]);\n                }\n                \n                $success = 'Registration ' . $status . ' successfully!';\n                $action = 'list';\n            } catch (PDOException $e) {\n                $error = 'Failed to update registration: ' . $e->getMessage();\n            }\n        } else {\n            $error = 'Invalid status selected';\n        }\n    }\n}\n\n// Get registration details for approval\n$registration = null;\nif ($action === 'approve' && $registrationId) {\n    $stmt = $pdo->prepare(\"\n        SELECT tr.*, u.username, u.full_name, u.email, t.name as tournament_name, t.entry_fee\n        FROM tournament_registrations tr\n        JOIN users u ON tr.user_id = u.id\n        JOIN tournaments t ON tr.tournament_id = t.id\n        WHERE tr.id = ?\n    \");\n    $stmt->execute([$registrationId]);\n    $registration = $stmt->fetch();\n    \n    if (!$registration) {\n        $error = 'Registration not found';\n        $action = 'list';\n    }\n}\n\n// Get registrations list\nif ($action === 'list') {\n    $status = sanitizeInput($_GET['status'] ?? '');\n    $tournament = sanitizeInput($_GET['tournament'] ?? '');\n    \n    $whereClause = 'WHERE 1=1';\n    $params = [];\n    \n    if ($status) {\n        $whereClause .= ' AND tr.status = ?';\n        $params[] = $status;\n    }\n    \n    if ($tournament) {\n        $whereClause .= ' AND tr.tournament_id = ?';\n        $params[] = $tournament;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT tr.*, u.username, u.full_name, t.name as tournament_name, t.entry_fee,\n               p.status as payment_status, p.amount as payment_amount\n        FROM tournament_registrations tr\n        JOIN users u ON tr.user_id = u.id\n        JOIN tournaments t ON tr.tournament_id = t.id\n        LEFT JOIN payments p ON tr.id = p.registration_id\n        \" . $whereClause . \"\n        ORDER BY tr.created_at DESC\n    \");\n    $stmt->execute($params);\n    $registrations = $stmt->fetchAll();\n    \n    // Get tournaments for filter\n    $stmt = $pdo->query(\"SELECT id, name FROM tournaments ORDER BY created_at DESC\");\n    $tournaments = $stmt->fetchAll();\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Registration Management - Admin</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <div class=\"col-lg-9 col-xl-10 main-content\">\n                <div class=\"d-flex justify-content-between align-items-center mb-4\">\n                    <h2 class=\"text-light\">\n                        <i class=\"fas fa-user-check text-accent\"></i> Registration Management\n                    </h2>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($action === 'list'): ?>\n                    <!-- Filters -->\n                    <div class=\"gaming-card mb-4\">\n                        <form method=\"GET\" class=\"row g-3\">\n                            <div class=\"col-md-4\">\n                                <select class=\"form-control gaming-input\" name=\"status\">\n                                    <option value=\"\">All Status</option>\n                                    <option value=\"pending\" <?= $status === 'pending' ? 'selected' : '' ?>>Pending</option>\n                                    <option value=\"approved\" <?= $status === 'approved' ? 'selected' : '' ?>>Approved</option>\n                                    <option value=\"rejected\" <?= $status === 'rejected' ? 'selected' : '' ?>>Rejected</option>\n                                </select>\n                            </div>\n                            <div class=\"col-md-4\">\n                                <select class=\"form-control gaming-input\" name=\"tournament\">\n                                    <option value=\"\">All Tournaments</option>\n                                    <?php foreach ($tournaments as $t): ?>\n                                        <option value=\"<?= $t['id'] ?>\" <?= $tournament == $t['id'] ? 'selected' : '' ?>>\n                                            <?= htmlspecialchars($t['name']) ?>\n                                        </option>\n                                    <?php endforeach; ?>\n                                </select>\n                            </div>\n                            <div class=\"col-md-4\">\n                                <button type=\"submit\" class=\"btn btn-accent w-100\">\n                                    <i class=\"fas fa-filter\"></i> Filter\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                    \n                    <!-- Registrations Table -->\n                    <div class=\"gaming-card\">\n                        <?php if (empty($registrations)): ?>\n                            <div class=\"text-center py-5\">\n                                <i class=\"fas fa-user-check fa-4x text-accent mb-3\"></i>\n                                <h4>No Registrations Found</h4>\n                                <p class=\"text-light-50\">No registrations match your current filters</p>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-dark table-striped\">\n                                    <thead>\n                                        <tr>\n                                            <th>User</th>\n                                            <th>Tournament</th>\n                                            <th>Team Name</th>\n                                            <th>Entry Fee</th>\n                                            <th>Payment Status</th>\n                                            <th>Status</th>\n                                            <th>Registered</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($registrations as $reg): ?>\n                                            <tr>\n                                                <td>\n                                                    <strong><?= htmlspecialchars($reg['full_name']) ?></strong><br>\n                                                    <small class=\"text-light-50\">@<?= htmlspecialchars($reg['username']) ?></small>\n                                                </td>\n                                                <td><?= htmlspecialchars($reg['tournament_name']) ?></td>\n                                                <td><?= htmlspecialchars($reg['team_name']) ?></td>\n                                                <td><?= formatTaka($reg['entry_fee']) ?></td>\n                                                <td>\n                                                    <?php if ($reg['payment_status']): ?>\n                                                        <span class=\"badge bg-<?= $reg['payment_status'] === 'completed' ? 'success' : ($reg['payment_status'] === 'pending' ? 'warning' : 'danger') ?>\">\n                                                            <?= ucfirst($reg['payment_status']) ?>\n                                                        </span>\n                                                    <?php else: ?>\n                                                        <span class=\"badge bg-secondary\">No Payment</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                                <td>\n                                                    <span class=\"badge bg-<?= $reg['status'] === 'approved' ? 'success' : ($reg['status'] === 'pending' ? 'warning' : 'danger') ?>\">\n                                                        <?= ucfirst($reg['status']) ?>\n                                                    </span>\n                                                </td>\n                                                <td><?= formatDate($reg['created_at']) ?></td>\n                                                <td>\n                                                    <?php if ($reg['status'] === 'pending'): ?>\n                                                        <a href=\"registrations.php?action=approve&id=<?= $reg['id'] ?>\" class=\"btn btn-sm btn-accent\">\n                                                            <i class=\"fas fa-check\"></i> Review\n                                                        </a>\n                                                    <?php else: ?>\n                                                        <span class=\"text-light-50\">Processed</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                            </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                \n                <?php elseif ($action === 'approve' && $registration): ?>\n                    <!-- Approval Form -->\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-4\">\n                            <i class=\"fas fa-user-check\"></i> Review Registration\n                        </h4>\n                        \n                        <div class=\"row mb-4\">\n                            <div class=\"col-md-6\">\n                                <h6 class=\"text-light\">User Information</h6>\n                                <p><strong>Name:</strong> <?= htmlspecialchars($registration['full_name']) ?></p>\n                                <p><strong>Username:</strong> @<?= htmlspecialchars($registration['username']) ?></p>\n                                <p><strong>Email:</strong> <?= htmlspecialchars($registration['email']) ?></p>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <h6 class=\"text-light\">Tournament Information</h6>\n                                <p><strong>Tournament:</strong> <?= htmlspecialchars($registration['tournament_name']) ?></p>\n                                <p><strong>Team Name:</strong> <?= htmlspecialchars($registration['team_name']) ?></p>\n                                <p><strong>Entry Fee:</strong> <?= formatTaka($registration['entry_fee']) ?></p>\n                                <?php if ($registration['team_members']): ?>\n                                    <p><strong>Team Members:</strong><br><?= nl2br(htmlspecialchars($registration['team_members'])) ?></p>\n                                <?php endif; ?>\n                            </div>\n                        </div>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-6 mb-3\">\n                                    <label class=\"form-label\">Decision</label>\n                                    <select class=\"form-control gaming-input\" name=\"status\" required>\n                                        <option value=\"\">Select Decision</option>\n                                        <option value=\"approved\">Approve Registration</option>\n                                        <option value=\"rejected\">Reject Registration</option>\n                                    </select>\n                                </div>\n                                <div class=\"col-md-6 mb-3\">\n                                    <label class=\"form-label\">Admin Notes (Optional)</label>\n                                    <textarea class=\"form-control gaming-input\" name=\"admin_notes\" rows=\"3\" placeholder=\"Any notes or feedback for the user\"></textarea>\n                                </div>\n                            </div>\n                            \n                            <div class=\"d-flex gap-2\">\n                                <button type=\"submit\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-check\"></i> Process Registration\n                                </button>\n                                <a href=\"registrations.php\" class=\"btn btn-secondary\">\n                                    <i class=\"fas fa-arrow-left\"></i> Back to List\n                                </a>\n                            </div>\n                        </form>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>","size_bytes":16354},"admin/results.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$action = $_GET['action'] ?? 'list';\n$matchId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle match result updates\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && $action === 'update') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $winnerId = (int)($_POST['winner_id'] ?? 0);\n        $score1 = (int)($_POST['score1'] ?? 0);\n        $score2 = (int)($_POST['score2'] ?? 0);\n        $notes = sanitizeInput($_POST['notes'] ?? '');\n        $status = sanitizeInput($_POST['status'] ?? '');\n        \n        if ($winnerId && in_array($status, ['completed', 'pending_review'])) {\n            try {\n                $stmt = $pdo->prepare(\"\n                    UPDATE matches \n                    SET winner_id = ?, score1 = ?, score2 = ?, notes = ?, status = ?, completed_at = CURRENT_TIMESTAMP\n                    WHERE id = ?\n                \");\n                $stmt->execute([$winnerId, $score1, $score2, $notes, $status, $matchId]);\n                \n                // Create notifications for both teams\n                $stmt = $pdo->prepare(\"\n                    SELECT team1_id, team2_id, tournament_id \n                    FROM matches \n                    WHERE id = ?\n                \");\n                $stmt->execute([$matchId]);\n                $match = $stmt->fetch();\n                \n                if ($match) {\n                    $winnerMessage = \"Congratulations! You won your match.\";\n                    $loserMessage = \"Your match result has been updated. Better luck next time!\";\n                    \n                    // Notify winner\n                    $stmt = $pdo->prepare(\"\n                        INSERT INTO notifications (user_id, title, message, type, created_at)\n                        VALUES (?, 'Match Result', ?, 'success', CURRENT_TIMESTAMP)\n                    \");\n                    $stmt->execute([$winnerId, $winnerMessage]);\n                    \n                    // Notify loser\n                    $loserId = $winnerId == $match['team1_id'] ? $match['team2_id'] : $match['team1_id'];\n                    $stmt = $pdo->prepare(\"\n                        INSERT INTO notifications (user_id, title, message, type, created_at)\n                        VALUES (?, 'Match Result', ?, 'info', CURRENT_TIMESTAMP)\n                    \");\n                    $stmt->execute([$loserId, $loserMessage]);\n                }\n                \n                $success = 'Match result updated successfully!';\n                $action = 'list';\n            } catch (PDOException $e) {\n                $error = 'Failed to update match result: ' . $e->getMessage();\n            }\n        } else {\n            $error = 'Please select a winner and valid status';\n        }\n    }\n}\n\n// Get match details for editing\n$match = null;\nif ($action === 'update' && $matchId) {\n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name,\n               u1.username as team1_name, u1.full_name as team1_fullname,\n               u2.username as team2_name, u2.full_name as team2_fullname,\n               ms1.screenshot_url as team1_screenshot, ms1.uploaded_at as team1_upload_time,\n               ms2.screenshot_url as team2_screenshot, ms2.uploaded_at as team2_upload_time\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        LEFT JOIN match_screenshots ms1 ON m.id = ms1.match_id AND ms1.team_id = u1.id\n        LEFT JOIN match_screenshots ms2 ON m.id = ms2.match_id AND ms2.team_id = u2.id\n        WHERE m.id = ?\n    \");\n    $stmt->execute([$matchId]);\n    $match = $stmt->fetch();\n    \n    if (!$match) {\n        $error = 'Match not found';\n        $action = 'list';\n    }\n}\n\n// Get matches list\nif ($action === 'list') {\n    $status = sanitizeInput($_GET['status'] ?? '');\n    $tournament = sanitizeInput($_GET['tournament'] ?? '');\n    \n    $whereClause = 'WHERE 1=1';\n    $params = [];\n    \n    if ($status) {\n        $whereClause .= ' AND m.status = ?';\n        $params[] = $status;\n    }\n    \n    if ($tournament) {\n        $whereClause .= ' AND m.tournament_id = ?';\n        $params[] = $tournament;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name,\n               u1.username as team1_name, u1.full_name as team1_fullname,\n               u2.username as team2_name, u2.full_name as team2_fullname,\n               w.username as winner_name\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        LEFT JOIN users w ON m.winner_id = w.id\n        $whereClause\n        ORDER BY m.scheduled_date DESC, m.created_at DESC\n    \");\n    $stmt->execute($params);\n    $matches = $stmt->fetchAll();\n    \n    // Get tournaments for filter\n    $stmt = $pdo->query(\"SELECT id, name FROM tournaments ORDER BY created_at DESC\");\n    $tournaments = $stmt->fetchAll();\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Match Results - Admin</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <div class=\"col-lg-9 col-xl-10 main-content\">\n                <div class=\"d-flex justify-content-between align-items-center mb-4\">\n                    <h2 class=\"text-light\">\n                        <i class=\"fas fa-trophy text-accent\"></i> Match Results Management\n                    </h2>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($action === 'list'): ?>\n                    <!-- Filters -->\n                    <div class=\"gaming-card mb-4\">\n                        <form method=\"GET\" class=\"row g-3\">\n                            <div class=\"col-md-4\">\n                                <select class=\"form-control gaming-input\" name=\"status\">\n                                    <option value=\"\">All Status</option>\n                                    <option value=\"scheduled\" <?= $status === 'scheduled' ? 'selected' : '' ?>>Scheduled</option>\n                                    <option value=\"live\" <?= $status === 'live' ? 'selected' : '' ?>>Live</option>\n                                    <option value=\"completed\" <?= $status === 'completed' ? 'selected' : '' ?>>Completed</option>\n                                    <option value=\"pending_review\" <?= $status === 'pending_review' ? 'selected' : '' ?>>Pending Review</option>\n                                </select>\n                            </div>\n                            <div class=\"col-md-4\">\n                                <select class=\"form-control gaming-input\" name=\"tournament\">\n                                    <option value=\"\">All Tournaments</option>\n                                    <?php foreach ($tournaments as $t): ?>\n                                        <option value=\"<?= $t['id'] ?>\" <?= $tournament == $t['id'] ? 'selected' : '' ?>>\n                                            <?= htmlspecialchars($t['name']) ?>\n                                        </option>\n                                    <?php endforeach; ?>\n                                </select>\n                            </div>\n                            <div class=\"col-md-4\">\n                                <button type=\"submit\" class=\"btn btn-accent w-100\">\n                                    <i class=\"fas fa-filter\"></i> Filter\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                    \n                    <!-- Matches Table -->\n                    <div class=\"gaming-card\">\n                        <?php if (empty($matches)): ?>\n                            <div class=\"text-center py-5\">\n                                <i class=\"fas fa-gamepad fa-4x text-accent mb-3\"></i>\n                                <h4>No Matches Found</h4>\n                                <p class=\"text-light-50\">No matches match your current filters</p>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-dark table-striped\">\n                                    <thead>\n                                        <tr>\n                                            <th>Tournament</th>\n                                            <th>Teams</th>\n                                            <th>Score</th>\n                                            <th>Winner</th>\n                                            <th>Status</th>\n                                            <th>Date</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($matches as $m): ?>\n                                            <tr>\n                                                <td>\n                                                    <strong><?= htmlspecialchars($m['tournament_name']) ?></strong><br>\n                                                    <?php if ($m['round']): ?>\n                                                        <small class=\"text-light-50\"><?= htmlspecialchars($m['round']) ?></small>\n                                                    <?php endif; ?>\n                                                </td>\n                                                <td>\n                                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                                        <span><?= htmlspecialchars($m['team1_name']) ?></span>\n                                                        <small class=\"text-accent\">vs</small>\n                                                        <span><?= htmlspecialchars($m['team2_name']) ?></span>\n                                                    </div>\n                                                </td>\n                                                <td>\n                                                    <?php if ($m['score1'] !== null && $m['score2'] !== null): ?>\n                                                        <span class=\"fw-bold\"><?= $m['score1'] ?> - <?= $m['score2'] ?></span>\n                                                    <?php else: ?>\n                                                        <span class=\"text-light-50\">Not set</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                                <td>\n                                                    <?php if ($m['winner_name']): ?>\n                                                        <span class=\"text-accent fw-bold\"><?= htmlspecialchars($m['winner_name']) ?></span>\n                                                    <?php else: ?>\n                                                        <span class=\"text-light-50\">TBD</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                                <td>\n                                                    <span class=\"badge bg-<?= $m['status'] === 'completed' ? 'success' : ($m['status'] === 'live' ? 'warning' : ($m['status'] === 'pending_review' ? 'info' : 'secondary')) ?>\">\n                                                        <?= ucfirst(str_replace('_', ' ', $m['status'])) ?>\n                                                    </span>\n                                                </td>\n                                                <td>\n                                                    <?php if ($m['scheduled_date']): ?>\n                                                        <?= formatDate($m['scheduled_date']) ?>\n                                                    <?php else: ?>\n                                                        <span class=\"text-light-50\">Not scheduled</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                                <td>\n                                                    <?php if (in_array($m['status'], ['scheduled', 'live', 'pending_review'])): ?>\n                                                        <a href=\"results.php?action=update&id=<?= $m['id'] ?>\" class=\"btn btn-sm btn-accent\">\n                                                            <i class=\"fas fa-edit\"></i> Update Result\n                                                        </a>\n                                                    <?php else: ?>\n                                                        <span class=\"text-success\">Completed</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                            </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                \n                <?php elseif ($action === 'update' && $match): ?>\n                    <!-- Update Result Form -->\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-4\">\n                            <i class=\"fas fa-trophy\"></i> Update Match Result\n                        </h4>\n                        \n                        <div class=\"row mb-4\">\n                            <div class=\"col-md-6\">\n                                <h6 class=\"text-light\">Match Information</h6>\n                                <p><strong>Tournament:</strong> <?= htmlspecialchars($match['tournament_name']) ?></p>\n                                <?php if ($match['round']): ?>\n                                    <p><strong>Round:</strong> <?= htmlspecialchars($match['round']) ?></p>\n                                <?php endif; ?>\n                                <?php if ($match['scheduled_date']): ?>\n                                    <p><strong>Scheduled:</strong> <?= formatDate($match['scheduled_date']) ?></p>\n                                <?php endif; ?>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <h6 class=\"text-light\">Current Status</h6>\n                                <p><strong>Status:</strong> \n                                    <span class=\"badge bg-<?= $match['status'] === 'completed' ? 'success' : ($match['status'] === 'live' ? 'warning' : 'secondary') ?>\">\n                                        <?= ucfirst(str_replace('_', ' ', $match['status'])) ?>\n                                    </span>\n                                </p>\n                                <?php if ($match['winner_id']): ?>\n                                    <p><strong>Current Winner:</strong> <?= htmlspecialchars($match['winner_name'] ?? 'Unknown') ?></p>\n                                <?php endif; ?>\n                            </div>\n                        </div>\n                        \n                        <div class=\"row mb-4\">\n                            <div class=\"col-md-6\">\n                                <div class=\"gaming-card bg-secondary\">\n                                    <h6 class=\"text-accent\">Team 1</h6>\n                                    <p class=\"mb-0\"><strong><?= htmlspecialchars($match['team1_fullname']) ?></strong></p>\n                                    <small class=\"text-light-50\">@<?= htmlspecialchars($match['team1_name']) ?></small>\n                                </div>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <div class=\"gaming-card bg-secondary\">\n                                    <h6 class=\"text-accent\">Team 2</h6>\n                                    <p class=\"mb-0\"><strong><?= htmlspecialchars($match['team2_fullname']) ?></strong></p>\n                                    <small class=\"text-light-50\">@<?= htmlspecialchars($match['team2_name']) ?></small>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <!-- Screenshots Section -->\n                        <?php if ($match['team1_screenshot'] || $match['team2_screenshot']): ?>\n                        <div class=\"gaming-card mb-4\">\n                            <h6 class=\"text-accent mb-3\">\n                                <i class=\"fas fa-images\"></i> Uploaded Screenshots\n                            </h6>\n                            <div class=\"row\">\n                                <div class=\"col-md-6\">\n                                    <h6 class=\"text-light\">Team 1: <?= htmlspecialchars($match['team1_name']) ?></h6>\n                                    <?php if ($match['team1_screenshot']): ?>\n                                        <div class=\"screenshot-container mb-2\">\n                                            <img src=\"../<?= htmlspecialchars($match['team1_screenshot']) ?>\" \n                                                 alt=\"Team 1 Screenshot\" \n                                                 class=\"img-fluid rounded border\" \n                                                 style=\"max-height: 300px; cursor: pointer;\" \n                                                 onclick=\"openScreenshotModal(this.src, 'Team 1 Screenshot')\">\n                                        </div>\n                                        <small class=\"text-light-50\">\n                                            <i class=\"fas fa-clock\"></i> Uploaded: <?= formatDate($match['team1_upload_time']) ?>\n                                        </small>\n                                    <?php else: ?>\n                                        <div class=\"alert alert-warning\">\n                                            <i class=\"fas fa-exclamation-triangle\"></i> No screenshot uploaded\n                                        </div>\n                                    <?php endif; ?>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <h6 class=\"text-light\">Team 2: <?= htmlspecialchars($match['team2_name']) ?></h6>\n                                    <?php if ($match['team2_screenshot']): ?>\n                                        <div class=\"screenshot-container mb-2\">\n                                            <img src=\"../<?= htmlspecialchars($match['team2_screenshot']) ?>\" \n                                                 alt=\"Team 2 Screenshot\" \n                                                 class=\"img-fluid rounded border\" \n                                                 style=\"max-height: 300px; cursor: pointer;\" \n                                                 onclick=\"openScreenshotModal(this.src, 'Team 2 Screenshot')\">\n                                        </div>\n                                        <small class=\"text-light-50\">\n                                            <i class=\"fas fa-clock\"></i> Uploaded: <?= formatDate($match['team2_upload_time']) ?>\n                                        </small>\n                                    <?php else: ?>\n                                        <div class=\"alert alert-warning\">\n                                            <i class=\"fas fa-exclamation-triangle\"></i> No screenshot uploaded\n                                        </div>\n                                    <?php endif; ?>\n                                </div>\n                            </div>\n                        </div>\n                        <?php endif; ?>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"row mb-3\">\n                                <div class=\"col-md-3\">\n                                    <label class=\"form-label\">Team 1 Score</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" name=\"score1\" \n                                           value=\"<?= $match['score1'] ?? 0 ?>\" min=\"0\" required>\n                                </div>\n                                <div class=\"col-md-3\">\n                                    <label class=\"form-label\">Team 2 Score</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" name=\"score2\" \n                                           value=\"<?= $match['score2'] ?? 0 ?>\" min=\"0\" required>\n                                </div>\n                                <div class=\"col-md-3\">\n                                    <label class=\"form-label\">Winner</label>\n                                    <select class=\"form-control gaming-input\" name=\"winner_id\" required>\n                                        <option value=\"\">Select Winner</option>\n                                        <option value=\"<?= $match['team1_id'] ?>\" <?= $match['winner_id'] == $match['team1_id'] ? 'selected' : '' ?>>\n                                            <?= htmlspecialchars($match['team1_name']) ?>\n                                        </option>\n                                        <option value=\"<?= $match['team2_id'] ?>\" <?= $match['winner_id'] == $match['team2_id'] ? 'selected' : '' ?>>\n                                            <?= htmlspecialchars($match['team2_name']) ?>\n                                        </option>\n                                    </select>\n                                </div>\n                                <div class=\"col-md-3\">\n                                    <label class=\"form-label\">Match Status</label>\n                                    <select class=\"form-control gaming-input\" name=\"status\" required>\n                                        <option value=\"completed\" <?= $match['status'] === 'completed' ? 'selected' : '' ?>>Completed</option>\n                                        <option value=\"pending_review\" <?= $match['status'] === 'pending_review' ? 'selected' : '' ?>>Pending Review</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label class=\"form-label\">Match Notes (Optional)</label>\n                                <textarea class=\"form-control gaming-input\" name=\"notes\" rows=\"3\" \n                                          placeholder=\"Any additional notes about the match result\"><?= htmlspecialchars($match['notes'] ?? '') ?></textarea>\n                            </div>\n                            \n                            <div class=\"alert alert-info\">\n                                <h6 class=\"text-info\"><i class=\"fas fa-info-circle\"></i> Important Note:</h6>\n                                <p class=\"mb-0\">This sets the winner for this <strong>individual match</strong> only. \n                                To set the overall tournament winners (Champion, Runner-up, 3rd Place), go to \n                                <a href=\"tournament_results.php\" class=\"text-accent\">Tournament Results</a> page.</p>\n                            </div>\n                            \n                            <div class=\"d-flex gap-2\">\n                                <button type=\"submit\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-save\"></i> Update Match Result\n                                </button>\n                                <a href=\"results.php\" class=\"btn btn-secondary\">\n                                    <i class=\"fas fa-arrow-left\"></i> Back to List\n                                </a>\n                            </div>\n                        </form>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Screenshot Modal -->\n    <div class=\"modal fade\" id=\"screenshotModal\" tabindex=\"-1\">\n        <div class=\"modal-dialog modal-lg\">\n            <div class=\"modal-content bg-dark\">\n                <div class=\"modal-header border-secondary\">\n                    <h5 class=\"modal-title text-light\" id=\"screenshotModalLabel\">Screenshot</h5>\n                    <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n                </div>\n                <div class=\"modal-body text-center\">\n                    <img id=\"screenshotModalImg\" src=\"\" alt=\"Screenshot\" class=\"img-fluid rounded\">\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n    <script>\n        function openScreenshotModal(src, title) {\n            document.getElementById('screenshotModalImg').src = src;\n            document.getElementById('screenshotModalLabel').textContent = title;\n            new bootstrap.Modal(document.getElementById('screenshotModal')).show();\n        }\n    </script>\n</body>\n</html>","size_bytes":26959},"admin/tournaments.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$action = $_GET['action'] ?? 'list';\n$tournamentId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle form submissions\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        switch ($action) {\n            case 'create':\n            case 'edit':\n                $name = sanitizeInput($_POST['name'] ?? '');\n                $description = sanitizeInput($_POST['description'] ?? '');\n                $gameType = sanitizeInput($_POST['game_type'] ?? '');\n                $maxTeams = (int)($_POST['max_teams'] ?? 0);\n                $entryFee = (float)($_POST['entry_fee'] ?? 0);\n                $prizePool = (float)($_POST['prize_pool'] ?? 0);\n                $startDate = $_POST['start_date'] ?? '';\n                $endDate = $_POST['end_date'] ?? '';\n                $status = sanitizeInput($_POST['status'] ?? 'upcoming');\n                $thumbnailPath = '';\n                \n                // Handle thumbnail upload\n                if (isset($_FILES['thumbnail']) && $_FILES['thumbnail']['error'] === UPLOAD_ERR_OK) {\n                    $uploadDir = '../assets/images/tournaments/';\n                    if (!is_dir($uploadDir)) {\n                        mkdir($uploadDir, 0755, true);\n                    }\n                    \n                    $fileInfo = pathinfo($_FILES['thumbnail']['name']);\n                    $fileName = 'tournament_' . time() . '_' . uniqid() . '.' . $fileInfo['extension'];\n                    $uploadPath = $uploadDir . $fileName;\n                    $thumbnailPath = 'assets/images/tournaments/' . $fileName;\n                    \n                    // Validate file\n                    $allowedTypes = ['jpg', 'jpeg', 'png', 'gif', 'webp'];\n                    if (in_array(strtolower($fileInfo['extension']), $allowedTypes) && $_FILES['thumbnail']['size'] <= 5242880) {\n                        if (move_uploaded_file($_FILES['thumbnail']['tmp_name'], $uploadPath)) {\n                            // File uploaded successfully\n                        } else {\n                            $error = 'Failed to upload thumbnail';\n                        }\n                    } else {\n                        $error = 'Invalid file type or size too large (max 5MB)';\n                    }\n                }\n                \n                if (empty($name) || empty($gameType) || $maxTeams <= 0) {\n                    $error = 'Please fill all required fields';\n                } else {\n                    try {\n                        if ($action === 'create') {\n                            $stmt = $pdo->prepare(\"\n                                INSERT INTO tournaments (name, description, game_type, max_teams, \n                                                       entry_fee, prize_pool, start_date, end_date, status, thumbnail, created_at)\n                                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)\n                            \");\n                            $stmt->execute([$name, $description, $gameType, $maxTeams, $entryFee, $prizePool, $startDate, $endDate, $status, $thumbnailPath]);\n                            $success = 'Tournament created successfully';\n                        } else {\n                            if ($thumbnailPath) {\n                                $stmt = $pdo->prepare(\"\n                                    UPDATE tournaments \n                                    SET name = ?, description = ?, game_type = ?, max_teams = ?, \n                                        entry_fee = ?, prize_pool = ?, start_date = ?, end_date = ?, status = ?, thumbnail = ?\n                                    WHERE id = ?\n                                \");\n                                $stmt->execute([$name, $description, $gameType, $maxTeams, $entryFee, $prizePool, $startDate, $endDate, $status, $thumbnailPath, $tournamentId]);\n                            } else {\n                                $stmt = $pdo->prepare(\"\n                                    UPDATE tournaments \n                                    SET name = ?, description = ?, game_type = ?, max_teams = ?, \n                                        entry_fee = ?, prize_pool = ?, start_date = ?, end_date = ?, status = ?\n                                    WHERE id = ?\n                                \");\n                                $stmt->execute([$name, $description, $gameType, $maxTeams, $entryFee, $prizePool, $startDate, $endDate, $status, $tournamentId]);\n                            }\n                            $success = 'Tournament updated successfully';\n                        }\n                        $action = 'list';\n                    } catch (PDOException $e) {\n                        $error = 'Database error: ' . $e->getMessage();\n                    }\n                }\n                break;\n                \n            case 'delete':\n                if ($tournamentId) {\n                    try {\n                        $stmt = $pdo->prepare(\"DELETE FROM tournaments WHERE id = ?\");\n                        $stmt->execute([$tournamentId]);\n                        $success = 'Tournament deleted successfully';\n                        $action = 'list';\n                    } catch (PDOException $e) {\n                        $error = 'Cannot delete tournament: ' . $e->getMessage();\n                    }\n                }\n                break;\n        }\n    }\n}\n\n// Get tournament data for editing\n$tournament = null;\nif (($action === 'edit' || $action === 'view') && $tournamentId) {\n    $stmt = $pdo->prepare(\"SELECT * FROM tournaments WHERE id = ?\");\n    $stmt->execute([$tournamentId]);\n    $tournament = $stmt->fetch();\n    if (!$tournament) {\n        $error = 'Tournament not found';\n        $action = 'list';\n    }\n}\n\n// Get tournaments list\nif ($action === 'list') {\n    $stmt = $pdo->query(\"\n        SELECT t.*, \n               COUNT(tr.id) as registered_teams,\n               (SELECT COUNT(*) FROM matches WHERE tournament_id = t.id) as total_matches\n        FROM tournaments t\n        LEFT JOIN tournament_registrations tr ON t.id = tr.tournament_id AND tr.status = 'approved'\n        GROUP BY t.id\n        ORDER BY t.created_at DESC\n    \");\n    $tournaments = $stmt->fetchAll();\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Tournament Management - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <div class=\"col-lg-10 main-content\">\n                <div class=\"d-flex justify-content-between align-items-center mb-4\">\n                    <h2 class=\"text-light\">\n                        <i class=\"fas fa-trophy text-accent\"></i> Tournament Management\n                    </h2>\n                    <?php if ($action === 'list'): ?>\n                        <a href=\"?action=create\" class=\"btn btn-accent\">\n                            <i class=\"fas fa-plus\"></i> Create Tournament\n                        </a>\n                    <?php else: ?>\n                        <a href=\"?\" class=\"btn btn-outline-light\">\n                            <i class=\"fas fa-arrow-left\"></i> Back to List\n                        </a>\n                    <?php endif; ?>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($action === 'list'): ?>\n                    <!-- Tournament List -->\n                    <div class=\"gaming-card\">\n                        <?php if (empty($tournaments)): ?>\n                            <div class=\"text-center text-light-50 py-5\">\n                                <i class=\"fas fa-trophy fa-4x mb-3\"></i>\n                                <h4>No Tournaments Yet</h4>\n                                <p>Create your first tournament to get started</p>\n                                <a href=\"?action=create\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-plus\"></i> Create Tournament\n                                </a>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-dark table-hover\">\n                                    <thead>\n                                        <tr>\n                                            <th>Thumbnail</th>\n                                            <th>Name</th>\n                                            <th>Game</th>\n                                            <th>Teams</th>\n                                            <th>Entry Fee</th>\n                                            <th>Prize Pool</th>\n                                            <th>Status</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($tournaments as $t): ?>\n                                            <tr>\n                                                <td>\n                                                    <?php if (!empty($t['thumbnail'])): ?>\n                                                        <img src=\"../<?= htmlspecialchars($t['thumbnail']) ?>\" alt=\"Tournament thumbnail\" \n                                                             class=\"img-thumbnail\" style=\"max-width: 60px; max-height: 40px; object-fit: cover;\">\n                                                    <?php else: ?>\n                                                        <span class=\"text-light-50\"><i class=\"fas fa-image\"></i> No image</span>\n                                                    <?php endif; ?>\n                                                </td>\n                                                <td>\n                                                    <strong><?= htmlspecialchars($t['name']) ?></strong>\n                                                    <br><small class=\"text-light-50\"><?= formatDate($t['start_date']) ?></small>\n                                                </td>\n                                                <td><?= htmlspecialchars($t['game_type']) ?></td>\n                                                <td>\n                                                    <span class=\"badge bg-info\"><?= $t['registered_teams'] ?>/<?= $t['max_teams'] ?></span>\n                                                </td>\n                                                <td><?= formatTaka($t['entry_fee']) ?></td>\n                                                <td class=\"text-warning fw-bold\"><?= formatTaka($t['prize_pool']) ?></td>\n                                                <td>\n                                                    <span class=\"badge bg-<?= $t['status'] === 'active' ? 'success' : ($t['status'] === 'upcoming' ? 'info' : 'secondary') ?>\">\n                                                        <?= ucfirst($t['status']) ?>\n                                                    </span>\n                                                </td>\n                                                <td>\n                                                    <div class=\"btn-group\" role=\"group\">\n                                                        <a href=\"?action=view&id=<?= $t['id'] ?>\" class=\"btn btn-sm btn-outline-info\">\n                                                            <i class=\"fas fa-eye\"></i>\n                                                        </a>\n                                                        <a href=\"?action=edit&id=<?= $t['id'] ?>\" class=\"btn btn-sm btn-outline-warning\">\n                                                            <i class=\"fas fa-edit\"></i>\n                                                        </a>\n                                                        <a href=\"tournament_results.php?id=<?= $t['id'] ?>\" class=\"btn btn-sm btn-outline-success\">\n                                                            <i class=\"fas fa-trophy\"></i>\n                                                        </a>\n                                                        <a href=\"?action=delete&id=<?= $t['id'] ?>\" \n                                                           class=\"btn btn-sm btn-outline-danger\"\n                                                           onclick=\"return confirm('Are you sure you want to delete this tournament?')\">\n                                                            <i class=\"fas fa-trash\"></i>\n                                                        </a>\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                    \n                <?php elseif ($action === 'create' || $action === 'edit'): ?>\n                    <!-- Tournament Form -->\n                    <div class=\"gaming-card\">\n                        <form method=\"POST\" enctype=\"multipart/form-data\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"name\" class=\"form-label text-light\">Tournament Name *</label>\n                                    <input type=\"text\" class=\"form-control gaming-input\" id=\"name\" name=\"name\" \n                                           value=\"<?= htmlspecialchars($tournament['name'] ?? '') ?>\" required>\n                                </div>\n                                \n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"game_type\" class=\"form-label text-light\">Game Type *</label>\n                                    <select class=\"form-control gaming-input\" id=\"game_type\" name=\"game_type\" required>\n                                        <option value=\"\">Select Game</option>\n                                        <option value=\"PUBG Mobile\" <?= ($tournament['game_type'] ?? '') === 'PUBG Mobile' ? 'selected' : '' ?>>PUBG Mobile</option>\n                                        <option value=\"Free Fire\" <?= ($tournament['game_type'] ?? '') === 'Free Fire' ? 'selected' : '' ?>>Free Fire</option>\n                                        <option value=\"Call of Duty Mobile\" <?= ($tournament['game_type'] ?? '') === 'Call of Duty Mobile' ? 'selected' : '' ?>>Call of Duty Mobile</option>\n                                        <option value=\"Valorant\" <?= ($tournament['game_type'] ?? '') === 'Valorant' ? 'selected' : '' ?>>Valorant</option>\n                                        <option value=\"CS:GO\" <?= ($tournament['game_type'] ?? '') === 'CS:GO' ? 'selected' : '' ?>>CS:GO</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"description\" class=\"form-label text-light\">Description</label>\n                                <textarea class=\"form-control gaming-input\" id=\"description\" name=\"description\" rows=\"4\"><?= htmlspecialchars($tournament['description'] ?? '') ?></textarea>\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"thumbnail\" class=\"form-label text-light\">Tournament Thumbnail</label>\n                                <?php if (!empty($tournament['thumbnail'])): ?>\n                                    <div class=\"mb-2\">\n                                        <img src=\"../<?= htmlspecialchars($tournament['thumbnail']) ?>\" alt=\"Current thumbnail\" \n                                             class=\"img-thumbnail\" style=\"max-height: 100px;\">\n                                        <p class=\"text-light-50 small mb-0\">Current thumbnail</p>\n                                    </div>\n                                <?php endif; ?>\n                                <input type=\"file\" class=\"form-control gaming-input\" id=\"thumbnail\" name=\"thumbnail\" \n                                       accept=\"image/jpeg,image/jpg,image/png,image/gif,image/webp\">\n                                <div class=\"form-text text-light-50\">Upload an image for the tournament (max 5MB). Supported formats: JPG, PNG, GIF, WebP</div>\n                            </div>\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"max_teams\" class=\"form-label text-light\">Max Teams *</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"max_teams\" name=\"max_teams\" \n                                           value=\"<?= $tournament['max_teams'] ?? '' ?>\" min=\"2\" required>\n                                </div>\n                                \n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"entry_fee\" class=\"form-label text-light\">Entry Fee (৳)</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"entry_fee\" name=\"entry_fee\" \n                                           value=\"<?= $tournament['entry_fee'] ?? '' ?>\" min=\"0\" step=\"0.01\">\n                                </div>\n                                \n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"prize_pool\" class=\"form-label text-light\">Prize Pool (৳)</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"prize_pool\" name=\"prize_pool\" \n                                           value=\"<?= $tournament['prize_pool'] ?? '' ?>\" min=\"0\" step=\"0.01\">\n                                </div>\n                            </div>\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"start_date\" class=\"form-label text-light\">Start Date</label>\n                                    <input type=\"datetime-local\" class=\"form-control gaming-input\" id=\"start_date\" name=\"start_date\" \n                                           value=\"<?= isset($tournament['start_date']) ? date('Y-m-d\\TH:i', strtotime($tournament['start_date'])) : '' ?>\">\n                                </div>\n                                \n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"end_date\" class=\"form-label text-light\">End Date</label>\n                                    <input type=\"datetime-local\" class=\"form-control gaming-input\" id=\"end_date\" name=\"end_date\" \n                                           value=\"<?= isset($tournament['end_date']) ? date('Y-m-d\\TH:i', strtotime($tournament['end_date'])) : '' ?>\">\n                                </div>\n                                \n                                <div class=\"col-md-4 mb-3\">\n                                    <label for=\"status\" class=\"form-label text-light\">Status</label>\n                                    <select class=\"form-control gaming-input\" id=\"status\" name=\"status\">\n                                        <option value=\"upcoming\" <?= ($tournament['status'] ?? 'upcoming') === 'upcoming' ? 'selected' : '' ?>>Upcoming</option>\n                                        <option value=\"active\" <?= ($tournament['status'] ?? '') === 'active' ? 'selected' : '' ?>>Active</option>\n                                        <option value=\"completed\" <?= ($tournament['status'] ?? '') === 'completed' ? 'selected' : '' ?>>Completed</option>\n                                        <option value=\"cancelled\" <?= ($tournament['status'] ?? '') === 'cancelled' ? 'selected' : '' ?>>Cancelled</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-save\"></i> <?= $action === 'create' ? 'Create' : 'Update' ?> Tournament\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                    \n                <?php elseif ($action === 'view'): ?>\n                    <!-- Tournament Details -->\n                    <div class=\"gaming-card\">\n                        <div class=\"row\">\n                            <div class=\"col-md-8\">\n                                <h3 class=\"text-accent\"><?= htmlspecialchars($tournament['name']) ?></h3>\n                                <p class=\"text-light-50\"><?= htmlspecialchars($tournament['description']) ?></p>\n                                \n                                <div class=\"row mt-4\">\n                                    <div class=\"col-md-6\">\n                                        <h5 class=\"text-light\">Tournament Details</h5>\n                                        <ul class=\"list-unstyled text-light-50\">\n                                            <li><strong>Game:</strong> <?= htmlspecialchars($tournament['game_type']) ?></li>\n                                            <li><strong>Max Teams:</strong> <?= $tournament['max_teams'] ?></li>\n                                            <li><strong>Entry Fee:</strong> <?= formatTaka($tournament['entry_fee']) ?></li>\n                                            <li><strong>Prize Pool:</strong> <?= formatTaka($tournament['prize_pool']) ?></li>\n                                            <li><strong>Start Date:</strong> <?= formatDate($tournament['start_date']) ?></li>\n                                            <li><strong>End Date:</strong> <?= formatDate($tournament['end_date']) ?></li>\n                                        </ul>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"col-md-4\">\n                                <div class=\"text-center\">\n                                    <span class=\"badge bg-<?= $tournament['status'] === 'active' ? 'success' : ($tournament['status'] === 'upcoming' ? 'info' : 'secondary') ?> fs-6\">\n                                        <?= ucfirst($tournament['status']) ?>\n                                    </span>\n                                </div>\n                                \n                                <div class=\"mt-4\">\n                                    <a href=\"?action=edit&id=<?= $tournament['id'] ?>\" class=\"btn btn-warning w-100 mb-2\">\n                                        <i class=\"fas fa-edit\"></i> Edit Tournament\n                                    </a>\n                                    <a href=\"matches.php?tournament_id=<?= $tournament['id'] ?>\" class=\"btn btn-info w-100\">\n                                        <i class=\"fas fa-gamepad\"></i> Manage Matches\n                                    </a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>\n","size_bytes":25389},"admin/users.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$action = $_GET['action'] ?? 'list';\n$userId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle user actions\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        switch ($action) {\n            case 'update_status':\n                $status = sanitizeInput($_POST['status'] ?? '');\n                \n                if ($userId && in_array($status, ['active', 'suspended', 'banned'])) {\n                    try {\n                        $stmt = $pdo->prepare(\"UPDATE users SET status = ? WHERE id = ?\");\n                        $stmt->execute([$status, $userId]);\n                        $success = 'User status updated successfully';\n                        $action = 'list';\n                    } catch (PDOException $e) {\n                        $error = 'Database error: ' . $e->getMessage();\n                    }\n                } else {\n                    $error = 'Invalid status selected';\n                }\n                break;\n                \n            case 'update_wallet':\n                $amount = (float)($_POST['amount'] ?? 0);\n                $operation = $_POST['operation'] ?? 'add';\n                \n                if ($userId && $amount > 0) {\n                    try {\n                        $pdo->beginTransaction();\n                        \n                        $stmt = $pdo->prepare(\"SELECT wallet_balance FROM users WHERE id = ?\");\n                        $stmt->execute([$userId]);\n                        $currentBalance = $stmt->fetchColumn();\n                        \n                        $newBalance = $operation === 'add' \n                            ? $currentBalance + $amount \n                            : max(0, $currentBalance - $amount);\n                        \n                        $stmt = $pdo->prepare(\"UPDATE users SET wallet_balance = ? WHERE id = ?\");\n                        $stmt->execute([$newBalance, $userId]);\n                        \n                        // Log wallet transaction\n                        $stmt = $pdo->prepare(\"\n                            INSERT INTO wallet_transactions (user_id, type, amount, balance_after, description, created_by, created_at)\n                            VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)\n                        \");\n                        $description = $operation === 'add' ? 'Admin credit' : 'Admin debit';\n                        $stmt->execute([$userId, $operation, $amount, $newBalance, $description, $_SESSION['admin_id']]);\n                        \n                        $pdo->commit();\n                        $success = 'Wallet balance updated successfully';\n                        $action = 'view';\n                    } catch (PDOException $e) {\n                        $pdo->rollback();\n                        $error = 'Database error: ' . $e->getMessage();\n                    }\n                } else {\n                    $error = 'Please enter a valid amount';\n                }\n                break;\n        }\n    }\n}\n\n// Get user data for viewing/editing\n$user = null;\nif (($action === 'view' || $action === 'edit' || $action === 'update_status') && $userId) {\n    $stmt = $pdo->prepare(\"\n        SELECT u.*, \n               COUNT(DISTINCT tr.id) as total_registrations,\n               COUNT(DISTINCT p.id) as total_payments,\n               SUM(p.amount) as total_spent\n        FROM users u\n        LEFT JOIN tournament_registrations tr ON u.id = tr.user_id\n        LEFT JOIN payments p ON tr.id = p.registration_id AND p.status = 'completed'\n        WHERE u.id = ?\n        GROUP BY u.id\n    \");\n    $stmt->execute([$userId]);\n    $user = $stmt->fetch();\n    \n    if (!$user) {\n        $error = 'User not found';\n        $action = 'list';\n    }\n}\n\n// Get users list\nif ($action === 'list') {\n    $search = sanitizeInput($_GET['search'] ?? '');\n    $status = sanitizeInput($_GET['status'] ?? '');\n    \n    $whereClause = 'WHERE 1=1';\n    $params = [];\n    \n    if ($search) {\n        $whereClause .= ' AND (u.username LIKE ? OR u.email LIKE ? OR u.full_name LIKE ?)';\n        $searchTerm = \"%$search%\";\n        $params = array_merge($params, [$searchTerm, $searchTerm, $searchTerm]);\n    }\n    \n    if ($status) {\n        $whereClause .= ' AND u.status = ?';\n        $params[] = $status;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT u.*, \n               COUNT(DISTINCT tr.id) as registrations,\n               SUM(CASE WHEN p.status = 'completed' THEN p.amount ELSE 0 END) as total_spent\n        FROM users u\n        LEFT JOIN tournament_registrations tr ON u.id = tr.user_id\n        LEFT JOIN payments p ON tr.id = p.registration_id\n        $whereClause\n        GROUP BY u.id\n        ORDER BY u.created_at DESC\n        LIMIT 50\n    \");\n    $stmt->execute($params);\n    $users = $stmt->fetchAll();\n    \n    // Get status counts\n    $stmt = $pdo->query(\"\n        SELECT status, COUNT(*) as count \n        FROM users \n        GROUP BY status\n    \");\n    $statusCounts = [];\n    while ($row = $stmt->fetch()) {\n        $statusCounts[$row['status']] = $row['count'];\n    }\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>User Management - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <div class=\"col-lg-10 main-content\">\n                <div class=\"d-flex justify-content-between align-items-center mb-4\">\n                    <h2 class=\"text-light\">\n                        <i class=\"fas fa-users text-accent\"></i> User Management\n                    </h2>\n                    <?php if ($action !== 'list'): ?>\n                        <a href=\"?\" class=\"btn btn-outline-light\">\n                            <i class=\"fas fa-arrow-left\"></i> Back to List\n                        </a>\n                    <?php endif; ?>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($action === 'list'): ?>\n                    <!-- User Statistics -->\n                    <div class=\"row mb-4\">\n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= !$_GET['status'] ?? '' ? 'border-accent' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-light mb-0\"><?= array_sum($statusCounts) ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Total Users</p>\n                                        </div>\n                                        <i class=\"fas fa-users fa-2x text-light\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                        \n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?status=active\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= ($_GET['status'] ?? '') === 'active' ? 'border-success' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-success mb-0\"><?= $statusCounts['active'] ?? 0 ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Active</p>\n                                        </div>\n                                        <i class=\"fas fa-user-check fa-2x text-success\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                        \n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?status=suspended\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= ($_GET['status'] ?? '') === 'suspended' ? 'border-warning' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-warning mb-0\"><?= $statusCounts['suspended'] ?? 0 ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Suspended</p>\n                                        </div>\n                                        <i class=\"fas fa-user-clock fa-2x text-warning\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                        \n                        <div class=\"col-lg-3 col-md-6 mb-3\">\n                            <a href=\"?status=banned\" class=\"text-decoration-none\">\n                                <div class=\"gaming-card stat-card <?= ($_GET['status'] ?? '') === 'banned' ? 'border-danger' : '' ?>\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <h4 class=\"text-danger mb-0\"><?= $statusCounts['banned'] ?? 0 ?></h4>\n                                            <p class=\"text-light-50 mb-0\">Banned</p>\n                                        </div>\n                                        <i class=\"fas fa-user-slash fa-2x text-danger\"></i>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                    </div>\n                    \n                    <!-- Search and Filters -->\n                    <div class=\"gaming-card mb-4\">\n                        <form method=\"GET\" class=\"row g-3\">\n                            <div class=\"col-md-6\">\n                                <input type=\"text\" class=\"form-control gaming-input\" name=\"search\" \n                                       value=\"<?= htmlspecialchars($_GET['search'] ?? '') ?>\" \n                                       placeholder=\"Search users by username, email or name...\">\n                            </div>\n                            <div class=\"col-md-3\">\n                                <select class=\"form-control gaming-input\" name=\"status\">\n                                    <option value=\"\">All Status</option>\n                                    <option value=\"active\" <?= ($_GET['status'] ?? '') === 'active' ? 'selected' : '' ?>>Active</option>\n                                    <option value=\"suspended\" <?= ($_GET['status'] ?? '') === 'suspended' ? 'selected' : '' ?>>Suspended</option>\n                                    <option value=\"banned\" <?= ($_GET['status'] ?? '') === 'banned' ? 'selected' : '' ?>>Banned</option>\n                                </select>\n                            </div>\n                            <div class=\"col-md-3\">\n                                <button type=\"submit\" class=\"btn btn-accent w-100\">\n                                    <i class=\"fas fa-search\"></i> Search\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                    \n                    <!-- User List -->\n                    <div class=\"gaming-card\">\n                        <?php if (empty($users)): ?>\n                            <div class=\"text-center text-light-50 py-5\">\n                                <i class=\"fas fa-users fa-4x mb-3\"></i>\n                                <h4>No Users Found</h4>\n                                <p>No users match your search criteria</p>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-dark table-hover\">\n                                    <thead>\n                                        <tr>\n                                            <th>User</th>\n                                            <th>Email</th>\n                                            <th>Status</th>\n                                            <th>Registrations</th>\n                                            <th>Total Spent</th>\n                                            <th>Joined</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($users as $u): ?>\n                                            <tr>\n                                                <td>\n                                                    <div class=\"d-flex align-items-center\">\n                                                        <div class=\"avatar-sm bg-accent text-center rounded me-2\">\n                                                            <i class=\"fas fa-user text-dark\"></i>\n                                                        </div>\n                                                        <div>\n                                                            <strong><?= htmlspecialchars($u['username']) ?></strong>\n                                                            <br><small class=\"text-light-50\"><?= htmlspecialchars($u['full_name']) ?></small>\n                                                        </div>\n                                                    </div>\n                                                </td>\n                                                <td><?= htmlspecialchars($u['email']) ?></td>\n                                                <td>\n                                                    <span class=\"badge bg-<?= $u['status'] === 'active' ? 'success' : ($u['status'] === 'suspended' ? 'warning' : 'danger') ?>\">\n                                                        <?= ucfirst($u['status']) ?>\n                                                    </span>\n                                                </td>\n                                                <td>\n                                                    <span class=\"badge bg-info\"><?= $u['registrations'] ?></span>\n                                                </td>\n                                                <td class=\"text-warning fw-bold\"><?= formatTaka($u['total_spent'] ?? 0) ?></td>\n                                                <td><?= formatDate($u['created_at']) ?></td>\n                                                <td>\n                                                    <div class=\"btn-group\" role=\"group\">\n                                                        <a href=\"?action=view&id=<?= $u['id'] ?>\" class=\"btn btn-sm btn-outline-info\">\n                                                            <i class=\"fas fa-eye\"></i>\n                                                        </a>\n                                                        <div class=\"dropdown\">\n                                                            <button class=\"btn btn-sm btn-outline-secondary dropdown-toggle\" \n                                                                    type=\"button\" data-bs-toggle=\"dropdown\">\n                                                                <i class=\"fas fa-cog\"></i>\n                                                            </button>\n                                                            <ul class=\"dropdown-menu dropdown-menu-dark\">\n                                                                <li><a class=\"dropdown-item\" href=\"?action=update_status&id=<?= $u['id'] ?>\">\n                                                                    <i class=\"fas fa-user-edit\"></i> Update Status\n                                                                </a></li>\n                                                                <li><a class=\"dropdown-item\" href=\"?action=update_wallet&id=<?= $u['id'] ?>\">\n                                                                    <i class=\"fas fa-wallet\"></i> Manage Wallet\n                                                                </a></li>\n                                                            </ul>\n                                                        </div>\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                    \n                <?php elseif ($action === 'view' && $user): ?>\n                    <!-- User Details -->\n                    <div class=\"row\">\n                        <div class=\"col-md-8\">\n                            <div class=\"gaming-card mb-4\">\n                                <h4 class=\"text-accent mb-3\">\n                                    <i class=\"fas fa-user\"></i> User Profile\n                                </h4>\n                                \n                                <div class=\"row\">\n                                    <div class=\"col-md-6\">\n                                        <table class=\"table table-dark\">\n                                            <tr>\n                                                <th>Username:</th>\n                                                <td><?= htmlspecialchars($user['username']) ?></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Full Name:</th>\n                                                <td><?= htmlspecialchars($user['full_name']) ?></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Email:</th>\n                                                <td><?= htmlspecialchars($user['email']) ?></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Phone:</th>\n                                                <td><?= htmlspecialchars($user['phone'] ?? 'Not provided') ?></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Status:</th>\n                                                <td>\n                                                    <span class=\"badge bg-<?= $user['status'] === 'active' ? 'success' : ($user['status'] === 'suspended' ? 'warning' : 'danger') ?>\">\n                                                        <?= ucfirst($user['status']) ?>\n                                                    </span>\n                                                </td>\n                                            </tr>\n                                        </table>\n                                    </div>\n                                    \n                                    <div class=\"col-md-6\">\n                                        <table class=\"table table-dark\">\n                                            <tr>\n                                                <th>Wallet Balance:</th>\n                                                <td class=\"text-success fw-bold\"><?= formatTaka($user['wallet_balance']) ?></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Total Registrations:</th>\n                                                <td><span class=\"badge bg-info\"><?= $user['total_registrations'] ?></span></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Total Payments:</th>\n                                                <td><span class=\"badge bg-warning\"><?= $user['total_payments'] ?></span></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Total Spent:</th>\n                                                <td class=\"text-warning fw-bold\"><?= formatTaka($user['total_spent'] ?? 0) ?></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Joined:</th>\n                                                <td><?= formatDate($user['created_at']) ?></td>\n                                            </tr>\n                                            <tr>\n                                                <th>Last Login:</th>\n                                                <td><?= $user['last_login'] ? formatDate($user['last_login']) : 'Never' ?></td>\n                                            </tr>\n                                        </table>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"col-md-4\">\n                            <div class=\"gaming-card mb-4\">\n                                <h5 class=\"text-accent mb-3\">Quick Actions</h5>\n                                <div class=\"d-grid gap-2\">\n                                    <a href=\"?action=update_status&id=<?= $user['id'] ?>\" class=\"btn btn-warning\">\n                                        <i class=\"fas fa-user-edit\"></i> Update Status\n                                    </a>\n                                    <a href=\"?action=update_wallet&id=<?= $user['id'] ?>\" class=\"btn btn-success\">\n                                        <i class=\"fas fa-wallet\"></i> Manage Wallet\n                                    </a>\n                                    <a href=\"payments.php?user_id=<?= $user['id'] ?>\" class=\"btn btn-info\">\n                                        <i class=\"fas fa-credit-card\"></i> Payment History\n                                    </a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                <?php elseif ($action === 'update_status' && $user): ?>\n                    <!-- Update Status Form -->\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-3\">Update User Status</h4>\n                        <p class=\"text-light-50 mb-4\">User: <strong><?= htmlspecialchars($user['username']) ?></strong></p>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"status\" class=\"form-label text-light\">Status</label>\n                                <select class=\"form-control gaming-input\" id=\"status\" name=\"status\" required>\n                                    <option value=\"active\" <?= $user['status'] === 'active' ? 'selected' : '' ?>>Active</option>\n                                    <option value=\"suspended\" <?= $user['status'] === 'suspended' ? 'selected' : '' ?>>Suspended</option>\n                                    <option value=\"banned\" <?= $user['status'] === 'banned' ? 'selected' : '' ?>>Banned</option>\n                                </select>\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-save\"></i> Update Status\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                    \n                <?php elseif ($action === 'update_wallet' && $user): ?>\n                    <!-- Update Wallet Form -->\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-3\">Manage Wallet Balance</h4>\n                        <p class=\"text-light-50 mb-4\">\n                            User: <strong><?= htmlspecialchars($user['username']) ?></strong><br>\n                            Current Balance: <strong class=\"text-success\"><?= formatTaka($user['wallet_balance']) ?></strong>\n                        </p>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"operation\" class=\"form-label text-light\">Operation</label>\n                                    <select class=\"form-control gaming-input\" id=\"operation\" name=\"operation\" required>\n                                        <option value=\"add\">Add Money</option>\n                                        <option value=\"subtract\">Subtract Money</option>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"amount\" class=\"form-label text-light\">Amount (৳)</label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"amount\" name=\"amount\" \n                                           min=\"0.01\" step=\"0.01\" required>\n                                </div>\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-success\">\n                                    <i class=\"fas fa-wallet\"></i> Update Wallet\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>\n","size_bytes":28110},"api/dashboard_stats.php":{"content":"<?php\nheader('Content-Type: application/json');\nsession_start();\nrequire_once '../config/database.php';\nrequire_once '../includes/auth.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    http_response_code(401);\n    echo json_encode(['error' => 'Unauthorized']);\n    exit;\n}\n\ntry {\n    $database = new Database();\n    $db = $database->getConnection();\n    \n    $user_id = $_SESSION['user_id'];\n    \n    // Get user statistics\n    $stats = [];\n    \n    // Total tournaments registered\n    $stmt = $db->prepare(\"SELECT COUNT(*) as count FROM tournament_registrations WHERE user_id = ?\");\n    $stmt->execute([$user_id]);\n    $stats['tournaments_registered'] = $stmt->fetch()['count'];\n    \n    // Pending payments\n    $stmt = $db->prepare(\"\n        SELECT COUNT(*) as count \n        FROM payments p \n        JOIN tournament_registrations tr ON p.registration_id = tr.id \n        WHERE tr.user_id = ? AND p.status = 'pending'\n    \");\n    $stmt->execute([$user_id]);\n    $stats['pending_payments'] = $stmt->fetch()['count'];\n    \n    // Total matches\n    $stmt = $db->prepare(\"\n        SELECT COUNT(*) as count \n        FROM matches \n        WHERE team1_id = ? OR team2_id = ?\n    \");\n    $stmt->execute([$user_id, $user_id]);\n    $stats['total_matches'] = $stmt->fetch()['count'];\n    \n    // Matches won\n    $stmt = $db->prepare(\"\n        SELECT COUNT(*) as count \n        FROM matches \n        WHERE winner_id = ? AND status = 'completed'\n    \");\n    $stmt->execute([$user_id]);\n    $stats['matches_won'] = $stmt->fetch()['count'];\n    \n    // Wallet balance\n    $stmt = $db->prepare(\"SELECT wallet_balance FROM users WHERE id = ?\");\n    $stmt->execute([$user_id]);\n    $stats['wallet_balance'] = $stmt->fetch()['wallet_balance'];\n    \n    echo json_encode($stats);\n    \n} catch(Exception $e) {\n    http_response_code(500);\n    echo json_encode(['error' => 'Internal server error']);\n}\n?>","size_bytes":1911},"api/get_teams.php":{"content":"<?php\nrequire_once '../config/config.php';\n\nheader('Content-Type: application/json');\n\nif (!isAdminLoggedIn()) {\n    http_response_code(401);\n    echo json_encode(['error' => 'Unauthorized']);\n    exit;\n}\n\n$tournamentId = (int)($_GET['tournament_id'] ?? 0);\n\nif (!$tournamentId) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Tournament ID is required']);\n    exit;\n}\n\ntry {\n    $stmt = $pdo->prepare(\"\n        SELECT u.id, u.username as name, tr.team_name\n        FROM tournament_registrations tr\n        JOIN users u ON tr.user_id = u.id\n        WHERE tr.tournament_id = ? AND tr.status = 'approved'\n        ORDER BY u.username\n    \");\n    $stmt->execute([$tournamentId]);\n    $teams = $stmt->fetchAll();\n    \n    // Format response\n    $formattedTeams = [];\n    foreach ($teams as $team) {\n        $formattedTeams[] = [\n            'id' => $team['id'],\n            'name' => $team['team_name'] ? $team['name'] . ' (' . $team['team_name'] . ')' : $team['name']\n        ];\n    }\n    \n    echo json_encode([\n        'success' => true,\n        'teams' => $formattedTeams\n    ]);\n    \n} catch (PDOException $e) {\n    http_response_code(500);\n    echo json_encode(['error' => 'Database error: ' . $e->getMessage()]);\n}\n?>\n","size_bytes":1237},"api/payment.php":{"content":"<?php\nrequire_once '../config/config.php';\n\nheader('Content-Type: application/json');\n\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    http_response_code(405);\n    echo json_encode(['error' => 'Method not allowed']);\n    exit;\n}\n\nif (!isLoggedIn()) {\n    http_response_code(401);\n    echo json_encode(['error' => 'Unauthorized']);\n    exit;\n}\n\n// Verify CSRF token\nif (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Invalid security token']);\n    exit;\n}\n\n$action = $_POST['action'] ?? '';\n$registrationId = (int)($_POST['registration_id'] ?? 0);\n\ntry {\n    switch ($action) {\n        case 'initiate':\n            // Verify registration belongs to user\n            $stmt = $pdo->prepare(\"\n                SELECT tr.*, t.entry_fee, t.name as tournament_name\n                FROM tournament_registrations tr\n                JOIN tournaments t ON tr.tournament_id = t.id\n                WHERE tr.id = ? AND tr.user_id = ?\n            \");\n            $stmt->execute([$registrationId, $_SESSION['user_id']]);\n            $registration = $stmt->fetch();\n            \n            if (!$registration) {\n                http_response_code(404);\n                echo json_encode(['error' => 'Registration not found']);\n                exit;\n            }\n            \n            // Check if payment already exists\n            $stmt = $pdo->prepare(\"SELECT id FROM payments WHERE registration_id = ?\");\n            $stmt->execute([$registrationId]);\n            \n            if ($stmt->rowCount() > 0) {\n                http_response_code(400);\n                echo json_encode(['error' => 'Payment already initiated']);\n                exit;\n            }\n            \n            // Create payment session\n            $paymentData = [\n                'registration_id' => $registrationId,\n                'amount' => $registration['entry_fee'],\n                'tournament_name' => $registration['tournament_name'],\n                'team_name' => $registration['team_name']\n            ];\n            \n            echo json_encode([\n                'success' => true,\n                'payment_data' => $paymentData,\n                'message' => 'Payment session created'\n            ]);\n            break;\n            \n        case 'verify':\n            $transactionId = sanitizeInput($_POST['transaction_id'] ?? '');\n            $method = sanitizeInput($_POST['method'] ?? '');\n            $phone = sanitizeInput($_POST['phone'] ?? '');\n            \n            if (empty($transactionId) || empty($method) || empty($phone)) {\n                http_response_code(400);\n                echo json_encode(['error' => 'All payment details are required']);\n                exit;\n            }\n            \n            // Get registration details\n            $stmt = $pdo->prepare(\"\n                SELECT tr.*, t.entry_fee\n                FROM tournament_registrations tr\n                JOIN tournaments t ON tr.tournament_id = t.id\n                WHERE tr.id = ? AND tr.user_id = ?\n            \");\n            $stmt->execute([$registrationId, $_SESSION['user_id']]);\n            $registration = $stmt->fetch();\n            \n            if (!$registration) {\n                http_response_code(404);\n                echo json_encode(['error' => 'Registration not found']);\n                exit;\n            }\n            \n            // Create payment record\n            $stmt = $pdo->prepare(\"\n                INSERT INTO payments (registration_id, amount, method, phone, transaction_id, status, created_at)\n                VALUES (?, ?, ?, ?, ?, 'pending', CURRENT_TIMESTAMP)\n            \");\n            $stmt->execute([$registrationId, $registration['entry_fee'], $method, $phone, $transactionId]);\n            \n            echo json_encode([\n                'success' => true,\n                'message' => 'Payment submitted for verification',\n                'payment_id' => $pdo->lastInsertId()\n            ]);\n            break;\n            \n        default:\n            http_response_code(400);\n            echo json_encode(['error' => 'Invalid action']);\n    }\n    \n} catch (PDOException $e) {\n    http_response_code(500);\n    echo json_encode(['error' => 'Database error: ' . $e->getMessage()]);\n} catch (Exception $e) {\n    http_response_code(500);\n    echo json_encode(['error' => 'Server error: ' . $e->getMessage()]);\n}\n?>\n","size_bytes":4390},"api/update_profile.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\n\nheader('Content-Type: application/json');\n\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    http_response_code(405);\n    echo json_encode(['error' => 'Method not allowed']);\n    exit;\n}\n\nif (!isLoggedIn()) {\n    http_response_code(401);\n    echo json_encode(['error' => 'Unauthorized']);\n    exit;\n}\n\n// Verify CSRF token\nif (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Invalid security token']);\n    exit;\n}\n\n$fullName = sanitizeInput($_POST['full_name'] ?? '');\n$phone = sanitizeInput($_POST['phone'] ?? '');\n\nif (empty($fullName)) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Full name is required']);\n    exit;\n}\n\ntry {\n    $auth = new Auth($pdo);\n    $result = $auth->updateProfile($_SESSION['user_id'], [\n        'full_name' => $fullName,\n        'phone' => $phone\n    ]);\n    \n    if ($result['success']) {\n        // Update session data\n        $_SESSION['full_name'] = $fullName;\n        \n        echo json_encode([\n            'success' => true,\n            'message' => $result['message']\n        ]);\n    } else {\n        http_response_code(400);\n        echo json_encode(['error' => $result['message']]);\n    }\n    \n} catch (Exception $e) {\n    http_response_code(500);\n    echo json_encode(['error' => 'Server error: ' . $e->getMessage()]);\n}\n?>\n","size_bytes":1427},"api/upload.php":{"content":"<?php\nrequire_once '../config/config.php';\n\nheader('Content-Type: application/json');\n\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    http_response_code(405);\n    echo json_encode(['error' => 'Method not allowed']);\n    exit;\n}\n\nif (!isLoggedIn()) {\n    http_response_code(401);\n    echo json_encode(['error' => 'Unauthorized']);\n    exit;\n}\n\n// Verify CSRF token\nif (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Invalid security token']);\n    exit;\n}\n\n$matchId = (int)($_POST['match_id'] ?? 0);\n\nif (!$matchId) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Match ID is required']);\n    exit;\n}\n\nif (!isset($_FILES['screenshot']) || $_FILES['screenshot']['error'] !== UPLOAD_ERR_OK) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Valid screenshot file is required']);\n    exit;\n}\n\ntry {\n    // Verify user is participant in this match\n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        WHERE m.id = ? AND (m.team1_id = ? OR m.team2_id = ?) \n        AND m.status IN ('live', 'active')\n    \");\n    $stmt->execute([$matchId, $_SESSION['user_id'], $_SESSION['user_id']]);\n    $match = $stmt->fetch();\n    \n    if (!$match) {\n        http_response_code(404);\n        echo json_encode(['error' => 'Match not found or not accessible']);\n        exit;\n    }\n    \n    // Check if screenshot already uploaded\n    $stmt = $pdo->prepare(\"\n        SELECT id FROM match_screenshots \n        WHERE match_id = ? AND team_id = ?\n    \");\n    $stmt->execute([$matchId, $_SESSION['user_id']]);\n    \n    if ($stmt->rowCount() > 0) {\n        http_response_code(400);\n        echo json_encode(['error' => 'Screenshot already uploaded for this match']);\n        exit;\n    }\n    \n    // Upload screenshot\n    $uploadResult = uploadFile($_FILES['screenshot'], 'screenshots/');\n    \n    if (!$uploadResult['success']) {\n        http_response_code(400);\n        echo json_encode(['error' => $uploadResult['message']]);\n        exit;\n    }\n    \n    // Save screenshot record\n    $stmt = $pdo->prepare(\"\n        INSERT INTO match_screenshots (match_id, team_id, screenshot_url, uploaded_at)\n        VALUES (?, ?, ?, CURRENT_TIMESTAMP)\n    \");\n    $stmt->execute([$matchId, $_SESSION['user_id'], $uploadResult['filename']]);\n    \n    $screenshotId = $pdo->lastInsertId();\n    \n    // Check if both teams have uploaded screenshots\n    $stmt = $pdo->prepare(\"\n        SELECT COUNT(*) as upload_count\n        FROM match_screenshots \n        WHERE match_id = ?\n    \");\n    $stmt->execute([$matchId]);\n    $uploadCount = $stmt->fetchColumn();\n    \n    $matchStatus = 'active';\n    if ($uploadCount >= 2) {\n        // Both teams uploaded, match ready for review\n        $stmt = $pdo->prepare(\"\n            UPDATE matches \n            SET status = 'pending_review' \n            WHERE id = ? AND status IN ('live', 'active')\n        \");\n        $stmt->execute([$matchId]);\n        $matchStatus = 'pending_review';\n    }\n    \n    echo json_encode([\n        'success' => true,\n        'message' => 'Screenshot uploaded successfully',\n        'screenshot_id' => $screenshotId,\n        'filename' => $uploadResult['filename'],\n        'match_status' => $matchStatus,\n        'both_uploaded' => $uploadCount >= 2\n    ]);\n    \n} catch (PDOException $e) {\n    http_response_code(500);\n    echo json_encode(['error' => 'Database error: ' . $e->getMessage()]);\n} catch (Exception $e) {\n    http_response_code(500);\n    echo json_encode(['error' => 'Server error: ' . $e->getMessage()]);\n}\n?>\n","size_bytes":3656},"config/config.php":{"content":"<?php\n// Database configuration\ndefine('DB_HOST', $_ENV['DB_HOST'] ?? 'localhost');\ndefine('DB_NAME', $_ENV['DB_NAME'] ?? 'esports_tournament');\ndefine('DB_USER', $_ENV['DB_USER'] ?? 'root');\ndefine('DB_PASS', $_ENV['DB_PASS'] ?? '');\n\n// Site configuration\ndefine('SITE_URL', $_ENV['SITE_URL'] ?? 'http://localhost:5000');\ndefine('UPLOAD_PATH', __DIR__ . '/../uploads/');\ndefine('MAX_UPLOAD_SIZE', 5 * 1024 * 1024); // 5MB\n\n// Payment configuration\ndefine('BKASH_API_KEY', $_ENV['BKASH_API_KEY'] ?? 'default_bkash_key');\ndefine('NAGAD_API_KEY', $_ENV['NAGAD_API_KEY'] ?? 'default_nagad_key');\n\n// Security\ndefine('CSRF_TOKEN_EXPIRE', 3600); // 1 hour\n\n// Include required files\nrequire_once __DIR__ . '/database.php';\nrequire_once __DIR__ . '/../includes/functions.php';\n\n// Start session if not already started\nif (session_status() == PHP_SESSION_NONE) {\n    session_start();\n}\n\n// Initialize database connection\n$database = new Database();\n$pdo = $database->getConnection();\n\n// Generate CSRF token if not exists\nif (!isset($_SESSION['csrf_token'])) {\n    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));\n    $_SESSION['csrf_token_time'] = time();\n}\n?>\n","size_bytes":1160},"config/database.php":{"content":"<?php\nclass Database {\n    private $host;\n    private $db_name;\n    private $username;\n    private $password;\n    private $conn;\n\n    public function __construct() {\n    $this->host = $_ENV['DB_HOST'] ?? 'localhost';\n    $this->db_name = $_ENV['DB_NAME'] ?? 'esports_tournament';\n    $this->username = $_ENV['DB_USER'] ?? 'root';\n    $this->password = $_ENV['DB_PASSWORD'] ?? '';\n    }\n\n    public function getConnection() {\n        $this->conn = null;\n\n        try {\n            // Use SQLite for development environment\n            $dbPath = __DIR__ . '/../database/esports_tournament.db';\n            $dbDir = dirname($dbPath);\n            \n            // Create directory if it doesn't exist\n            if (!is_dir($dbDir)) {\n                mkdir($dbDir, 0755, true);\n            }\n            \n            $this->conn = new PDO(\n                \"sqlite:\" . $dbPath,\n                null,\n                null,\n                [\n                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n                    PDO::ATTR_EMULATE_PREPARES => false,\n                ]\n            );\n            \n            // Initialize database schema if tables don't exist\n            $this->initializeSchema();\n            \n        } catch(PDOException $exception) {\n            echo \"Connection error: \" . $exception->getMessage();\n        }\n\n        return $this->conn;\n    }\n    \n    private function initializeSchema() {\n        if (!$this->conn) return;\n        \n        // Create tables if they don't exist\n        $tables = [\n            'users' => \"\n                CREATE TABLE IF NOT EXISTS users (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    username VARCHAR(50) UNIQUE NOT NULL,\n                    email VARCHAR(100) UNIQUE NOT NULL,\n                    password VARCHAR(255) NOT NULL,\n                    full_name VARCHAR(100) NOT NULL,\n                    phone VARCHAR(20),\n                    wallet_balance DECIMAL(10,2) DEFAULT 0.00,\n                    is_admin BOOLEAN DEFAULT 0,\n                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n                )\n            \",\n            'tournaments' => \"\n                CREATE TABLE IF NOT EXISTS tournaments (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    name VARCHAR(200) NOT NULL,\n                    description TEXT,\n                    game_type VARCHAR(100) NOT NULL,\n                    max_teams INTEGER NOT NULL,\n                    entry_fee DECIMAL(10,2) DEFAULT 0,\n                    prize_pool DECIMAL(10,2) DEFAULT 0,\n                    winner_prize DECIMAL(10,2) DEFAULT 0,\n                    runner_up_prize DECIMAL(10,2) DEFAULT 0,\n                    third_place_prize DECIMAL(10,2) DEFAULT 0,\n                    start_date DATETIME,\n                    end_date DATETIME,\n                    status VARCHAR(20) DEFAULT 'upcoming',\n                    winner_id INTEGER,\n                    runner_up_id INTEGER,\n                    third_place_id INTEGER,\n                    thumbnail VARCHAR(255),\n                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    FOREIGN KEY (winner_id) REFERENCES users(id),\n                    FOREIGN KEY (runner_up_id) REFERENCES users(id),\n                    FOREIGN KEY (third_place_id) REFERENCES users(id)\n                )\n            \",\n            'tournament_registrations' => \"\n                CREATE TABLE IF NOT EXISTS tournament_registrations (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    tournament_id INTEGER NOT NULL,\n                    user_id INTEGER NOT NULL,\n                    team_name VARCHAR(100) NOT NULL,\n                    status VARCHAR(20) DEFAULT 'pending',\n                    payment_status VARCHAR(20) DEFAULT 'pending',\n                    registered_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    FOREIGN KEY (tournament_id) REFERENCES tournaments(id) ON DELETE CASCADE,\n                    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n                )\n            \",\n            'matches' => \"\n                CREATE TABLE IF NOT EXISTS matches (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    tournament_id INTEGER NOT NULL,\n                    team1_id INTEGER NOT NULL,\n                    team2_id INTEGER NOT NULL,\n                    team1_name VARCHAR(100),\n                    team2_name VARCHAR(100),\n                    status VARCHAR(20) DEFAULT 'scheduled',\n                    score1 INTEGER,\n                    score2 INTEGER,\n                    winner_id INTEGER,\n                    scheduled_at DATETIME,\n                    started_at DATETIME,\n                    completed_at DATETIME,\n                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    FOREIGN KEY (tournament_id) REFERENCES tournaments(id) ON DELETE CASCADE,\n                    FOREIGN KEY (team1_id) REFERENCES users(id),\n                    FOREIGN KEY (team2_id) REFERENCES users(id),\n                    FOREIGN KEY (winner_id) REFERENCES users(id)\n                )\n            \",\n            'match_screenshots' => \"\n                CREATE TABLE IF NOT EXISTS match_screenshots (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    match_id INTEGER NOT NULL,\n                    team_id INTEGER NOT NULL,\n                    screenshot_url VARCHAR(255) NOT NULL,\n                    uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    FOREIGN KEY (match_id) REFERENCES matches(id) ON DELETE CASCADE,\n                    FOREIGN KEY (team_id) REFERENCES users(id) ON DELETE CASCADE,\n                    UNIQUE(match_id, team_id)\n                )\n            \",\n            'withdrawal_requests' => \"\n                CREATE TABLE IF NOT EXISTS withdrawal_requests (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    user_id INTEGER NOT NULL,\n                    amount DECIMAL(10,2) NOT NULL,\n                    payment_method VARCHAR(20) NOT NULL,\n                    account_number VARCHAR(50) NOT NULL,\n                    status VARCHAR(20) DEFAULT 'pending',\n                    admin_notes TEXT,\n                    requested_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    processed_at DATETIME,\n                    processed_by INTEGER,\n                    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n                    FOREIGN KEY (processed_by) REFERENCES users(id)\n                )\n            \",\n            'notifications' => \"\n                CREATE TABLE IF NOT EXISTS notifications (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    user_id INTEGER NOT NULL,\n                    title VARCHAR(200) NOT NULL,\n                    message TEXT NOT NULL,\n                    type VARCHAR(50) DEFAULT 'info',\n                    is_read BOOLEAN DEFAULT 0,\n                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n                )\n            \"\n        ];\n        \n        foreach ($tables as $tableName => $sql) {\n            try {\n                $this->conn->exec($sql);\n            } catch (PDOException $e) {\n                error_log(\"Error creating table $tableName: \" . $e->getMessage());\n            }\n        }\n        \n        // Insert default admin user if not exists\n        try {\n            $stmt = $this->conn->prepare(\"SELECT COUNT(*) FROM users WHERE is_admin = 1\");\n            $stmt->execute();\n            $adminCount = $stmt->fetchColumn();\n            \n            if ($adminCount == 0) {\n                $stmt = $this->conn->prepare(\"\n                    INSERT INTO users (username, email, password, full_name, is_admin) \n                    VALUES (?, ?, ?, ?, ?)\n                \");\n                $stmt->execute(['admin', 'admin@esports.com', '$2y$12$ZEOX1c5l5Y/lx9KWmS4VteQXDQ8q3vPY6ARV0YzF67vMfb4kCniPK', 'Administrator', 1]);\n            }\n        } catch (PDOException $e) {\n            error_log(\"Error creating admin user: \" . $e->getMessage());\n        }\n    }\n}\n?>\n","size_bytes":8414},"includes/auth.php":{"content":"<?php\nrequire_once '../config/config.php';\n\n/**\n * User authentication functions\n */\nclass Auth {\n    private $pdo;\n    \n    public function __construct($pdo) {\n        $this->pdo = $pdo;\n    }\n    \n    /**\n     * Register new user\n     */\n    public function registerUser($username, $email, $password, $fullName) {\n        try {\n            // Check if user already exists\n            $stmt = $this->pdo->prepare(\"SELECT id FROM users WHERE username = ? OR email = ?\");\n            $stmt->execute([$username, $email]);\n            if ($stmt->rowCount() > 0) {\n                return ['success' => false, 'message' => 'Username or email already exists'];\n            }\n            \n            // Create new user\n            $hashedPassword = hashPassword($password);\n            $stmt = $this->pdo->prepare(\"\n                INSERT INTO users (username, email, password, full_name, created_at) \n                VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP)\n            \");\n            $stmt->execute([$username, $email, $hashedPassword, $fullName]);\n            \n            return ['success' => true, 'message' => 'Registration successful'];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Registration failed: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Login user\n     */\n    public function loginUser($username, $password) {\n        try {\n            $stmt = $this->pdo->prepare(\"\n                SELECT id, username, email, password, full_name \n                FROM users \n                WHERE (username = ? OR email = ?)\n            \");\n            $stmt->execute([$username, $username]);\n            $user = $stmt->fetch();\n            \n            if ($user && verifyPassword($password, $user['password'])) {\n                $_SESSION['user_id'] = $user['id'];\n                $_SESSION['username'] = $user['username'];\n                $_SESSION['email'] = $user['email'];\n                $_SESSION['full_name'] = $user['full_name'];\n                \n                // Update last login (only if last_login column exists)\n                try {\n                    $stmt = $this->pdo->prepare(\"UPDATE users SET updated_at = CURRENT_TIMESTAMP WHERE id = ?\");\n                    $stmt->execute([$user['id']]);\n                } catch (PDOException $e) {\n                    // Ignore if column doesn't exist\n                }\n                \n                return ['success' => true, 'message' => 'Login successful'];\n            }\n            \n            return ['success' => false, 'message' => 'Invalid credentials'];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Login failed: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Login admin\n     */\n    public function loginAdmin($username, $password) {\n        try {\n            $stmt = $this->pdo->prepare(\"\n                SELECT id, username, email, password, full_name, is_admin \n                FROM users \n                WHERE (username = ? OR email = ?) AND is_admin = 1\n            \");\n            $stmt->execute([$username, $username]);\n            $admin = $stmt->fetch();\n            \n            if ($admin && password_verify($password, $admin['password'])) {\n                $_SESSION['admin_id'] = $admin['id'];\n                $_SESSION['admin_username'] = $admin['username'];\n                $_SESSION['admin_email'] = $admin['email'];\n                $_SESSION['admin_name'] = $admin['full_name'];\n                $_SESSION['is_admin'] = true;\n                \n                return ['success' => true, 'message' => 'Admin login successful'];\n            }\n            \n            return ['success' => false, 'message' => 'Invalid admin credentials'];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Admin login failed: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Logout user\n     */\n    public function logout() {\n        session_destroy();\n        return ['success' => true, 'message' => 'Logged out successfully'];\n    }\n    \n    /**\n     * Get user data\n     */\n    public function getUserData($userId) {\n        try {\n            $stmt = $this->pdo->prepare(\"\n                SELECT id, username, email, full_name, phone, avatar, \n                       wallet_balance, created_at, last_login\n                FROM users \n                WHERE id = ?\n            \");\n            $stmt->execute([$userId]);\n            return $stmt->fetch();\n        } catch (PDOException $e) {\n            return null;\n        }\n    }\n    \n    /**\n     * Update user profile\n     */\n    public function updateProfile($userId, $data) {\n        try {\n            $fields = [];\n            $values = [];\n            \n            foreach ($data as $field => $value) {\n                if (in_array($field, ['full_name', 'phone', 'avatar'])) {\n                    $fields[] = \"$field = ?\";\n                    $values[] = $value;\n                }\n            }\n            \n            if (empty($fields)) {\n                return ['success' => false, 'message' => 'No valid fields to update'];\n            }\n            \n            $values[] = $userId;\n            $sql = \"UPDATE users SET \" . implode(', ', $fields) . \" WHERE id = ?\";\n            $stmt = $this->pdo->prepare($sql);\n            $stmt->execute($values);\n            \n            return ['success' => true, 'message' => 'Profile updated successfully'];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Update failed: ' . $e->getMessage()];\n        }\n    }\n}\n?>\n","size_bytes":5596},"includes/functions.php":{"content":"<?php\n/**\n * Common utility functions\n */\n\n/**\n * Generate CSRF token\n */\nfunction generateCSRFToken() {\n    if (!isset($_SESSION['csrf_token']) || \n        (isset($_SESSION['csrf_token_time']) && time() - $_SESSION['csrf_token_time'] > CSRF_TOKEN_EXPIRE)) {\n        $_SESSION['csrf_token'] = bin2hex(random_bytes(32));\n        $_SESSION['csrf_token_time'] = time();\n    }\n    return $_SESSION['csrf_token'];\n}\n\n/**\n * Verify CSRF token\n */\nfunction verifyCSRFToken($token) {\n    return isset($_SESSION['csrf_token']) && \n           hash_equals($_SESSION['csrf_token'], $token) &&\n           isset($_SESSION['csrf_token_time']) && \n           time() - $_SESSION['csrf_token_time'] <= CSRF_TOKEN_EXPIRE;\n}\n\n/**\n * Sanitize input\n */\nfunction sanitizeInput($input) {\n    return htmlspecialchars(strip_tags(trim($input)), ENT_QUOTES, 'UTF-8');\n}\n\n/**\n * Validate email\n */\nfunction validateEmail($email) {\n    return filter_var($email, FILTER_VALIDATE_EMAIL);\n}\n\n/**\n * Hash password\n */\nfunction hashPassword($password) {\n    return password_hash($password, PASSWORD_DEFAULT);\n}\n\n/**\n * Verify password\n */\nfunction verifyPassword($password, $hash) {\n    return password_verify($password, $hash);\n}\n\n/**\n * Format currency in Taka\n */\nfunction formatTaka($amount) {\n    return '৳' . number_format($amount, 2);\n}\n\n/**\n * Generate unique filename\n */\nfunction generateUniqueFilename($originalName) {\n    $extension = pathinfo($originalName, PATHINFO_EXTENSION);\n    return uniqid() . '_' . time() . '.' . $extension;\n}\n\n/**\n * Check if file is valid image\n */\nfunction isValidImage($file) {\n    $allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\n    $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];\n    \n    $fileType = $file['type'];\n    $fileName = $file['name'];\n    $fileSize = $file['size'];\n    $extension = strtolower(pathinfo($fileName, PATHINFO_EXTENSION));\n    \n    return in_array($fileType, $allowedTypes) && \n           in_array($extension, $allowedExtensions) && \n           $fileSize <= MAX_UPLOAD_SIZE;\n}\n\n/**\n * Upload file\n */\nfunction uploadFile($file, $directory = 'uploads/') {\n    if (!isValidImage($file)) {\n        return ['success' => false, 'message' => 'Invalid file type or size too large (max 5MB)'];\n    }\n    \n    $uploadDir = UPLOAD_PATH . $directory;\n    if (!is_dir($uploadDir)) {\n        mkdir($uploadDir, 0755, true);\n    }\n    \n    $fileName = generateUniqueFilename($file['name']);\n    $uploadPath = $uploadDir . $fileName;\n    \n    if (move_uploaded_file($file['tmp_name'], $uploadPath)) {\n        return ['success' => true, 'filename' => $fileName, 'path' => $directory . $fileName];\n    }\n    \n    return ['success' => false, 'message' => 'Upload failed'];\n}\n\n/**\n * Redirect with message\n */\nfunction redirect($url, $message = '', $type = 'info') {\n    if ($message) {\n        $_SESSION['flash_message'] = $message;\n        $_SESSION['flash_type'] = $type;\n    }\n    header('Location: ' . $url);\n    exit();\n}\n\n/**\n * Get flash message\n */\nfunction getFlashMessage() {\n    if (isset($_SESSION['flash_message'])) {\n        $message = $_SESSION['flash_message'];\n        $type = $_SESSION['flash_type'] ?? 'info';\n        unset($_SESSION['flash_message'], $_SESSION['flash_type']);\n        return ['message' => $message, 'type' => $type];\n    }\n    return null;\n}\n\n/**\n * Check if user is logged in\n */\nfunction isLoggedIn() {\n    return isset($_SESSION['user_id']);\n}\n\n/**\n * Check if admin is logged in\n */\nfunction isAdminLoggedIn() {\n    return isset($_SESSION['admin_id']);\n}\n\n/**\n * Require login\n */\nfunction requireLogin($redirectUrl = 'user/login.php') {\n    if (!isLoggedIn()) {\n        redirect($redirectUrl, 'Please login to access this page', 'warning');\n    }\n}\n\n/**\n * Require admin login\n */\nfunction requireAdminLogin($redirectUrl = 'admin/login.php') {\n    if (!isAdminLoggedIn()) {\n        redirect($redirectUrl, 'Please login as admin to access this page', 'warning');\n    }\n}\n\n/**\n * Format date\n */\nfunction formatDate($date, $format = 'M d, Y H:i') {\n    return date($format, strtotime($date));\n}\n\n/**\n * Time ago function\n */\nfunction timeAgo($datetime) {\n    $time = time() - strtotime($datetime);\n    \n    if ($time < 60) return 'just now';\n    if ($time < 3600) return floor($time/60) . ' minutes ago';\n    if ($time < 86400) return floor($time/3600) . ' hours ago';\n    if ($time < 2592000) return floor($time/86400) . ' days ago';\n    \n    return date('M d, Y', strtotime($datetime));\n}\n?>\n","size_bytes":4489},"includes/navbar.php":{"content":"<nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n    <div class=\"container-fluid\">\n        <a class=\"navbar-brand fw-bold\" href=\"dashboard.php\">\n            <i class=\"fas fa-shield-alt text-accent\"></i> Admin Panel\n        </a>\n        <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n            <span class=\"navbar-toggler-icon\"></span>\n        </button>\n        <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n            <ul class=\"navbar-nav me-auto\">\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"dashboard.php\">\n                        <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"tournaments.php\">\n                        <i class=\"fas fa-trophy\"></i> Tournaments\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"registrations.php\">\n                        <i class=\"fas fa-user-check\"></i> Registrations\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"users.php\">\n                        <i class=\"fas fa-users\"></i> Users\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"matches.php\">\n                        <i class=\"fas fa-gamepad\"></i> Matches\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"results.php\">\n                        <i class=\"fas fa-trophy-star\"></i> Results\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"payments.php\">\n                        <i class=\"fas fa-credit-card\"></i> Payments\n                    </a>\n                </li>\n            </ul>\n            <ul class=\"navbar-nav\">\n                <li class=\"nav-item dropdown\">\n                    <a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"navbarDropdown\" role=\"button\" data-bs-toggle=\"dropdown\">\n                        <i class=\"fas fa-user-circle\"></i> <?= htmlspecialchars($_SESSION['admin_username'] ?? 'Admin') ?>\n                    </a>\n                    <ul class=\"dropdown-menu\">\n                        <li><a class=\"dropdown-item\" href=\"../index.php\"><i class=\"fas fa-home\"></i> View Site</a></li>\n                        <li><hr class=\"dropdown-divider\"></li>\n                        <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                    </ul>\n                </li>\n            </ul>\n        </div>\n    </div>\n</nav>","size_bytes":2845},"includes/sidebar.php":{"content":"<div class=\"col-lg-3 col-xl-2 d-none d-lg-block\">\n    <div class=\"gaming-card\">\n        <h6 class=\"text-accent mb-3\"><i class=\"fas fa-bars\"></i> Admin Menu</h6>\n        <nav class=\"nav flex-column\">\n            <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'dashboard.php' ? 'active' : '' ?>\" href=\"dashboard.php\">\n                <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n            </a>\n            <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'tournaments.php' ? 'active' : '' ?>\" href=\"tournaments.php\">\n                <i class=\"fas fa-trophy\"></i> Tournaments\n            </a>\n            <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'registrations.php' ? 'active' : '' ?>\" href=\"registrations.php\">\n                <i class=\"fas fa-user-check\"></i> Registrations\n            </a>\n            <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'users.php' ? 'active' : '' ?>\" href=\"users.php\">\n                <i class=\"fas fa-users\"></i> Users\n            </a>\n            <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'matches.php' ? 'active' : '' ?>\" href=\"matches.php\">\n                <i class=\"fas fa-gamepad\"></i> Matches\n            </a>\n            <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'results.php' ? 'active' : '' ?>\" href=\"results.php\">\n                <i class=\"fas fa-trophy-star\"></i> Results\n            </a>\n            <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'payments.php' ? 'active' : '' ?>\" href=\"payments.php\">\n                <i class=\"fas fa-credit-card\"></i> Payments\n            </a>\n        </nav>\n        \n        <hr class=\"my-3\">\n        \n        <div class=\"text-center\">\n            <h6 class=\"text-light-50 small mb-2\">Quick Stats</h6>\n            <div class=\"row text-center\">\n                <div class=\"col-6\">\n                    <div class=\"text-accent fw-bold\" id=\"quick-tournaments\">-</div>\n                    <small class=\"text-light-50\">Tournaments</small>\n                </div>\n                <div class=\"col-6\">\n                    <div class=\"text-success fw-bold\" id=\"quick-users\">-</div>\n                    <small class=\"text-light-50\">Users</small>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>","size_bytes":2284},"user/dashboard.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireLogin();\n\n// Get user statistics\ntry {\n    $userId = $_SESSION['user_id'];\n    \n    // Get user profile\n    $stmt = $pdo->prepare(\"SELECT * FROM users WHERE id = ?\");\n    $stmt->execute([$userId]);\n    $userProfile = $stmt->fetch();\n    \n    // Get tournament registrations\n    $stmt = $pdo->prepare(\"\n        SELECT tr.*, t.name as tournament_name, t.status as tournament_status, \n               t.start_date, t.entry_fee, t.prize_pool\n        FROM tournament_registrations tr\n        JOIN tournaments t ON tr.tournament_id = t.id\n        WHERE tr.user_id = ?\n        ORDER BY tr.created_at DESC\n        LIMIT 5\n    \");\n    $stmt->execute([$userId]);\n    $recentRegistrations = $stmt->fetchAll();\n    \n    // Get upcoming matches\n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name,\n               u1.username as team1_name, u2.username as team2_name\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        WHERE (m.team1_id = ? OR m.team2_id = ?) \n        AND m.status IN ('scheduled', 'live')\n        ORDER BY m.scheduled_date ASC\n        LIMIT 5\n    \");\n    $stmt->execute([$userId, $userId]);\n    $upcomingMatches = $stmt->fetchAll();\n    \n    // Get statistics\n    $stmt = $pdo->prepare(\"\n        SELECT \n            COUNT(DISTINCT tr.id) as total_registrations,\n            COUNT(DISTINCT CASE WHEN tr.status = 'approved' THEN tr.id END) as approved_registrations,\n            COUNT(DISTINCT m.id) as total_matches,\n            COUNT(DISTINCT CASE WHEN m.winner_id = ? THEN m.id END) as won_matches,\n            SUM(DISTINCT CASE WHEN p.status = 'completed' THEN p.amount ELSE 0 END) as total_spent\n        FROM tournament_registrations tr\n        LEFT JOIN payments p ON tr.id = p.registration_id\n        LEFT JOIN matches m ON (m.team1_id = ? OR m.team2_id = ?) AND m.status = 'completed'\n        WHERE tr.user_id = ?\n    \");\n    $stmt->execute([$userId, $userId, $userId, $userId]);\n    $stats = $stmt->fetch();\n    \n    // Get pending payments\n    $stmt = $pdo->prepare(\"\n        SELECT COUNT(*) as pending_payments\n        FROM payments p\n        JOIN tournament_registrations tr ON p.registration_id = tr.id\n        WHERE tr.user_id = ? AND p.status = 'pending'\n    \");\n    $stmt->execute([$userId]);\n    $pendingPayments = $stmt->fetchColumn();\n    \n} catch (PDOException $e) {\n    $userProfile = null;\n    $recentRegistrations = [];\n    $upcomingMatches = [];\n    $stats = ['total_registrations' => 0, 'approved_registrations' => 0, 'total_matches' => 0, 'won_matches' => 0, 'total_spent' => 0];\n    $pendingPayments = 0;\n}\n\n$flash = getFlashMessage();\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Dashboard - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n        <div class=\"container\">\n            <a class=\"navbar-brand fw-bold\" href=\"../index.php\">\n                <i class=\"fas fa-trophy text-accent\"></i> eSports Hub\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav me-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link active\" href=\"dashboard.php\">\n                            <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"tournaments.php\">\n                            <i class=\"fas fa-trophy\"></i> Tournaments\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"matches.php\">\n                            <i class=\"fas fa-gamepad\"></i> Matches\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"payments.php\">\n                            <i class=\"fas fa-credit-card\"></i> Payments\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"withdraw.php\">\n                            <i class=\"fas fa-money-bill-wave\"></i> Withdraw Money\n                        </a>\n                    </li>\n                </ul>\n                <ul class=\"navbar-nav\">\n                    <li class=\"nav-item dropdown\">\n                        <a class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n                            <i class=\"fas fa-user\"></i> <?= htmlspecialchars($_SESSION['username']) ?>\n                        </a>\n                        <ul class=\"dropdown-menu dropdown-menu-dark\">\n                            <li><a class=\"dropdown-item\" href=\"#\" data-bs-toggle=\"modal\" data-bs-target=\"#profileModal\">\n                                <i class=\"fas fa-user-edit\"></i> Profile\n                            </a></li>\n                            <li><hr class=\"dropdown-divider\"></li>\n                            <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                        </ul>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    \n    <div class=\"container my-4\">\n        <?php if ($flash): ?>\n            <div class=\"alert alert-<?= $flash['type'] === 'success' ? 'success' : 'danger' ?>\">\n                <?= htmlspecialchars($flash['message']) ?>\n            </div>\n        <?php endif; ?>\n        \n        <!-- Welcome Section -->\n        <div class=\"gaming-card mb-4\">\n            <div class=\"row align-items-center\">\n                <div class=\"col-md-8\">\n                    <h2 class=\"text-accent mb-2\">\n                        Welcome back, <?= htmlspecialchars($_SESSION['username']) ?>!\n                    </h2>\n                    <p class=\"text-light-50 mb-0\">\n                        Ready for your next gaming challenge? Check out the latest tournaments and matches.\n                    </p>\n                </div>\n                <div class=\"col-md-4 text-end\">\n                    <div class=\"wallet-display\">\n                        <div class=\"text-light-50\">Wallet Balance</div>\n                        <div class=\"text-success fs-4 fw-bold\">\n                            <?= formatTaka($userProfile['wallet_balance'] ?? 0) ?>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Statistics Cards -->\n        <div class=\"row mb-4\">\n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"gaming-card stat-card\">\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <div>\n                            <h3 class=\"text-accent mb-0\"><?= $stats['total_registrations'] ?></h3>\n                            <p class=\"text-light-50 mb-0\">Total Registrations</p>\n                        </div>\n                        <i class=\"fas fa-user-plus fa-2x text-accent\"></i>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"gaming-card stat-card\">\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <div>\n                            <h3 class=\"text-success mb-0\"><?= $stats['approved_registrations'] ?></h3>\n                            <p class=\"text-light-50 mb-0\">Active Tournaments</p>\n                        </div>\n                        <i class=\"fas fa-check-circle fa-2x text-success\"></i>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"gaming-card stat-card\">\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <div>\n                            <h3 class=\"text-info mb-0\"><?= $stats['won_matches'] ?>/<?= $stats['total_matches'] ?></h3>\n                            <p class=\"text-light-50 mb-0\">Matches Won</p>\n                        </div>\n                        <i class=\"fas fa-trophy fa-2x text-warning\"></i>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"gaming-card stat-card\">\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <div>\n                            <h3 class=\"text-warning mb-0\"><?= formatTaka($stats['total_spent']) ?></h3>\n                            <p class=\"text-light-50 mb-0\">Total Spent</p>\n                        </div>\n                        <i class=\"fas fa-coins fa-2x text-warning\"></i>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"row\">\n            <!-- Recent Registrations -->\n            <div class=\"col-lg-8 mb-4\">\n                <div class=\"gaming-card\">\n                    <div class=\"d-flex justify-content-between align-items-center mb-3\">\n                        <h4 class=\"text-accent mb-0\">\n                            <i class=\"fas fa-trophy\"></i> Recent Tournament Registrations\n                        </h4>\n                        <a href=\"tournaments.php\" class=\"btn btn-sm btn-outline-accent\">\n                            View All\n                        </a>\n                    </div>\n                    \n                    <?php if (empty($recentRegistrations)): ?>\n                        <div class=\"text-center text-light-50 py-4\">\n                            <i class=\"fas fa-trophy fa-3x mb-3\"></i>\n                            <h5>No Tournament Registrations Yet</h5>\n                            <p>Join your first tournament to get started!</p>\n                            <a href=\"tournaments.php\" class=\"btn btn-accent\">\n                                <i class=\"fas fa-plus\"></i> Browse Tournaments\n                            </a>\n                        </div>\n                    <?php else: ?>\n                        <div class=\"table-responsive\">\n                            <table class=\"table table-dark table-hover\">\n                                <thead>\n                                    <tr>\n                                        <th>Tournament</th>\n                                        <th>Status</th>\n                                        <th>Entry Fee</th>\n                                        <th>Prize Pool</th>\n                                        <th>Date</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    <?php foreach ($recentRegistrations as $reg): ?>\n                                        <tr>\n                                            <td>\n                                                <strong><?= htmlspecialchars($reg['tournament_name']) ?></strong>\n                                                <br><small class=\"text-light-50\">Team: <?= htmlspecialchars($reg['team_name']) ?></small>\n                                            </td>\n                                            <td>\n                                                <span class=\"badge bg-<?= $reg['status'] === 'approved' ? 'success' : ($reg['status'] === 'pending' ? 'warning' : 'danger') ?>\">\n                                                    <?= ucfirst($reg['status']) ?>\n                                                </span>\n                                            </td>\n                                            <td><?= formatTaka($reg['entry_fee']) ?></td>\n                                            <td class=\"text-warning fw-bold\"><?= formatTaka($reg['prize_pool']) ?></td>\n                                            <td><?= timeAgo($reg['created_at']) ?></td>\n                                        </tr>\n                                    <?php endforeach; ?>\n                                </tbody>\n                            </table>\n                        </div>\n                    <?php endif; ?>\n                </div>\n            </div>\n            \n            <!-- Quick Actions & Upcoming Matches -->\n            <div class=\"col-lg-4\">\n                <!-- Quick Actions -->\n                <div class=\"gaming-card mb-4\">\n                    <h5 class=\"text-accent mb-3\">\n                        <i class=\"fas fa-bolt\"></i> Quick Actions\n                    </h5>\n                    \n                    <div class=\"d-grid gap-2\">\n                        <a href=\"tournaments.php\" class=\"btn btn-accent\">\n                            <i class=\"fas fa-trophy\"></i> Join Tournament\n                        </a>\n                        \n                        <?php if ($pendingPayments > 0): ?>\n                            <a href=\"payments.php\" class=\"btn btn-warning\">\n                                <i class=\"fas fa-exclamation-triangle\"></i> Pending Payments\n                                <span class=\"badge bg-danger\"><?= $pendingPayments ?></span>\n                            </a>\n                        <?php endif; ?>\n                        \n                        <a href=\"upload.php\" class=\"btn btn-info\">\n                            <i class=\"fas fa-upload\"></i> Upload Match Screenshot\n                        </a>\n                        \n                        <a href=\"matches.php\" class=\"btn btn-success\">\n                            <i class=\"fas fa-gamepad\"></i> My Matches\n                        </a>\n                    </div>\n                </div>\n                \n                <!-- Upcoming Matches -->\n                <div class=\"gaming-card\">\n                    <h5 class=\"text-accent mb-3\">\n                        <i class=\"fas fa-clock\"></i> Upcoming Matches\n                    </h5>\n                    \n                    <?php if (empty($upcomingMatches)): ?>\n                        <div class=\"text-center text-light-50 py-3\">\n                            <i class=\"fas fa-gamepad fa-2x mb-2\"></i>\n                            <p class=\"small mb-0\">No upcoming matches</p>\n                        </div>\n                    <?php else: ?>\n                        <?php foreach ($upcomingMatches as $match): ?>\n                            <div class=\"match-card mb-3\">\n                                <div class=\"d-flex justify-content-between align-items-center mb-2\">\n                                    <small class=\"text-light-50\"><?= htmlspecialchars($match['tournament_name']) ?></small>\n                                    <span class=\"badge bg-<?= $match['status'] === 'live' ? 'danger' : 'info' ?>\">\n                                        <?= ucfirst($match['status']) ?>\n                                    </span>\n                                </div>\n                                <div class=\"d-flex align-items-center justify-content-between\">\n                                    <span class=\"badge bg-info\"><?= htmlspecialchars($match['team1_name']) ?></span>\n                                    <i class=\"fas fa-vs text-accent mx-2\"></i>\n                                    <span class=\"badge bg-warning\"><?= htmlspecialchars($match['team2_name']) ?></span>\n                                </div>\n                                <div class=\"text-center mt-2\">\n                                    <small class=\"text-light-50\">\n                                        <?= formatDate($match['scheduled_date']) ?>\n                                    </small>\n                                </div>\n                            </div>\n                        <?php endforeach; ?>\n                    <?php endif; ?>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Profile Modal -->\n    <div class=\"modal fade\" id=\"profileModal\" tabindex=\"-1\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content bg-secondary\">\n                <div class=\"modal-header border-0\">\n                    <h5 class=\"modal-title text-accent\">\n                        <i class=\"fas fa-user-edit\"></i> Update Profile\n                    </h5>\n                    <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n                </div>\n                <div class=\"modal-body\">\n                    <form id=\"profileForm\" action=\"../api/update_profile.php\" method=\"POST\">\n                        <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"full_name\" class=\"form-label text-light\">Full Name</label>\n                            <input type=\"text\" class=\"form-control gaming-input\" id=\"full_name\" name=\"full_name\" \n                                   value=\"<?= htmlspecialchars($userProfile['full_name'] ?? '') ?>\">\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"phone\" class=\"form-label text-light\">Phone Number</label>\n                            <input type=\"tel\" class=\"form-control gaming-input\" id=\"phone\" name=\"phone\" \n                                   value=\"<?= htmlspecialchars($userProfile['phone'] ?? '') ?>\">\n                        </div>\n                        \n                        <div class=\"text-end\">\n                            <button type=\"button\" class=\"btn btn-secondary me-2\" data-bs-dismiss=\"modal\">Cancel</button>\n                            <button type=\"submit\" class=\"btn btn-accent\">\n                                <i class=\"fas fa-save\"></i> Update Profile\n                            </button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>\n","size_bytes":18957},"user/index.php":{"content":"<?php\nrequire_once '../config/config.php';\nredirect('dashboard.php');\n?>\n","size_bytes":73},"user/login.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\n\n// Redirect if already logged in\nif (isLoggedIn()) {\n    redirect('dashboard.php');\n}\n\n$error = '';\n$success = '';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $username = sanitizeInput($_POST['username'] ?? '');\n        $password = $_POST['password'] ?? '';\n        \n        if (empty($username) || empty($password)) {\n            $error = 'All fields are required';\n        } else {\n            $auth = new Auth($pdo);\n            $result = $auth->loginUser($username, $password);\n            \n            if ($result['success']) {\n                redirect('dashboard.php', $result['message'], 'success');\n            } else {\n                $error = $result['message'];\n            }\n        }\n    }\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Login - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body class=\"auth-page\">\n    <div class=\"container-fluid h-100\">\n        <div class=\"row h-100\">\n            <div class=\"col-lg-6 d-none d-lg-flex align-items-center justify-content-center bg-primary\">\n                <div class=\"text-center text-light\">\n                    <i class=\"fas fa-gamepad display-1 text-accent mb-4\"></i>\n                    <h2 class=\"mb-3\">Welcome Back, Gamer!</h2>\n                    <p class=\"lead\">Join epic tournaments and claim your victories</p>\n                    <div class=\"mt-4\">\n                        <div class=\"row\">\n                            <div class=\"col-4\">\n                                <i class=\"fas fa-trophy fa-2x text-warning mb-2\"></i>\n                                <p class=\"small\">Tournaments</p>\n                            </div>\n                            <div class=\"col-4\">\n                                <i class=\"fas fa-users fa-2x text-success mb-2\"></i>\n                                <p class=\"small\">Community</p>\n                            </div>\n                            <div class=\"col-4\">\n                                <i class=\"fas fa-coins fa-2x text-accent mb-2\"></i>\n                                <p class=\"small\">Prizes</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-lg-6 d-flex align-items-center justify-content-center\">\n                <div class=\"w-100\" style=\"max-width: 400px;\">\n                    <div class=\"gaming-card\">\n                        <div class=\"text-center mb-4\">\n                            <h3 class=\"text-accent\">\n                                <i class=\"fas fa-sign-in-alt\"></i> Player Login\n                            </h3>\n                        </div>\n                        \n                        <?php if ($error): ?>\n                            <div class=\"alert alert-danger\">\n                                <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                            </div>\n                        <?php endif; ?>\n                        \n                        <?php if ($success): ?>\n                            <div class=\"alert alert-success\">\n                                <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                            </div>\n                        <?php endif; ?>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"username\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-user\"></i> Username or Email\n                                </label>\n                                <input type=\"text\" class=\"form-control gaming-input\" id=\"username\" \n                                       name=\"username\" required>\n                            </div>\n                            \n                            <div class=\"mb-4\">\n                                <label for=\"password\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-lock\"></i> Password\n                                </label>\n                                <input type=\"password\" class=\"form-control gaming-input\" id=\"password\" \n                                       name=\"password\" required>\n                            </div>\n                            \n                            <button type=\"submit\" class=\"btn btn-accent w-100 mb-3\">\n                                <i class=\"fas fa-gamepad\"></i> Start Gaming\n                            </button>\n                        </form>\n                        \n                        <div class=\"text-center\">\n                            <p class=\"text-light-50 mb-2\">New to eSports?</p>\n                            <a href=\"register.php\" class=\"text-accent\">\n                                <i class=\"fas fa-user-plus\"></i> Create Account\n                            </a>\n                        </div>\n                        \n                        <div class=\"text-center mt-3\">\n                            <a href=\"../index.php\" class=\"text-light-50\">\n                                <i class=\"fas fa-arrow-left\"></i> Back to Home\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n","size_bytes":6395},"user/logout.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\n\n$auth = new Auth($pdo);\n$result = $auth->logout();\n\nredirect('../index.php', $result['message'], 'success');\n?>\n","size_bytes":193},"user/matches.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireLogin();\n\n$action = $_GET['action'] ?? 'list';\n$matchId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle screenshot upload\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['upload_screenshot'])) {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $uploadMatchId = (int)($_POST['match_id'] ?? 0);\n        \n        // Verify user is part of this match\n        $stmt = $pdo->prepare(\"\n            SELECT id FROM matches \n            WHERE id = ? AND (team1_id = ? OR team2_id = ?)\n        \");\n        $stmt->execute([$uploadMatchId, $_SESSION['user_id'], $_SESSION['user_id']]);\n        $validMatch = $stmt->fetch();\n        \n        if ($validMatch && isset($_FILES['screenshot']) && $_FILES['screenshot']['error'] === UPLOAD_ERR_OK) {\n            $uploadDir = '../assets/images/screenshots/';\n            if (!is_dir($uploadDir)) {\n                mkdir($uploadDir, 0755, true);\n            }\n            \n            $fileInfo = pathinfo($_FILES['screenshot']['name']);\n            $fileName = 'match_' . $uploadMatchId . '_user_' . $_SESSION['user_id'] . '_' . time() . '.' . $fileInfo['extension'];\n            $uploadPath = $uploadDir . $fileName;\n            $screenshotPath = 'assets/images/screenshots/' . $fileName;\n            \n            // Validate file\n            $allowedTypes = ['jpg', 'jpeg', 'png', 'gif', 'webp'];\n            if (in_array(strtolower($fileInfo['extension']), $allowedTypes) && $_FILES['screenshot']['size'] <= 5242880) {\n                if (move_uploaded_file($_FILES['screenshot']['tmp_name'], $uploadPath)) {\n                    // Save to database\n                    try {\n                        $stmt = $pdo->prepare(\"\n                            INSERT INTO match_screenshots (match_id, team_id, screenshot_url, uploaded_at)\n                            VALUES (?, ?, ?, CURRENT_TIMESTAMP)\n                            ON CONFLICT (match_id, team_id) \n                            DO UPDATE SET screenshot_url = EXCLUDED.screenshot_url, uploaded_at = EXCLUDED.uploaded_at\n                        \");\n                        $stmt->execute([$uploadMatchId, $_SESSION['user_id'], $screenshotPath]);\n                        $success = 'Screenshot uploaded successfully!';\n                    } catch (PDOException $e) {\n                        $error = 'Failed to save screenshot: ' . $e->getMessage();\n                    }\n                } else {\n                    $error = 'Failed to upload screenshot';\n                }\n            } else {\n                $error = 'Invalid file type or size too large (max 5MB)';\n            }\n        } else {\n            $error = 'Invalid match or no file selected';\n        }\n    }\n}\n\n// Get user matches\n$userId = $_SESSION['user_id'];\n\nif ($action === 'list') {\n    $status = sanitizeInput($_GET['status'] ?? '');\n    \n    $whereClause = 'WHERE (m.team1_id = ? OR m.team2_id = ?)';\n    $params = [$userId, $userId];\n    \n    if ($status) {\n        $whereClause .= ' AND m.status = ?';\n        $params[] = $status;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name, t.game_type,\n               u1.username as team1_name, u2.username as team2_name,\n               uw.username as winner_name,\n               ms1.screenshot_url as team1_screenshot,\n               ms2.screenshot_url as team2_screenshot\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        LEFT JOIN users uw ON m.winner_id = uw.id\n        LEFT JOIN match_screenshots ms1 ON m.id = ms1.match_id AND ms1.team_id = u1.id\n        LEFT JOIN match_screenshots ms2 ON m.id = ms2.match_id AND ms2.team_id = u2.id\n        $whereClause\n        ORDER BY m.scheduled_date DESC, m.created_at DESC\n    \");\n    $stmt->execute($params);\n    $matches = $stmt->fetchAll();\n}\n\n// Get match details\n$match = null;\nif (($action === 'view' || $action === 'upload') && $matchId) {\n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name, t.game_type,\n               u1.username as team1_name, u2.username as team2_name,\n               uw.username as winner_name,\n               ms1.screenshot_url as team1_screenshot, ms1.uploaded_at as team1_upload_time,\n               ms2.screenshot_url as team2_screenshot, ms2.uploaded_at as team2_upload_time\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        LEFT JOIN users uw ON m.winner_id = uw.id\n        LEFT JOIN match_screenshots ms1 ON m.id = ms1.match_id AND ms1.team_id = u1.id\n        LEFT JOIN match_screenshots ms2 ON m.id = ms2.match_id AND ms2.team_id = u2.id\n        WHERE m.id = ? AND (m.team1_id = ? OR m.team2_id = ?)\n    \");\n    $stmt->execute([$matchId, $userId, $userId]);\n    $match = $stmt->fetch();\n    \n    if (!$match) {\n        $error = 'Match not found or you are not a participant';\n        $action = 'list';\n    }\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>My Matches - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n        <div class=\"container\">\n            <a class=\"navbar-brand fw-bold\" href=\"../index.php\">\n                <i class=\"fas fa-trophy text-accent\"></i> eSports Hub\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav me-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"dashboard.php\">\n                            <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"tournaments.php\">\n                            <i class=\"fas fa-trophy\"></i> Tournaments\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link active\" href=\"matches.php\">\n                            <i class=\"fas fa-gamepad\"></i> Matches\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"payments.php\">\n                            <i class=\"fas fa-credit-card\"></i> Payments\n                        </a>\n                    </li>\n                </ul>\n                <ul class=\"navbar-nav\">\n                    <li class=\"nav-item dropdown\">\n                        <a class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n                            <i class=\"fas fa-user\"></i> <?= htmlspecialchars($_SESSION['username']) ?>\n                        </a>\n                        <ul class=\"dropdown-menu dropdown-menu-dark\">\n                            <li><a class=\"dropdown-item\" href=\"dashboard.php\">\n                                <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                            </a></li>\n                            <li><hr class=\"dropdown-divider\"></li>\n                            <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                        </ul>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    \n    <div class=\"container my-4\">\n        <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <h2 class=\"text-light\">\n                <i class=\"fas fa-gamepad text-accent\"></i> \n                <?= $action === 'view' ? 'Match Details' : ($action === 'upload' ? 'Upload Screenshot' : 'My Matches') ?>\n            </h2>\n            <?php if ($action !== 'list'): ?>\n                <a href=\"?\" class=\"btn btn-outline-light\">\n                    <i class=\"fas fa-arrow-left\"></i> Back to Matches\n                </a>\n            <?php endif; ?>\n        </div>\n        \n        <?php if ($error): ?>\n            <div class=\"alert alert-danger\">\n                <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($success): ?>\n            <div class=\"alert alert-success\">\n                <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($action === 'list'): ?>\n            <!-- Match Status Filter -->\n            <div class=\"gaming-card mb-4\">\n                <div class=\"row g-3\">\n                    <div class=\"col-md-6\">\n                        <form method=\"GET\" class=\"d-flex gap-2\">\n                            <select class=\"form-control gaming-input\" name=\"status\" onchange=\"this.form.submit()\">\n                                <option value=\"\">All Matches</option>\n                                <option value=\"scheduled\" <?= ($_GET['status'] ?? '') === 'scheduled' ? 'selected' : '' ?>>Scheduled</option>\n                                <option value=\"live\" <?= ($_GET['status'] ?? '') === 'live' ? 'selected' : '' ?>>Live</option>\n                                <option value=\"completed\" <?= ($_GET['status'] ?? '') === 'completed' ? 'selected' : '' ?>>Completed</option>\n                            </select>\n                        </form>\n                    </div>\n                    <div class=\"col-md-6 text-end\">\n                        <a href=\"upload.php\" class=\"btn btn-accent\">\n                            <i class=\"fas fa-upload\"></i> Upload Screenshot\n                        </a>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Matches List -->\n            <?php if (empty($matches)): ?>\n                <div class=\"gaming-card\">\n                    <div class=\"text-center text-light-50 py-5\">\n                        <i class=\"fas fa-gamepad fa-4x mb-3\"></i>\n                        <h4>No Matches Found</h4>\n                        <p>You don't have any matches yet. Register for tournaments to get matched!</p>\n                        <a href=\"tournaments.php\" class=\"btn btn-accent\">\n                            <i class=\"fas fa-trophy\"></i> Browse Tournaments\n                        </a>\n                    </div>\n                </div>\n            <?php else: ?>\n                <div class=\"row\">\n                    <?php foreach ($matches as $match): ?>\n                        <div class=\"col-lg-6 mb-4\">\n                            <div class=\"gaming-card match-card h-100\">\n                                <div class=\"match-header mb-3\">\n                                    <div class=\"d-flex justify-content-between align-items-center mb-2\">\n                                        <small class=\"text-light-50\"><?= htmlspecialchars($match['tournament_name']) ?></small>\n                                        <span class=\"badge bg-<?= $match['status'] === 'completed' ? 'success' : ($match['status'] === 'live' ? 'danger' : 'info') ?>\">\n                                            <?= ucfirst($match['status']) ?>\n                                        </span>\n                                    </div>\n                                    <div class=\"text-center\">\n                                        <span class=\"badge bg-info\"><?= htmlspecialchars($match['game_type']) ?></span>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"match-teams mb-3\">\n                                    <div class=\"d-flex align-items-center justify-content-between\">\n                                        <div class=\"team-info text-center\">\n                                            <div class=\"team-name <?= $match['team1_id'] == $userId ? 'text-accent fw-bold' : '' ?>\">\n                                                <?= htmlspecialchars($match['team1_name']) ?>\n                                                <?php if ($match['team1_id'] == $userId): ?>\n                                                    <i class=\"fas fa-user text-accent\"></i>\n                                                <?php endif; ?>\n                                            </div>\n                                            <?php if ($match['status'] === 'completed' && $match['score1'] !== null): ?>\n                                                <div class=\"team-score text-light fs-4 fw-bold\"><?= $match['score1'] ?></div>\n                                            <?php endif; ?>\n                                        </div>\n                                        \n                                        <div class=\"vs-indicator\">\n                                            <i class=\"fas fa-vs text-accent fa-2x\"></i>\n                                        </div>\n                                        \n                                        <div class=\"team-info text-center\">\n                                            <div class=\"team-name <?= $match['team2_id'] == $userId ? 'text-accent fw-bold' : '' ?>\">\n                                                <?= htmlspecialchars($match['team2_name']) ?>\n                                                <?php if ($match['team2_id'] == $userId): ?>\n                                                    <i class=\"fas fa-user text-accent\"></i>\n                                                <?php endif; ?>\n                                            </div>\n                                            <?php if ($match['status'] === 'completed' && $match['score2'] !== null): ?>\n                                                <div class=\"team-score text-light fs-4 fw-bold\"><?= $match['score2'] ?></div>\n                                            <?php endif; ?>\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                <?php if ($match['status'] === 'completed' && $match['winner_name']): ?>\n                                    <div class=\"match-result mb-3 text-center\">\n                                        <div class=\"alert alert-<?= $match['winner_id'] == $userId ? 'success' : 'info' ?> py-2\">\n                                            <i class=\"fas fa-trophy\"></i> \n                                            <strong><?= htmlspecialchars($match['winner_name']) ?></strong> Won!\n                                            <?php if ($match['winner_id'] == $userId): ?>\n                                                <i class=\"fas fa-medal text-warning ms-2\"></i>\n                                            <?php endif; ?>\n                                        </div>\n                                    </div>\n                                <?php endif; ?>\n                                \n                                <div class=\"match-details mb-3\">\n                                    <?php if ($match['scheduled_date']): ?>\n                                        <div class=\"d-flex justify-content-between text-light-50 small mb-2\">\n                                            <span><i class=\"fas fa-calendar\"></i> <?= formatDate($match['scheduled_date']) ?></span>\n                                            <?php if ($match['round']): ?>\n                                                <span><i class=\"fas fa-layer-group\"></i> <?= htmlspecialchars($match['round']) ?></span>\n                                            <?php endif; ?>\n                                        </div>\n                                    <?php endif; ?>\n                                    \n                                    <!-- Screenshot Status -->\n                                    <div class=\"screenshot-status\">\n                                        <div class=\"row\">\n                                            <div class=\"col-6 text-center\">\n                                                <?php if ($match['team1_screenshot']): ?>\n                                                    <i class=\"fas fa-check-circle text-success\"></i>\n                                                    <small class=\"text-success\">Screenshot Uploaded</small>\n                                                <?php elseif ($match['team1_id'] == $userId && $match['status'] !== 'scheduled'): ?>\n                                                    <i class=\"fas fa-exclamation-triangle text-warning\"></i>\n                                                    <small class=\"text-warning\">Upload Required</small>\n                                                <?php else: ?>\n                                                    <i class=\"fas fa-clock text-light-50\"></i>\n                                                    <small class=\"text-light-50\">Waiting</small>\n                                                <?php endif; ?>\n                                            </div>\n                                            <div class=\"col-6 text-center\">\n                                                <?php if ($match['team2_screenshot']): ?>\n                                                    <i class=\"fas fa-check-circle text-success\"></i>\n                                                    <small class=\"text-success\">Screenshot Uploaded</small>\n                                                <?php elseif ($match['team2_id'] == $userId && $match['status'] !== 'scheduled'): ?>\n                                                    <i class=\"fas fa-exclamation-triangle text-warning\"></i>\n                                                    <small class=\"text-warning\">Upload Required</small>\n                                                <?php else: ?>\n                                                    <i class=\"fas fa-clock text-light-50\"></i>\n                                                    <small class=\"text-light-50\">Waiting</small>\n                                                <?php endif; ?>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"match-actions mt-auto\">\n                                    <div class=\"row g-2\">\n                                        <div class=\"col\">\n                                            <a href=\"?action=view&id=<?= $match['id'] ?>\" class=\"btn btn-outline-info w-100\">\n                                                <i class=\"fas fa-eye\"></i> View\n                                            </a>\n                                        </div>\n                                        \n                                        <?php if ($match['status'] !== 'scheduled' && $match['status'] !== 'completed'): ?>\n                                            <?php \n                                            $userScreenshot = ($match['team1_id'] == $userId) ? $match['team1_screenshot'] : $match['team2_screenshot'];\n                                            if (!$userScreenshot): ?>\n                                                <div class=\"col\">\n                                                    <button class=\"btn btn-warning w-100\" type=\"button\" data-bs-toggle=\"collapse\" \n                                                            data-bs-target=\"#uploadForm<?= $match['id'] ?>\" aria-expanded=\"false\">\n                                                        <i class=\"fas fa-upload\"></i> Upload Screenshot\n                                                    </button>\n                                                </div>\n                                            <?php else: ?>\n                                                <div class=\"col\">\n                                                    <button class=\"btn btn-success w-100\" disabled>\n                                                        <i class=\"fas fa-check\"></i> Screenshot Uploaded\n                                                    </button>\n                                                </div>\n                                            <?php endif; ?>\n                                        <?php endif; ?>\n                                    </div>\n                                    \n                                    <?php if ($match['status'] !== 'scheduled' && $match['status'] !== 'completed'): ?>\n                                        <?php \n                                        $userScreenshot = ($match['team1_id'] == $userId) ? $match['team1_screenshot'] : $match['team2_screenshot'];\n                                        if (!$userScreenshot): ?>\n                                            <div class=\"collapse mt-3\" id=\"uploadForm<?= $match['id'] ?>\">\n                                                <div class=\"card bg-secondary\">\n                                                    <div class=\"card-body\">\n                                                        <form method=\"POST\" enctype=\"multipart/form-data\" class=\"upload-form\">\n                                                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                                                            <input type=\"hidden\" name=\"match_id\" value=\"<?= $match['id'] ?>\">\n                                                            \n                                                            <div class=\"mb-3\">\n                                                                <label class=\"form-label text-light small\">\n                                                                    <i class=\"fas fa-image text-accent\"></i> Match Result Screenshot\n                                                                </label>\n                                                                <input type=\"file\" class=\"form-control form-control-sm gaming-input\" \n                                                                       name=\"screenshot\" accept=\"image/*\" required>\n                                                                <div class=\"form-text text-light-50 small\">\n                                                                    Upload a screenshot showing your match results (Max 5MB)\n                                                                </div>\n                                                            </div>\n                                                            \n                                                            <div class=\"d-flex gap-2\">\n                                                                <button type=\"submit\" name=\"upload_screenshot\" \n                                                                        class=\"btn btn-accent btn-sm flex-fill\">\n                                                                    <i class=\"fas fa-cloud-upload-alt\"></i> Upload\n                                                                </button>\n                                                                <button type=\"button\" class=\"btn btn-secondary btn-sm\" \n                                                                        data-bs-toggle=\"collapse\" data-bs-target=\"#uploadForm<?= $match['id'] ?>\">\n                                                                    <i class=\"fas fa-times\"></i> Cancel\n                                                                </button>\n                                                            </div>\n                                                        </form>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        <?php endif; ?>\n                                    <?php endif; ?>\n                                </div>\n                            </div>\n                        </div>\n                    <?php endforeach; ?>\n                </div>\n            <?php endif; ?>\n            \n        <?php elseif ($action === 'view' && $match): ?>\n            <!-- Match Details View -->\n            <div class=\"gaming-card\">\n                <div class=\"row\">\n                    <div class=\"col-md-8\">\n                        <h4 class=\"text-accent mb-3\">Match Information</h4>\n                        \n                        <div class=\"match-details-view mb-4\">\n                            <table class=\"table table-dark\">\n                                <tr>\n                                    <th>Tournament:</th>\n                                    <td><?= htmlspecialchars($match['tournament_name']) ?></td>\n                                </tr>\n                                <tr>\n                                    <th>Game:</th>\n                                    <td><span class=\"badge bg-info\"><?= htmlspecialchars($match['game_type']) ?></span></td>\n                                </tr>\n                                <tr>\n                                    <th>Round:</th>\n                                    <td><?= htmlspecialchars($match['round'] ?? 'Not specified') ?></td>\n                                </tr>\n                                <tr>\n                                    <th>Status:</th>\n                                    <td>\n                                        <span class=\"badge bg-<?= $match['status'] === 'completed' ? 'success' : ($match['status'] === 'live' ? 'danger' : 'info') ?>\">\n                                            <?= ucfirst($match['status']) ?>\n                                        </span>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <th>Scheduled:</th>\n                                    <td><?= $match['scheduled_date'] ? formatDate($match['scheduled_date']) : 'Not scheduled' ?></td>\n                                </tr>\n                                <?php if ($match['status'] === 'completed'): ?>\n                                    <tr>\n                                        <th>Completed:</th>\n                                        <td><?= formatDate($match['completed_at']) ?></td>\n                                    </tr>\n                                    <tr>\n                                        <th>Winner:</th>\n                                        <td>\n                                            <strong class=\"text-<?= $match['winner_id'] == $userId ? 'success' : 'info' ?>\">\n                                                <?= htmlspecialchars($match['winner_name']) ?>\n                                                <?php if ($match['winner_id'] == $userId): ?>\n                                                    <i class=\"fas fa-medal text-warning ms-2\"></i>\n                                                <?php endif; ?>\n                                            </strong>\n                                        </td>\n                                    </tr>\n                                    <?php if ($match['score1'] !== null || $match['score2'] !== null): ?>\n                                        <tr>\n                                            <th>Final Score:</th>\n                                            <td>\n                                                <span class=\"badge bg-info\"><?= htmlspecialchars($match['team1_name']) ?></span>\n                                                <span class=\"mx-2 fs-5 fw-bold\"><?= $match['score1'] ?? 0 ?> - <?= $match['score2'] ?? 0 ?></span>\n                                                <span class=\"badge bg-warning\"><?= htmlspecialchars($match['team2_name']) ?></span>\n                                            </td>\n                                        </tr>\n                                    <?php endif; ?>\n                                <?php endif; ?>\n                            </table>\n                        </div>\n                        \n                        <!-- Match Notes -->\n                        <?php if ($match['notes']): ?>\n                            <div class=\"mb-4\">\n                                <h5 class=\"text-light\">Match Notes:</h5>\n                                <div class=\"alert alert-info\">\n                                    <?= nl2br(htmlspecialchars($match['notes'])) ?>\n                                </div>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                    \n                    <div class=\"col-md-4\">\n                        <!-- Screenshot Status -->\n                        <div class=\"gaming-card mb-3\">\n                            <h5 class=\"text-accent mb-3\">Screenshots Status</h5>\n                            \n                            <div class=\"screenshot-section mb-3\">\n                                <h6 class=\"text-info\"><?= htmlspecialchars($match['team1_name']) ?></h6>\n                                <?php if ($match['team1_screenshot']): ?>\n                                    <div class=\"alert alert-success py-2\">\n                                        <i class=\"fas fa-check-circle\"></i> Uploaded\n                                        <br><small>on <?= formatDate($match['team1_upload_time']) ?></small>\n                                    </div>\n                                    <a href=\"../<?= htmlspecialchars($match['team1_screenshot']) ?>\" \n                                       target=\"_blank\" class=\"btn btn-sm btn-outline-success\">\n                                        <i class=\"fas fa-eye\"></i> View Screenshot\n                                    </a>\n                                <?php else: ?>\n                                    <div class=\"alert alert-secondary py-2\">\n                                        <i class=\"fas fa-clock\"></i> Not uploaded yet\n                                    </div>\n                                <?php endif; ?>\n                            </div>\n                            \n                            <div class=\"screenshot-section\">\n                                <h6 class=\"text-warning\"><?= htmlspecialchars($match['team2_name']) ?></h6>\n                                <?php if ($match['team2_screenshot']): ?>\n                                    <div class=\"alert alert-success py-2\">\n                                        <i class=\"fas fa-check-circle\"></i> Uploaded\n                                        <br><small>on <?= formatDate($match['team2_upload_time']) ?></small>\n                                    </div>\n                                    <a href=\"../<?= htmlspecialchars($match['team2_screenshot']) ?>\" \n                                       target=\"_blank\" class=\"btn btn-sm btn-outline-success\">\n                                        <i class=\"fas fa-eye\"></i> View Screenshot\n                                    </a>\n                                <?php else: ?>\n                                    <div class=\"alert alert-secondary py-2\">\n                                        <i class=\"fas fa-clock\"></i> Not uploaded yet\n                                    </div>\n                                <?php endif; ?>\n                            </div>\n                        </div>\n                        \n                        <!-- Screenshot Upload Form -->\n                        <?php if ($match['status'] !== 'scheduled' && $match['status'] !== 'completed'): ?>\n                            <?php \n                            $userScreenshot = ($match['team1_id'] == $userId) ? $match['team1_screenshot'] : $match['team2_screenshot'];\n                            if (!$userScreenshot): ?>\n                                <div class=\"gaming-card\">\n                                    <h5 class=\"text-warning mb-3\">\n                                        <i class=\"fas fa-upload\"></i> Upload Your Screenshot\n                                    </h5>\n                                    <form method=\"POST\" enctype=\"multipart/form-data\" class=\"upload-form\">\n                                        <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                                        <input type=\"hidden\" name=\"match_id\" value=\"<?= $match['id'] ?>\">\n                                        \n                                        <div class=\"mb-3\">\n                                            <label class=\"form-label text-light\">\n                                                <i class=\"fas fa-image text-accent\"></i> Match Result Screenshot\n                                            </label>\n                                            <input type=\"file\" class=\"form-control gaming-input\" \n                                                   name=\"screenshot\" accept=\"image/*\" required>\n                                            <div class=\"form-text text-light-50\">\n                                                Upload a clear screenshot showing your match results (Max 5MB)\n                                            </div>\n                                        </div>\n                                        \n                                        <button type=\"submit\" name=\"upload_screenshot\" class=\"btn btn-warning w-100\">\n                                            <i class=\"fas fa-cloud-upload-alt\"></i> Upload Screenshot\n                                        </button>\n                                    </form>\n                                </div>\n                            <?php else: ?>\n                                <div class=\"alert alert-success text-center\">\n                                    <i class=\"fas fa-check-circle fa-2x mb-2\"></i>\n                                    <h6>Screenshot Uploaded Successfully!</h6>\n                                    <small>Your screenshot has been submitted for this match.</small>\n                                </div>\n                            <?php endif; ?>\n                        <?php endif; ?>\n                    </div>\n                </div>\n            </div>\n        <?php endif; ?>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>\n","size_bytes":35297},"user/payments.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireLogin();\n\n$action = $_GET['action'] ?? 'list';\n$registrationId = $_GET['registration_id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle payment submission\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && $action === 'pay') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $method = sanitizeInput($_POST['method'] ?? '');\n        $phone = sanitizeInput($_POST['phone'] ?? '');\n        $transactionId = sanitizeInput($_POST['transaction_id'] ?? '');\n        \n        if (empty($method) || empty($phone) || empty($transactionId)) {\n            $error = 'All payment fields are required';\n        } else {\n            try {\n                // Verify registration belongs to user\n                $stmt = $pdo->prepare(\"\n                    SELECT tr.*, t.entry_fee, t.name as tournament_name\n                    FROM tournament_registrations tr\n                    JOIN tournaments t ON tr.tournament_id = t.id\n                    WHERE tr.id = ? AND tr.user_id = ?\n                \");\n                $stmt->execute([$registrationId, $_SESSION['user_id']]);\n                $registration = $stmt->fetch();\n                \n                if (!$registration) {\n                    $error = 'Registration not found';\n                } else {\n                    // Check if payment already exists\n                    $stmt = $pdo->prepare(\"SELECT id FROM payments WHERE registration_id = ?\");\n                    $stmt->execute([$registrationId]);\n                    \n                    if ($stmt->rowCount() > 0) {\n                        $error = 'Payment already submitted for this registration';\n                    } else {\n                        // Create payment record\n                        $stmt = $pdo->prepare(\"\n                            INSERT INTO payments (registration_id, amount, method, phone, transaction_id, status, created_at)\n                            VALUES (?, ?, ?, ?, ?, 'pending', CURRENT_TIMESTAMP)\n                        \");\n                        $stmt->execute([$registrationId, $registration['entry_fee'], $method, $phone, $transactionId]);\n                        \n                        $success = 'Payment submitted successfully! Please wait for admin approval.';\n                        $action = 'list';\n                    }\n                }\n            } catch (PDOException $e) {\n                $error = 'Database error: ' . $e->getMessage();\n            }\n        }\n    }\n}\n\n// Get registration details for payment\n$registration = null;\nif ($action === 'pay' && $registrationId) {\n    $stmt = $pdo->prepare(\"\n        SELECT tr.*, t.name as tournament_name, t.entry_fee, t.game_type,\n               p.id as payment_id, p.status as payment_status\n        FROM tournament_registrations tr\n        JOIN tournaments t ON tr.tournament_id = t.id\n        LEFT JOIN payments p ON tr.id = p.registration_id\n        WHERE tr.id = ? AND tr.user_id = ?\n    \");\n    $stmt->execute([$registrationId, $_SESSION['user_id']]);\n    $registration = $stmt->fetch();\n    \n    if (!$registration) {\n        $error = 'Registration not found';\n        $action = 'list';\n    } elseif ($registration['payment_id']) {\n        $error = 'Payment already submitted for this registration';\n        $action = 'list';\n    }\n}\n\n// Get user payments list\nif ($action === 'list') {\n    $stmt = $pdo->prepare(\"\n        SELECT p.*, tr.team_name, t.name as tournament_name, t.game_type\n        FROM payments p\n        JOIN tournament_registrations tr ON p.registration_id = tr.id\n        JOIN tournaments t ON tr.tournament_id = t.id\n        WHERE tr.user_id = ?\n        ORDER BY p.created_at DESC\n    \");\n    $stmt->execute([$_SESSION['user_id']]);\n    $payments = $stmt->fetchAll();\n    \n    // Get payment statistics\n    $stmt = $pdo->prepare(\"\n        SELECT \n            COUNT(*) as total_payments,\n            COUNT(CASE WHEN p.status = 'pending' THEN 1 END) as pending_payments,\n            COUNT(CASE WHEN p.status = 'completed' THEN 1 END) as completed_payments,\n            SUM(CASE WHEN p.status = 'completed' THEN p.amount ELSE 0 END) as total_spent\n        FROM payments p\n        JOIN tournament_registrations tr ON p.registration_id = tr.id\n        WHERE tr.user_id = ?\n    \");\n    $stmt->execute([$_SESSION['user_id']]);\n    $stats = $stmt->fetch();\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Payments - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n        <div class=\"container\">\n            <a class=\"navbar-brand fw-bold\" href=\"../index.php\">\n                <i class=\"fas fa-trophy text-accent\"></i> eSports Hub\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav me-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"dashboard.php\">\n                            <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"tournaments.php\">\n                            <i class=\"fas fa-trophy\"></i> Tournaments\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"matches.php\">\n                            <i class=\"fas fa-gamepad\"></i> Matches\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link active\" href=\"payments.php\">\n                            <i class=\"fas fa-credit-card\"></i> Payments\n                        </a>\n                    </li>\n                </ul>\n                <ul class=\"navbar-nav\">\n                    <li class=\"nav-item dropdown\">\n                        <a class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n                            <i class=\"fas fa-user\"></i> <?= htmlspecialchars($_SESSION['username']) ?>\n                        </a>\n                        <ul class=\"dropdown-menu dropdown-menu-dark\">\n                            <li><a class=\"dropdown-item\" href=\"dashboard.php\">\n                                <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                            </a></li>\n                            <li><hr class=\"dropdown-divider\"></li>\n                            <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                        </ul>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    \n    <div class=\"container my-4\">\n        <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <h2 class=\"text-light\">\n                <i class=\"fas fa-credit-card text-accent\"></i> \n                <?= $action === 'pay' ? 'Make Payment' : 'My Payments' ?>\n            </h2>\n            <?php if ($action === 'pay'): ?>\n                <a href=\"?\" class=\"btn btn-outline-light\">\n                    <i class=\"fas fa-arrow-left\"></i> Back to Payments\n                </a>\n            <?php endif; ?>\n        </div>\n        \n        <?php if ($error): ?>\n            <div class=\"alert alert-danger\">\n                <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($success): ?>\n            <div class=\"alert alert-success\">\n                <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($action === 'list'): ?>\n            <!-- Payment Statistics -->\n            <div class=\"row mb-4\">\n                <div class=\"col-lg-3 col-md-6 mb-3\">\n                    <div class=\"gaming-card stat-card\">\n                        <div class=\"d-flex justify-content-between align-items-center\">\n                            <div>\n                                <h3 class=\"text-accent mb-0\"><?= $stats['total_payments'] ?></h3>\n                                <p class=\"text-light-50 mb-0\">Total Payments</p>\n                            </div>\n                            <i class=\"fas fa-credit-card fa-2x text-accent\"></i>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"col-lg-3 col-md-6 mb-3\">\n                    <div class=\"gaming-card stat-card\">\n                        <div class=\"d-flex justify-content-between align-items-center\">\n                            <div>\n                                <h3 class=\"text-warning mb-0\"><?= $stats['pending_payments'] ?></h3>\n                                <p class=\"text-light-50 mb-0\">Pending</p>\n                            </div>\n                            <i class=\"fas fa-clock fa-2x text-warning\"></i>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"col-lg-3 col-md-6 mb-3\">\n                    <div class=\"gaming-card stat-card\">\n                        <div class=\"d-flex justify-content-between align-items-center\">\n                            <div>\n                                <h3 class=\"text-success mb-0\"><?= $stats['completed_payments'] ?></h3>\n                                <p class=\"text-light-50 mb-0\">Completed</p>\n                            </div>\n                            <i class=\"fas fa-check-circle fa-2x text-success\"></i>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"col-lg-3 col-md-6 mb-3\">\n                    <div class=\"gaming-card stat-card\">\n                        <div class=\"d-flex justify-content-between align-items-center\">\n                            <div>\n                                <h3 class=\"text-warning mb-0\"><?= formatTaka($stats['total_spent']) ?></h3>\n                                <p class=\"text-light-50 mb-0\">Total Spent</p>\n                            </div>\n                            <i class=\"fas fa-coins fa-2x text-warning\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Payments List -->\n            <div class=\"gaming-card\">\n                <?php if (empty($payments)): ?>\n                    <div class=\"text-center text-light-50 py-5\">\n                        <i class=\"fas fa-credit-card fa-4x mb-3\"></i>\n                        <h4>No Payments Yet</h4>\n                        <p>Your payment history will appear here once you make tournament payments</p>\n                        <a href=\"tournaments.php\" class=\"btn btn-accent\">\n                            <i class=\"fas fa-trophy\"></i> Browse Tournaments\n                        </a>\n                    </div>\n                <?php else: ?>\n                    <div class=\"table-responsive\">\n                        <table class=\"table table-dark table-hover\">\n                            <thead>\n                                <tr>\n                                    <th>Transaction ID</th>\n                                    <th>Tournament</th>\n                                    <th>Amount</th>\n                                    <th>Method</th>\n                                    <th>Status</th>\n                                    <th>Date</th>\n                                    <th>Actions</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <?php foreach ($payments as $payment): ?>\n                                    <tr>\n                                        <td>\n                                            <code class=\"text-accent\"><?= htmlspecialchars($payment['transaction_id']) ?></code>\n                                        </td>\n                                        <td>\n                                            <strong><?= htmlspecialchars($payment['tournament_name']) ?></strong>\n                                            <br><small class=\"text-light-50\">\n                                                <span class=\"badge bg-info\"><?= htmlspecialchars($payment['game_type']) ?></span>\n                                                Team: <?= htmlspecialchars($payment['team_name']) ?>\n                                            </small>\n                                        </td>\n                                        <td class=\"fw-bold text-warning\"><?= formatTaka($payment['amount']) ?></td>\n                                        <td>\n                                            <span class=\"badge bg-info\"><?= strtoupper($payment['method']) ?></span>\n                                            <br><small class=\"text-light-50\"><?= htmlspecialchars($payment['phone']) ?></small>\n                                        </td>\n                                        <td>\n                                            <span class=\"badge bg-<?= $payment['status'] === 'completed' ? 'success' : ($payment['status'] === 'pending' ? 'warning' : 'danger') ?>\">\n                                                <?= ucfirst($payment['status']) ?>\n                                            </span>\n                                        </td>\n                                        <td><?= formatDate($payment['created_at']) ?></td>\n                                        <td>\n                                            <?php if ($payment['status'] === 'completed'): ?>\n                                                <button class=\"btn btn-sm btn-outline-success\" onclick=\"generateReceipt(<?= $payment['id'] ?>)\">\n                                                    <i class=\"fas fa-download\"></i> Receipt\n                                                </button>\n                                            <?php else: ?>\n                                                <span class=\"text-light-50 small\">Pending approval</span>\n                                            <?php endif; ?>\n                                        </td>\n                                    </tr>\n                                <?php endforeach; ?>\n                            </tbody>\n                        </table>\n                    </div>\n                <?php endif; ?>\n            </div>\n            \n        <?php elseif ($action === 'pay' && $registration): ?>\n            <!-- Payment Form -->\n            <div class=\"row\">\n                <div class=\"col-lg-8\">\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-4\">\n                            <i class=\"fas fa-credit-card\"></i> Tournament Payment\n                        </h4>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"alert alert-info mb-4\">\n                                <h6 class=\"text-info\"><i class=\"fas fa-info-circle\"></i> Payment Instructions:</h6>\n                                <ol class=\"mb-0\">\n                                    <li>Send money to the merchant number using bKash/Nagad</li>\n                                    <li>Note down the transaction ID from your SMS</li>\n                                    <li>Fill out the form below with exact details</li>\n                                    <li>Wait for admin approval (usually within 24 hours)</li>\n                                </ol>\n                            </div>\n                            \n                            <div class=\"row\">\n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"method\" class=\"form-label text-light\">Payment Method *</label>\n                                    <select class=\"form-control gaming-input\" id=\"method\" name=\"method\" required>\n                                        <option value=\"\">Select Method</option>\n                                        <option value=\"bkash\">bKash</option>\n                                        <option value=\"nagad\">Nagad</option>\n                                        <option value=\"rocket\">Rocket</option>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"col-md-6 mb-3\">\n                                    <label for=\"phone\" class=\"form-label text-light\">Your Phone Number *</label>\n                                    <input type=\"tel\" class=\"form-control gaming-input\" id=\"phone\" name=\"phone\" \n                                           required placeholder=\"01XXXXXXXXX\">\n                                    <small class=\"text-light-50\">Phone number used for payment</small>\n                                </div>\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"transaction_id\" class=\"form-label text-light\">Transaction ID *</label>\n                                <input type=\"text\" class=\"form-control gaming-input\" id=\"transaction_id\" \n                                       name=\"transaction_id\" required placeholder=\"Enter transaction ID from SMS\">\n                                <small class=\"text-light-50\">Exact transaction ID as received in SMS</small>\n                            </div>\n                            \n                            <div class=\"mb-4\">\n                                <div class=\"alert alert-warning\">\n                                    <i class=\"fas fa-exclamation-triangle\"></i>\n                                    <strong>Important:</strong> Make sure to send exactly \n                                    <strong><?= formatTaka($registration['entry_fee']) ?></strong> \n                                    to avoid payment delays.\n                                </div>\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-credit-card\"></i> Submit Payment\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n                \n                <div class=\"col-lg-4\">\n                    <div class=\"gaming-card\">\n                        <h5 class=\"text-accent mb-3\">Payment Details</h5>\n                        \n                        <table class=\"table table-dark table-sm\">\n                            <tr>\n                                <th>Tournament:</th>\n                                <td><?= htmlspecialchars($registration['tournament_name']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>Game:</th>\n                                <td><?= htmlspecialchars($registration['game_type']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>Team:</th>\n                                <td><?= htmlspecialchars($registration['team_name']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>Entry Fee:</th>\n                                <td class=\"text-accent fw-bold fs-5\"><?= formatTaka($registration['entry_fee']) ?></td>\n                            </tr>\n                        </table>\n                        \n                        <div class=\"mt-4\">\n                            <h6 class=\"text-warning\">Merchant Numbers:</h6>\n                            <div class=\"payment-methods\">\n                                <div class=\"method-item mb-2\">\n                                    <i class=\"fab fa-bitcoin text-warning\"></i>\n                                    <strong>bKash:</strong> 01XXXXXXXXX\n                                </div>\n                                <div class=\"method-item mb-2\">\n                                    <i class=\"fas fa-mobile-alt text-info\"></i>\n                                    <strong>Nagad:</strong> 01XXXXXXXXX\n                                </div>\n                                <div class=\"method-item mb-2\">\n                                    <i class=\"fas fa-rocket text-danger\"></i>\n                                    <strong>Rocket:</strong> 01XXXXXXXXX\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"mt-4\">\n                            <div class=\"alert alert-info\">\n                                <i class=\"fas fa-clock\"></i>\n                                Payment approval usually takes 24 hours. You'll be notified via email.\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        <?php endif; ?>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n    <script>\n        function generateReceipt(paymentId) {\n            window.open(`../api/receipt.php?payment_id=${paymentId}`, '_blank');\n        }\n    </script>\n</body>\n</html>\n","size_bytes":22465},"user/register.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\n\n// Redirect if already logged in\nif (isLoggedIn()) {\n    redirect('dashboard.php');\n}\n\n$error = '';\n$success = '';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $username = sanitizeInput($_POST['username'] ?? '');\n        $email = sanitizeInput($_POST['email'] ?? '');\n        $fullName = sanitizeInput($_POST['full_name'] ?? '');\n        $password = $_POST['password'] ?? '';\n        $confirmPassword = $_POST['confirm_password'] ?? '';\n        \n        // Validation\n        if (empty($username) || empty($email) || empty($fullName) || empty($password)) {\n            $error = 'All fields are required';\n        } elseif (!validateEmail($email)) {\n            $error = 'Invalid email address';\n        } elseif (strlen($username) < 3) {\n            $error = 'Username must be at least 3 characters long';\n        } elseif (strlen($password) < 6) {\n            $error = 'Password must be at least 6 characters long';\n        } elseif ($password !== $confirmPassword) {\n            $error = 'Passwords do not match';\n        } else {\n            $auth = new Auth($pdo);\n            $result = $auth->registerUser($username, $email, $password, $fullName);\n            \n            if ($result['success']) {\n                $success = $result['message'] . ' You can now login.';\n            } else {\n                $error = $result['message'];\n            }\n        }\n    }\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Register - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body class=\"auth-page\">\n    <div class=\"container-fluid h-100\">\n        <div class=\"row h-100\">\n            <div class=\"col-lg-6 d-none d-lg-flex align-items-center justify-content-center bg-primary\">\n                <div class=\"text-center text-light\">\n                    <i class=\"fas fa-rocket display-1 text-accent mb-4\"></i>\n                    <h2 class=\"mb-3\">Join the Arena!</h2>\n                    <p class=\"lead\">Start your eSports journey and compete for glory</p>\n                    <div class=\"mt-4\">\n                        <div class=\"gaming-card p-3\">\n                            <h5 class=\"text-accent mb-3\">What awaits you:</h5>\n                            <ul class=\"list-unstyled text-start\">\n                                <li class=\"mb-2\"><i class=\"fas fa-trophy text-warning me-2\"></i> Epic Tournaments</li>\n                                <li class=\"mb-2\"><i class=\"fas fa-users text-success me-2\"></i> Gaming Community</li>\n                                <li class=\"mb-2\"><i class=\"fas fa-coins text-accent me-2\"></i> Cash Prizes</li>\n                                <li class=\"mb-2\"><i class=\"fas fa-gamepad text-info me-2\"></i> Multiple Games</li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-lg-6 d-flex align-items-center justify-content-center\">\n                <div class=\"w-100\" style=\"max-width: 400px;\">\n                    <div class=\"gaming-card\">\n                        <div class=\"text-center mb-4\">\n                            <h3 class=\"text-accent\">\n                                <i class=\"fas fa-user-plus\"></i> Create Account\n                            </h3>\n                        </div>\n                        \n                        <?php if ($error): ?>\n                            <div class=\"alert alert-danger\">\n                                <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                            </div>\n                        <?php endif; ?>\n                        \n                        <?php if ($success): ?>\n                            <div class=\"alert alert-success\">\n                                <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                                <div class=\"mt-2\">\n                                    <a href=\"login.php\" class=\"btn btn-sm btn-outline-success\">Login Now</a>\n                                </div>\n                            </div>\n                        <?php endif; ?>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"username\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-user\"></i> Username *\n                                </label>\n                                <input type=\"text\" class=\"form-control gaming-input\" id=\"username\" \n                                       name=\"username\" required minlength=\"3\" \n                                       value=\"<?= htmlspecialchars($_POST['username'] ?? '') ?>\">\n                                <small class=\"text-light-50\">Minimum 3 characters</small>\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"full_name\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-id-card\"></i> Full Name *\n                                </label>\n                                <input type=\"text\" class=\"form-control gaming-input\" id=\"full_name\" \n                                       name=\"full_name\" required \n                                       value=\"<?= htmlspecialchars($_POST['full_name'] ?? '') ?>\">\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"email\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-envelope\"></i> Email *\n                                </label>\n                                <input type=\"email\" class=\"form-control gaming-input\" id=\"email\" \n                                       name=\"email\" required \n                                       value=\"<?= htmlspecialchars($_POST['email'] ?? '') ?>\">\n                            </div>\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"password\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-lock\"></i> Password *\n                                </label>\n                                <input type=\"password\" class=\"form-control gaming-input\" id=\"password\" \n                                       name=\"password\" required minlength=\"6\">\n                                <small class=\"text-light-50\">Minimum 6 characters</small>\n                            </div>\n                            \n                            <div class=\"mb-4\">\n                                <label for=\"confirm_password\" class=\"form-label text-light\">\n                                    <i class=\"fas fa-lock\"></i> Confirm Password *\n                                </label>\n                                <input type=\"password\" class=\"form-control gaming-input\" id=\"confirm_password\" \n                                       name=\"confirm_password\" required minlength=\"6\">\n                            </div>\n                            \n                            <button type=\"submit\" class=\"btn btn-accent w-100 mb-3\">\n                                <i class=\"fas fa-rocket\"></i> Join the Arena\n                            </button>\n                        </form>\n                        \n                        <div class=\"text-center\">\n                            <p class=\"text-light-50 mb-2\">Already have an account?</p>\n                            <a href=\"login.php\" class=\"text-accent\">\n                                <i class=\"fas fa-sign-in-alt\"></i> Login Here\n                            </a>\n                        </div>\n                        \n                        <div class=\"text-center mt-3\">\n                            <a href=\"../index.php\" class=\"text-light-50\">\n                                <i class=\"fas fa-arrow-left\"></i> Back to Home\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script>\n        // Password confirmation validation\n        document.getElementById('confirm_password').addEventListener('input', function() {\n            const password = document.getElementById('password').value;\n            const confirmPassword = this.value;\n            \n            if (password !== confirmPassword) {\n                this.setCustomValidity('Passwords do not match');\n            } else {\n                this.setCustomValidity('');\n            }\n        });\n    </script>\n</body>\n</html>\n","size_bytes":9704},"user/tournaments.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireLogin();\n\n$action = $_GET['action'] ?? 'list';\n$tournamentId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle tournament registration\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && $action === 'register') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $teamName = sanitizeInput($_POST['team_name'] ?? '');\n        $teamMembers = sanitizeInput($_POST['team_members'] ?? '');\n        \n        if (empty($teamName)) {\n            $error = 'Team name is required';\n        } else {\n            try {\n                // Check if already registered\n                $stmt = $pdo->prepare(\"\n                    SELECT id FROM tournament_registrations \n                    WHERE user_id = ? AND tournament_id = ?\n                \");\n                $stmt->execute([$_SESSION['user_id'], $tournamentId]);\n                \n                if ($stmt->rowCount() > 0) {\n                    $error = 'You are already registered for this tournament';\n                } else {\n                    // Register for tournament\n                    $stmt = $pdo->prepare(\"\n                        INSERT INTO tournament_registrations (user_id, tournament_id, team_name, team_members, status, created_at)\n                        VALUES (?, ?, ?, ?, 'pending', CURRENT_TIMESTAMP)\n                    \");\n                    $stmt->execute([$_SESSION['user_id'], $tournamentId, $teamName, $teamMembers]);\n                    $registrationId = $pdo->lastInsertId();\n                    \n                    // Get tournament details for payment\n                    $stmt = $pdo->prepare(\"SELECT entry_fee FROM tournaments WHERE id = ?\");\n                    $stmt->execute([$tournamentId]);\n                    $entryFee = $stmt->fetchColumn();\n                    \n                    if ($entryFee > 0) {\n                        // Redirect to payment\n                        redirect(\"payments.php?action=pay&registration_id=$registrationId\", 'Registration successful! Please complete payment.', 'success');\n                    } else {\n                        // Free tournament - auto approve\n                        $stmt = $pdo->prepare(\"UPDATE tournament_registrations SET status = 'approved' WHERE id = ?\");\n                        $stmt->execute([$registrationId]);\n                        $success = 'Successfully registered for the tournament!';\n                        $action = 'list';\n                    }\n                }\n            } catch (PDOException $e) {\n                $error = 'Registration failed: ' . $e->getMessage();\n            }\n        }\n    }\n}\n\n// Get tournament details for registration\n$tournament = null;\nif ($action === 'register' && $tournamentId) {\n    $stmt = $pdo->prepare(\"\n        SELECT *, \n               (SELECT COUNT(*) FROM tournament_registrations WHERE tournament_id = ? AND status = 'approved') as registered_teams\n        FROM tournaments \n        WHERE id = ? AND status IN ('upcoming', 'active')\n    \");\n    $stmt->execute([$tournamentId, $tournamentId]);\n    $tournament = $stmt->fetch();\n    \n    if (!$tournament) {\n        $error = 'Tournament not found or registration closed';\n        $action = 'list';\n    } elseif ($tournament['registered_teams'] >= $tournament['max_teams']) {\n        $error = 'Tournament is full';\n        $action = 'list';\n    }\n}\n\n// Get tournaments list\nif ($action === 'list') {\n    $status = sanitizeInput($_GET['status'] ?? '');\n    $game = sanitizeInput($_GET['game'] ?? '');\n    \n    $whereClause = 'WHERE 1=1';\n    $params = [];\n    \n    if ($status) {\n        $whereClause .= ' AND t.status = ?';\n        $params[] = $status;\n    }\n    \n    if ($game) {\n        $whereClause .= ' AND t.game_type = ?';\n        $params[] = $game;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT t.*, \n               COUNT(tr.id) as registered_teams,\n               MAX(CASE WHEN utr.id IS NOT NULL THEN 1 ELSE 0 END) as is_registered\n        FROM tournaments t\n        LEFT JOIN tournament_registrations tr ON t.id = tr.tournament_id AND tr.status = 'approved'\n        LEFT JOIN tournament_registrations utr ON t.id = utr.tournament_id AND utr.user_id = ?\n        $whereClause\n        GROUP BY t.id, t.name, t.description, t.game_type, t.max_teams, t.entry_fee, t.prize_pool, t.start_date, t.end_date, t.status, t.thumbnail, t.created_at, t.updated_at\n        ORDER BY t.start_date ASC, t.created_at DESC\n    \");\n    $params = array_merge([$_SESSION['user_id']], $params);\n    $stmt->execute($params);\n    $tournaments = $stmt->fetchAll();\n    \n    // Get available games\n    $stmt = $pdo->query(\"SELECT DISTINCT game_type FROM tournaments ORDER BY game_type\");\n    $games = $stmt->fetchAll(PDO::FETCH_COLUMN);\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Tournaments - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n        <div class=\"container\">\n            <a class=\"navbar-brand fw-bold\" href=\"../index.php\">\n                <i class=\"fas fa-trophy text-accent\"></i> eSports Hub\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav me-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"dashboard.php\">\n                            <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link active\" href=\"tournaments.php\">\n                            <i class=\"fas fa-trophy\"></i> Tournaments\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"matches.php\">\n                            <i class=\"fas fa-gamepad\"></i> Matches\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"payments.php\">\n                            <i class=\"fas fa-credit-card\"></i> Payments\n                        </a>\n                    </li>\n                </ul>\n                <ul class=\"navbar-nav\">\n                    <li class=\"nav-item dropdown\">\n                        <a class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n                            <i class=\"fas fa-user\"></i> <?= htmlspecialchars($_SESSION['username']) ?>\n                        </a>\n                        <ul class=\"dropdown-menu dropdown-menu-dark\">\n                            <li><a class=\"dropdown-item\" href=\"dashboard.php\">\n                                <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                            </a></li>\n                            <li><hr class=\"dropdown-divider\"></li>\n                            <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                        </ul>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    \n    <div class=\"container my-4\">\n        <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <h2 class=\"text-light\">\n                <i class=\"fas fa-trophy text-accent\"></i> \n                <?= $action === 'register' ? 'Tournament Registration' : 'Available Tournaments' ?>\n            </h2>\n            <?php if ($action === 'register'): ?>\n                <a href=\"?\" class=\"btn btn-outline-light\">\n                    <i class=\"fas fa-arrow-left\"></i> Back to Tournaments\n                </a>\n            <?php endif; ?>\n        </div>\n        \n        <?php if ($error): ?>\n            <div class=\"alert alert-danger\">\n                <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($success): ?>\n            <div class=\"alert alert-success\">\n                <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($action === 'list'): ?>\n            <!-- Filters -->\n            <div class=\"gaming-card mb-4\">\n                <form method=\"GET\" class=\"row g-3\">\n                    <div class=\"col-md-4\">\n                        <select class=\"form-control gaming-input\" name=\"status\">\n                            <option value=\"\">All Tournaments</option>\n                            <option value=\"upcoming\" <?= ($_GET['status'] ?? '') === 'upcoming' ? 'selected' : '' ?>>Upcoming</option>\n                            <option value=\"active\" <?= ($_GET['status'] ?? '') === 'active' ? 'selected' : '' ?>>Active</option>\n                            <option value=\"completed\" <?= ($_GET['status'] ?? '') === 'completed' ? 'selected' : '' ?>>Completed</option>\n                        </select>\n                    </div>\n                    <div class=\"col-md-4\">\n                        <select class=\"form-control gaming-input\" name=\"game\">\n                            <option value=\"\">All Games</option>\n                            <?php foreach ($games as $gameType): ?>\n                                <option value=\"<?= htmlspecialchars($gameType) ?>\" \n                                        <?= ($_GET['game'] ?? '') === $gameType ? 'selected' : '' ?>>\n                                    <?= htmlspecialchars($gameType) ?>\n                                </option>\n                            <?php endforeach; ?>\n                        </select>\n                    </div>\n                    <div class=\"col-md-4\">\n                        <button type=\"submit\" class=\"btn btn-accent w-100\">\n                            <i class=\"fas fa-search\"></i> Filter\n                        </button>\n                    </div>\n                </form>\n            </div>\n            \n            <!-- Tournaments Grid -->\n            <?php if (empty($tournaments)): ?>\n                <div class=\"gaming-card\">\n                    <div class=\"text-center text-light-50 py-5\">\n                        <i class=\"fas fa-trophy fa-4x mb-3\"></i>\n                        <h4>No Tournaments Available</h4>\n                        <p>Check back later for new tournaments or adjust your filters</p>\n                    </div>\n                </div>\n            <?php else: ?>\n                <div class=\"row\">\n                    <?php foreach ($tournaments as $t): ?>\n                        <div class=\"col-lg-6 col-xl-4 mb-4\">\n                            <div class=\"gaming-card tournament-card h-100\">\n                                <?php if ($t['thumbnail']): ?>\n                                <div class=\"tournament-thumbnail mb-3\">\n                                    <img src=\"<?= htmlspecialchars($t['thumbnail']) ?>\" alt=\"<?= htmlspecialchars($t['game_type']) ?>\" \n                                         class=\"img-fluid rounded\" style=\"width: 100%; height: 150px; object-fit: cover;\">\n                                </div>\n                                <?php endif; ?>\n                                \n                                <div class=\"tournament-header\">\n                                    <div class=\"d-flex justify-content-between align-items-start mb-3\">\n                                        <span class=\"badge bg-<?= $t['status'] === 'active' ? 'success' : ($t['status'] === 'upcoming' ? 'info' : 'secondary') ?>\">\n                                            <?= ucfirst($t['status']) ?>\n                                        </span>\n                                        <span class=\"badge bg-primary\"><?= htmlspecialchars($t['game_type']) ?></span>\n                                    </div>\n                                    \n                                    <h5 class=\"text-accent mb-2\"><?= htmlspecialchars($t['name']) ?></h5>\n                                    <p class=\"text-light-50 small mb-3\"><?= htmlspecialchars($t['description']) ?></p>\n                                </div>\n                                \n                                <div class=\"tournament-details mb-3\">\n                                    <div class=\"row text-center\">\n                                        <div class=\"col-4\">\n                                            <div class=\"text-warning fw-bold\"><?= formatTaka($t['prize_pool']) ?></div>\n                                            <small class=\"text-light-50\">Prize Pool</small>\n                                        </div>\n                                        <div class=\"col-4\">\n                                            <div class=\"text-info fw-bold\"><?= $t['registered_teams'] ?>/<?= $t['max_teams'] ?></div>\n                                            <small class=\"text-light-50\">Teams</small>\n                                        </div>\n                                        <div class=\"col-4\">\n                                            <div class=\"text-accent fw-bold\"><?= formatTaka($t['entry_fee']) ?></div>\n                                            <small class=\"text-light-50\">Entry Fee</small>\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"tournament-dates mb-3\">\n                                    <div class=\"d-flex justify-content-between text-light-50 small\">\n                                        <span><i class=\"fas fa-calendar\"></i> <?= formatDate($t['start_date']) ?></span>\n                                        <span><i class=\"fas fa-clock\"></i> <?= formatDate($t['end_date']) ?></span>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"tournament-progress mb-3\">\n                                    <?php \n                                    $progress = ($t['registered_teams'] / $t['max_teams']) * 100;\n                                    ?>\n                                    <div class=\"progress\" style=\"height: 8px;\">\n                                        <div class=\"progress-bar bg-accent\" style=\"width: <?= $progress ?>%\"></div>\n                                    </div>\n                                    <small class=\"text-light-50\"><?= round($progress) ?>% filled</small>\n                                </div>\n                                \n                                <div class=\"tournament-actions mt-auto\">\n                                    <?php if ($t['is_registered']): ?>\n                                        <button class=\"btn btn-success w-100\" disabled>\n                                            <i class=\"fas fa-check\"></i> Registered\n                                        </button>\n                                    <?php elseif ($t['status'] === 'completed'): ?>\n                                        <button class=\"btn btn-secondary w-100\" disabled>\n                                            <i class=\"fas fa-flag-checkered\"></i> Completed\n                                        </button>\n                                    <?php elseif ($t['registered_teams'] >= $t['max_teams']): ?>\n                                        <button class=\"btn btn-warning w-100\" disabled>\n                                            <i class=\"fas fa-users\"></i> Tournament Full\n                                        </button>\n                                    <?php elseif ($t['status'] === 'active' || $t['status'] === 'upcoming'): ?>\n                                        <a href=\"?action=register&id=<?= $t['id'] ?>\" class=\"btn btn-accent w-100\">\n                                            <i class=\"fas fa-plus\"></i> Register Now\n                                        </a>\n                                    <?php else: ?>\n                                        <button class=\"btn btn-secondary w-100\" disabled>\n                                            <i class=\"fas fa-lock\"></i> Registration Closed\n                                        </button>\n                                    <?php endif; ?>\n                                </div>\n                            </div>\n                        </div>\n                    <?php endforeach; ?>\n                </div>\n            <?php endif; ?>\n            \n        <?php elseif ($action === 'register' && $tournament): ?>\n            <!-- Registration Form -->\n            <div class=\"row\">\n                <div class=\"col-lg-8\">\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-4\">\n                            <i class=\"fas fa-user-plus\"></i> Tournament Registration\n                        </h4>\n                        \n                        <form method=\"POST\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"team_name\" class=\"form-label text-light\">Team Name *</label>\n                                <input type=\"text\" class=\"form-control gaming-input\" id=\"team_name\" name=\"team_name\" \n                                       required maxlength=\"50\" placeholder=\"Enter your team name\">\n                                <small class=\"text-light-50\">This will be your display name in the tournament</small>\n                            </div>\n                            \n                            <div class=\"mb-4\">\n                                <label for=\"team_members\" class=\"form-label text-light\">Team Members</label>\n                                <textarea class=\"form-control gaming-input\" id=\"team_members\" name=\"team_members\" \n                                          rows=\"4\" placeholder=\"List your team members (optional)...\"></textarea>\n                                <small class=\"text-light-50\">You can add team member details here</small>\n                            </div>\n                            \n                            <div class=\"alert alert-info\">\n                                <h6 class=\"text-info\"><i class=\"fas fa-info-circle\"></i> Registration Details:</h6>\n                                <ul class=\"mb-0\">\n                                    <li>Entry Fee: <strong><?= formatTaka($tournament['entry_fee']) ?></strong></li>\n                                    <?php if ($tournament['entry_fee'] > 0): ?>\n                                        <li>Payment will be required after registration</li>\n                                        <li>Registration will be pending until payment is confirmed</li>\n                                    <?php else: ?>\n                                        <li>This is a free tournament - registration will be auto-approved</li>\n                                    <?php endif; ?>\n                                    <li>Make sure to read tournament rules carefully</li>\n                                </ul>\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-accent\">\n                                    <i class=\"fas fa-user-plus\"></i> Register for Tournament\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n                \n                <div class=\"col-lg-4\">\n                    <div class=\"gaming-card\">\n                        <h5 class=\"text-accent mb-3\">Tournament Details</h5>\n                        \n                        <table class=\"table table-dark table-sm\">\n                            <tr>\n                                <th>Name:</th>\n                                <td><?= htmlspecialchars($tournament['name']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>Game:</th>\n                                <td><?= htmlspecialchars($tournament['game_type']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>Max Teams:</th>\n                                <td><?= $tournament['max_teams'] ?></td>\n                            </tr>\n                            <tr>\n                                <th>Registered:</th>\n                                <td><?= $tournament['registered_teams'] ?></td>\n                            </tr>\n                            <tr>\n                                <th>Entry Fee:</th>\n                                <td class=\"text-accent fw-bold\"><?= formatTaka($tournament['entry_fee']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>Prize Pool:</th>\n                                <td class=\"text-warning fw-bold\"><?= formatTaka($tournament['prize_pool']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>Start Date:</th>\n                                <td><?= formatDate($tournament['start_date']) ?></td>\n                            </tr>\n                            <tr>\n                                <th>End Date:</th>\n                                <td><?= formatDate($tournament['end_date']) ?></td>\n                            </tr>\n                        </table>\n                        \n                        <?php if ($tournament['description']): ?>\n                            <div class=\"mt-3\">\n                                <h6 class=\"text-light\">Description:</h6>\n                                <p class=\"text-light-50 small\"><?= nl2br(htmlspecialchars($tournament['description'])) ?></p>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                </div>\n            </div>\n        <?php endif; ?>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n</body>\n</html>\n","size_bytes":23096},"user/upload.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireLogin();\n\n$matchId = $_GET['match_id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle screenshot upload\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $selectedMatchId = (int)($_POST['match_id'] ?? 0);\n        \n        if (!$selectedMatchId) {\n            $error = 'Please select a match';\n        } elseif (!isset($_FILES['screenshot']) || $_FILES['screenshot']['error'] !== UPLOAD_ERR_OK) {\n            $error = 'Please select a valid screenshot file';\n        } else {\n            try {\n                // Verify user is participant in this match\n                $stmt = $pdo->prepare(\"\n                    SELECT * FROM matches \n                    WHERE id = ? AND (team1_id = ? OR team2_id = ?) \n                    AND status IN ('live', 'active')\n                \");\n                $stmt->execute([$selectedMatchId, $_SESSION['user_id'], $_SESSION['user_id']]);\n                $match = $stmt->fetch();\n                \n                if (!$match) {\n                    $error = 'Match not found or you are not a participant, or match is not active';\n                } else {\n                    // Check if screenshot already uploaded\n                    $stmt = $pdo->prepare(\"\n                        SELECT id FROM match_screenshots \n                        WHERE match_id = ? AND team_id = ?\n                    \");\n                    $stmt->execute([$selectedMatchId, $_SESSION['user_id']]);\n                    \n                    if ($stmt->rowCount() > 0) {\n                        $error = 'You have already uploaded a screenshot for this match';\n                    } else {\n                        // Upload screenshot\n                        $uploadResult = uploadFile($_FILES['screenshot'], 'screenshots/');\n                        \n                        if ($uploadResult['success']) {\n                            // Save screenshot record\n                            $stmt = $pdo->prepare(\"\n                                INSERT INTO match_screenshots (match_id, team_id, screenshot_url, uploaded_at)\n                                VALUES (?, ?, ?, CURRENT_TIMESTAMP)\n                            \");\n                            $stmt->execute([$selectedMatchId, $_SESSION['user_id'], $uploadResult['filename']]);\n                            \n                            $success = 'Screenshot uploaded successfully!';\n                            \n                            // Check if both teams have uploaded screenshots\n                            $stmt = $pdo->prepare(\"\n                                SELECT COUNT(*) as upload_count\n                                FROM match_screenshots \n                                WHERE match_id = ?\n                            \");\n                            $stmt->execute([$selectedMatchId]);\n                            $uploadCount = $stmt->fetchColumn();\n                            \n                            if ($uploadCount >= 2) {\n                                // Both teams uploaded, match ready for review\n                                $stmt = $pdo->prepare(\"\n                                    UPDATE matches \n                                    SET status = 'pending_review' \n                                    WHERE id = ? AND status = 'live'\n                                \");\n                                $stmt->execute([$selectedMatchId]);\n                            }\n                        } else {\n                            $error = $uploadResult['message'];\n                        }\n                    }\n                }\n            } catch (PDOException $e) {\n                $error = 'Database error: ' . $e->getMessage();\n            }\n        }\n    }\n}\n\n// Get user's active matches for dropdown\n$stmt = $pdo->prepare(\"\n    SELECT m.id, m.scheduled_date, t.name as tournament_name, t.game_type,\n           CASE \n               WHEN m.team1_id = ? THEN u2.username \n               ELSE u1.username \n           END as opponent_name,\n           ms.id as has_screenshot\n    FROM matches m\n    JOIN tournaments t ON m.tournament_id = t.id\n    JOIN users u1 ON m.team1_id = u1.id\n    JOIN users u2 ON m.team2_id = u2.id\n    LEFT JOIN match_screenshots ms ON m.id = ms.match_id AND ms.team_id = ?\n    WHERE (m.team1_id = ? OR m.team2_id = ?) \n    AND m.status IN ('live', 'active')\n    AND ms.id IS NULL\n    ORDER BY m.scheduled_date ASC\n\");\n$stmt->execute([$_SESSION['user_id'], $_SESSION['user_id'], $_SESSION['user_id'], $_SESSION['user_id']]);\n$availableMatches = $stmt->fetchAll();\n\n// Get match details if match_id is provided\n$selectedMatch = null;\nif ($matchId) {\n    $stmt = $pdo->prepare(\"\n        SELECT m.*, t.name as tournament_name, t.game_type,\n               u1.username as team1_name, u2.username as team2_name,\n               CASE \n                   WHEN m.team1_id = ? THEN u2.username \n                   ELSE u1.username \n               END as opponent_name\n        FROM matches m\n        JOIN tournaments t ON m.tournament_id = t.id\n        JOIN users u1 ON m.team1_id = u1.id\n        JOIN users u2 ON m.team2_id = u2.id\n        WHERE m.id = ? AND (m.team1_id = ? OR m.team2_id = ?)\n    \");\n    $stmt->execute([$_SESSION['user_id'], $matchId, $_SESSION['user_id'], $_SESSION['user_id']]);\n    $selectedMatch = $stmt->fetch();\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Upload Screenshot - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n        <div class=\"container\">\n            <a class=\"navbar-brand fw-bold\" href=\"../index.php\">\n                <i class=\"fas fa-trophy text-accent\"></i> eSports Hub\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav me-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"dashboard.php\">\n                            <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"tournaments.php\">\n                            <i class=\"fas fa-trophy\"></i> Tournaments\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"matches.php\">\n                            <i class=\"fas fa-gamepad\"></i> Matches\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"payments.php\">\n                            <i class=\"fas fa-credit-card\"></i> Payments\n                        </a>\n                    </li>\n                </ul>\n                <ul class=\"navbar-nav\">\n                    <li class=\"nav-item dropdown\">\n                        <a class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n                            <i class=\"fas fa-user\"></i> <?= htmlspecialchars($_SESSION['username']) ?>\n                        </a>\n                        <ul class=\"dropdown-menu dropdown-menu-dark\">\n                            <li><a class=\"dropdown-item\" href=\"dashboard.php\">\n                                <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                            </a></li>\n                            <li><hr class=\"dropdown-divider\"></li>\n                            <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                        </ul>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    \n    <div class=\"container my-4\">\n        <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <h2 class=\"text-light\">\n                <i class=\"fas fa-upload text-accent\"></i> Upload Match Screenshot\n            </h2>\n            <a href=\"matches.php\" class=\"btn btn-outline-light\">\n                <i class=\"fas fa-arrow-left\"></i> Back to Matches\n            </a>\n        </div>\n        \n        <?php if ($error): ?>\n            <div class=\"alert alert-danger\">\n                <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($success): ?>\n            <div class=\"alert alert-success\">\n                <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                <div class=\"mt-2\">\n                    <a href=\"matches.php\" class=\"btn btn-sm btn-outline-success\">\n                        <i class=\"fas fa-gamepad\"></i> View My Matches\n                    </a>\n                </div>\n            </div>\n        <?php endif; ?>\n        \n        <?php if (empty($availableMatches) && !$selectedMatch): ?>\n            <div class=\"gaming-card\">\n                <div class=\"text-center text-light-50 py-5\">\n                    <i class=\"fas fa-camera fa-4x mb-3\"></i>\n                    <h4>No Active Matches</h4>\n                    <p>You don't have any active matches that require screenshot uploads</p>\n                    <a href=\"matches.php\" class=\"btn btn-accent\">\n                        <i class=\"fas fa-gamepad\"></i> View All Matches\n                    </a>\n                </div>\n            </div>\n        <?php else: ?>\n            <div class=\"row\">\n                <div class=\"col-lg-8\">\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-4\">\n                            <i class=\"fas fa-camera\"></i> Upload Match Result Screenshot\n                        </h4>\n                        \n                        <div class=\"alert alert-info mb-4\">\n                            <h6 class=\"text-info\"><i class=\"fas fa-info-circle\"></i> Screenshot Guidelines:</h6>\n                            <ul class=\"mb-0\">\n                                <li>Upload a clear screenshot showing the match result</li>\n                                <li>Screenshot should show final scores/standings</li>\n                                <li>Maximum file size: 5MB</li>\n                                <li>Supported formats: JPG, PNG, GIF, WEBP</li>\n                                <li>Both teams must upload screenshots for match verification</li>\n                            </ul>\n                        </div>\n                        \n                        <form method=\"POST\" enctype=\"multipart/form-data\" id=\"uploadForm\">\n                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                            \n                            <div class=\"mb-3\">\n                                <label for=\"match_id\" class=\"form-label text-light\">Select Match *</label>\n                                <select class=\"form-control gaming-input\" id=\"match_id\" name=\"match_id\" required onchange=\"updateMatchDetails()\">\n                                    <option value=\"\">Choose a match to upload screenshot for</option>\n                                    <?php foreach ($availableMatches as $match): ?>\n                                        <option value=\"<?= $match['id'] ?>\" \n                                                <?= $matchId == $match['id'] ? 'selected' : '' ?>\n                                                data-tournament=\"<?= htmlspecialchars($match['tournament_name']) ?>\"\n                                                data-game=\"<?= htmlspecialchars($match['game_type']) ?>\"\n                                                data-opponent=\"<?= htmlspecialchars($match['opponent_name']) ?>\"\n                                                data-date=\"<?= formatDate($match['scheduled_date']) ?>\">\n                                            <?= htmlspecialchars($match['tournament_name']) ?> - vs <?= htmlspecialchars($match['opponent_name']) ?>\n                                            <?php if ($match['scheduled_date']): ?>\n                                                (<?= formatDate($match['scheduled_date']) ?>)\n                                            <?php endif; ?>\n                                        </option>\n                                    <?php endforeach; ?>\n                                </select>\n                            </div>\n                            \n                            <div class=\"mb-4\">\n                                <label for=\"screenshot\" class=\"form-label text-light\">Screenshot File *</label>\n                                <input type=\"file\" class=\"form-control gaming-input\" id=\"screenshot\" name=\"screenshot\" \n                                       accept=\"image/*\" required onchange=\"previewImage(this)\">\n                                <small class=\"text-light-50\">Maximum 5MB, supported formats: JPG, PNG, GIF, WEBP</small>\n                            </div>\n                            \n                            <!-- Image Preview -->\n                            <div id=\"imagePreview\" class=\"mb-4\" style=\"display: none;\">\n                                <label class=\"form-label text-light\">Preview:</label>\n                                <div class=\"screenshot-preview\">\n                                    <img id=\"previewImg\" class=\"img-fluid rounded\" style=\"max-height: 300px;\">\n                                </div>\n                            </div>\n                            \n                            <div class=\"text-end\">\n                                <button type=\"submit\" class=\"btn btn-accent\" id=\"submitBtn\">\n                                    <i class=\"fas fa-upload\"></i> Upload Screenshot\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n                \n                <div class=\"col-lg-4\">\n                    <div class=\"gaming-card\" id=\"matchDetails\" style=\"display: none;\">\n                        <h5 class=\"text-accent mb-3\">Match Details</h5>\n                        <table class=\"table table-dark table-sm\">\n                            <tr>\n                                <th>Tournament:</th>\n                                <td id=\"detailTournament\">-</td>\n                            </tr>\n                            <tr>\n                                <th>Game:</th>\n                                <td id=\"detailGame\">-</td>\n                            </tr>\n                            <tr>\n                                <th>Opponent:</th>\n                                <td id=\"detailOpponent\">-</td>\n                            </tr>\n                            <tr>\n                                <th>Scheduled:</th>\n                                <td id=\"detailDate\">-</td>\n                            </tr>\n                        </table>\n                        \n                        <div class=\"alert alert-warning mt-3\">\n                            <i class=\"fas fa-exclamation-triangle\"></i>\n                            Make sure your screenshot clearly shows the match result before uploading.\n                        </div>\n                    </div>\n                    \n                    <!-- Upload History -->\n                    <div class=\"gaming-card mt-4\">\n                        <h5 class=\"text-accent mb-3\">Recent Uploads</h5>\n                        <?php\n                        $stmt = $pdo->prepare(\"\n                            SELECT ms.*, t.name as tournament_name, \n                                   CASE \n                                       WHEN m.team1_id = ? THEN u2.username \n                                       ELSE u1.username \n                                   END as opponent_name\n                            FROM match_screenshots ms\n                            JOIN matches m ON ms.match_id = m.id\n                            JOIN tournaments t ON m.tournament_id = t.id\n                            JOIN users u1 ON m.team1_id = u1.id\n                            JOIN users u2 ON m.team2_id = u2.id\n                            WHERE ms.team_id = ?\n                            ORDER BY ms.uploaded_at DESC\n                            LIMIT 5\n                        \");\n                        $stmt->execute([$_SESSION['user_id'], $_SESSION['user_id']]);\n                        $recentUploads = $stmt->fetchAll();\n                        ?>\n                        \n                        <?php if (empty($recentUploads)): ?>\n                            <div class=\"text-center text-light-50 py-3\">\n                                <i class=\"fas fa-camera fa-2x mb-2\"></i>\n                                <p class=\"small mb-0\">No uploads yet</p>\n                            </div>\n                        <?php else: ?>\n                            <?php foreach ($recentUploads as $upload): ?>\n                                <div class=\"upload-item mb-2 pb-2 border-bottom border-secondary\">\n                                    <div class=\"d-flex justify-content-between align-items-center\">\n                                        <div>\n                                            <small class=\"text-light\"><?= htmlspecialchars($upload['tournament_name']) ?></small>\n                                            <br><small class=\"text-light-50\">vs <?= htmlspecialchars($upload['opponent_name']) ?></small>\n                                        </div>\n                                        <small class=\"text-success\">\n                                            <i class=\"fas fa-check-circle\"></i> \n                                            <?= timeAgo($upload['uploaded_at']) ?>\n                                        </small>\n                                    </div>\n                                </div>\n                            <?php endforeach; ?>\n                        <?php endif; ?>\n                    </div>\n                </div>\n            </div>\n        <?php endif; ?>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"../assets/js/main.js\"></script>\n    <script>\n        function updateMatchDetails() {\n            const select = document.getElementById('match_id');\n            const details = document.getElementById('matchDetails');\n            const option = select.options[select.selectedIndex];\n            \n            if (option.value) {\n                document.getElementById('detailTournament').textContent = option.dataset.tournament || '-';\n                document.getElementById('detailGame').textContent = option.dataset.game || '-';\n                document.getElementById('detailOpponent').textContent = option.dataset.opponent || '-';\n                document.getElementById('detailDate').textContent = option.dataset.date || '-';\n                details.style.display = 'block';\n            } else {\n                details.style.display = 'none';\n            }\n        }\n        \n        function previewImage(input) {\n            const preview = document.getElementById('imagePreview');\n            const img = document.getElementById('previewImg');\n            \n            if (input.files && input.files[0]) {\n                const reader = new FileReader();\n                \n                reader.onload = function(e) {\n                    img.src = e.target.result;\n                    preview.style.display = 'block';\n                }\n                \n                reader.readAsDataURL(input.files[0]);\n            } else {\n                preview.style.display = 'none';\n            }\n        }\n        \n        // Initialize if match is pre-selected\n        document.addEventListener('DOMContentLoaded', function() {\n            updateMatchDetails();\n        });\n        \n        // Form submission handling\n        document.getElementById('uploadForm').addEventListener('submit', function(e) {\n            const submitBtn = document.getElementById('submitBtn');\n            submitBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Uploading...';\n            submitBtn.disabled = true;\n        });\n    </script>\n</body>\n</html>\n","size_bytes":21098},"admin/includes/navbar.php":{"content":"<?php\n// Admin Navigation Bar\n?>\n<nav class=\"navbar navbar-expand-lg navbar-dark bg-primary fixed-top\">\n    <div class=\"container-fluid\">\n        <a class=\"navbar-brand fw-bold\" href=\"dashboard.php\">\n            <i class=\"fas fa-shield-alt text-accent\"></i> eSports Admin\n        </a>\n        \n        <div class=\"ms-auto\">\n            <div class=\"dropdown\">\n                <button class=\"btn btn-outline-light dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\">\n                    <i class=\"fas fa-user\"></i> <?= htmlspecialchars($_SESSION['admin_username']) ?>\n                </button>\n                <ul class=\"dropdown-menu dropdown-menu-dark\">\n                    <li><a class=\"dropdown-item\" href=\"../index.php\"><i class=\"fas fa-home\"></i> View Site</a></li>\n                    <li><hr class=\"dropdown-divider\"></li>\n                    <li><a class=\"dropdown-item\" href=\"logout.php\"><i class=\"fas fa-sign-out-alt\"></i> Logout</a></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</nav>","size_bytes":1026},"admin/includes/sidebar.php":{"content":"<?php\n// Admin Sidebar\n?>\n<div class=\"col-lg-2 sidebar bg-secondary p-0\">\n    <div class=\"sidebar-content\">\n        <ul class=\"nav flex-column\">\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'dashboard.php' ? 'active' : '' ?>\" \n                   href=\"dashboard.php\">\n                    <i class=\"fas fa-tachometer-alt\"></i> Dashboard\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'tournaments.php' ? 'active' : '' ?>\" \n                   href=\"tournaments.php\">\n                    <i class=\"fas fa-trophy\"></i> Tournaments\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'matches.php' ? 'active' : '' ?>\" \n                   href=\"matches.php\">\n                    <i class=\"fas fa-gamepad\"></i> Matches\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'payments.php' ? 'active' : '' ?>\" \n                   href=\"payments.php\">\n                    <i class=\"fas fa-credit-card\"></i> Payments\n                </a>\n            </li>\n            <li class=\"nav-item\">\n                <a class=\"nav-link <?= basename($_SERVER['PHP_SELF']) === 'users.php' ? 'active' : '' ?>\" \n                   href=\"users.php\">\n                    <i class=\"fas fa-users\"></i> Users\n                </a>\n            </li>\n        </ul>\n    </div>\n</div>","size_bytes":1599},"assets/css/style.css":{"content":"/* eSports Tournament Management System - Gaming Theme */\n:root {\n    --primary: #1a1a2e;\n    --secondary: #16213e;\n    --accent: #0f3460;\n    --success: #00ff88;\n    --warning: #ff6b35;\n    --background: #0d1117;\n    --text: #f0f6fc;\n    --text-50: rgba(240, 246, 252, 0.5);\n    --text-75: rgba(240, 246, 252, 0.75);\n}\n\n* {\n    box-sizing: border-box;\n}\n\nbody {\n    background: var(--background);\n    color: var(--text);\n    font-family: 'Rajdhani', 'Roboto', sans-serif;\n    line-height: 1.6;\n}\n\n/* Typography */\nh1, h2, h3, h4, h5, h6 {\n    font-family: 'Orbitron', monospace;\n    font-weight: 600;\n}\n\n.text-accent {\n    color: var(--accent) !important;\n}\n\n.text-light-50 {\n    color: var(--text-50) !important;\n}\n\n.text-light-75 {\n    color: var(--text-75) !important;\n}\n\n/* Navigation */\n.navbar {\n    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%) !important;\n    border-bottom: 2px solid var(--accent);\n    box-shadow: 0 4px 20px rgba(15, 52, 96, 0.3);\n}\n\n.navbar-brand {\n    font-family: 'Orbitron', monospace;\n    font-weight: 700;\n    font-size: 1.5rem;\n}\n\n.navbar-nav .nav-link {\n    font-weight: 500;\n    transition: all 0.3s ease;\n    position: relative;\n}\n\n.navbar-nav .nav-link:hover {\n    color: var(--accent) !important;\n    transform: translateY(-2px);\n}\n\n.navbar-nav .nav-link.active {\n    color: var(--accent) !important;\n}\n\n.navbar-nav .nav-link.active:before {\n    content: '';\n    position: absolute;\n    bottom: -5px;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 30px;\n    height: 2px;\n    background: var(--accent);\n    border-radius: 2px;\n}\n\n/* Buttons */\n.btn {\n    font-family: 'Rajdhani', sans-serif;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    border-radius: 8px;\n    transition: all 0.3s ease;\n    position: relative;\n    overflow: hidden;\n}\n\n.btn-accent {\n    background: linear-gradient(135deg, var(--accent) 0%, #00ff88 100%);\n    border: none;\n    color: #000;\n    box-shadow: 0 4px 15px rgba(15, 52, 96, 0.4);\n}\n\n.btn-accent:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 8px 25px rgba(15, 52, 96, 0.6);\n    color: #000;\n}\n\n.btn-outline-accent {\n    border: 2px solid var(--accent);\n    color: var(--accent);\n    background: transparent;\n}\n\n.btn-outline-accent:hover {\n    background: var(--accent);\n    color: #fff;\n    transform: translateY(-2px);\n    box-shadow: 0 8px 25px rgba(15, 52, 96, 0.4);\n}\n\n/* Gaming Cards */\n.gaming-card {\n    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);\n    border: 1px solid rgba(15, 52, 96, 0.3);\n    border-radius: 12px;\n    padding: 2rem;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n    position: relative;\n    overflow: hidden;\n}\n\n.gaming-card:before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: linear-gradient(90deg, var(--accent), var(--success));\n    opacity: 0.7;\n}\n\n.gaming-card:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);\n    border-color: var(--accent);\n}\n\n/* Form Controls */\n.gaming-input {\n    background: rgba(26, 26, 46, 0.8) !important;\n    border: 1px solid rgba(15, 52, 96, 0.5) !important;\n    color: var(--text) !important;\n    border-radius: 8px !important;\n    font-family: 'Rajdhani', sans-serif;\n    font-weight: 500;\n    padding: 0.75rem 1rem !important;\n    transition: all 0.3s ease !important;\n}\n\n.gaming-input:focus {\n    border-color: var(--accent) !important;\n    box-shadow: 0 0 0 0.2rem rgba(15, 52, 96, 0.25) !important;\n    background: rgba(26, 26, 46, 0.9) !important;\n}\n\n.gaming-input::placeholder {\n    color: var(--text-50);\n}\n\n/* Hero Section */\n.hero-section {\n    background: linear-gradient(135deg, var(--background) 0%, var(--primary) 50%, var(--secondary) 100%);\n    position: relative;\n    overflow: hidden;\n}\n\n.hero-section:before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: radial-gradient(circle at 30% 20%, rgba(15, 52, 96, 0.3) 0%, transparent 50%);\n}\n\n/* Statistics Cards */\n.stat-card {\n    transition: all 0.3s ease;\n    border: 1px solid transparent;\n}\n\n.stat-card:hover {\n    border-color: var(--accent);\n    transform: translateY(-3px);\n}\n\n.stat-card h3, .stat-card h4 {\n    font-family: 'Orbitron', monospace;\n    font-weight: 700;\n}\n\n/* Tournament Cards */\n.tournament-card {\n    transition: all 0.3s ease;\n    border: 1px solid rgba(15, 52, 96, 0.3);\n}\n\n.tournament-card:hover {\n    transform: translateY(-8px);\n    border-color: var(--accent);\n    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);\n}\n\n.tournament-header {\n    border-bottom: 1px solid rgba(15, 52, 96, 0.3);\n    margin-bottom: 1rem;\n    padding-bottom: 1rem;\n}\n\n.tournament-progress .progress {\n    background-color: rgba(15, 52, 96, 0.3);\n}\n\n.tournament-progress .progress-bar {\n    background: linear-gradient(90deg, var(--accent), var(--success));\n}\n\n/* Match Cards */\n.match-card {\n    transition: all 0.3s ease;\n}\n\n.match-card:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);\n}\n\n.vs-indicator {\n    font-size: 1.5rem;\n    opacity: 0.8;\n}\n\n.team-info {\n    flex: 1;\n}\n\n.team-name {\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.team-score {\n    margin-top: 0.5rem;\n}\n\n/* Tables */\n.table-dark {\n    background-color: transparent;\n}\n\n.table-dark th {\n    background-color: rgba(15, 52, 96, 0.3);\n    border-color: rgba(15, 52, 96, 0.5);\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    font-size: 0.9rem;\n}\n\n.table-dark td {\n    border-color: rgba(15, 52, 96, 0.3);\n    vertical-align: middle;\n}\n\n.table-hover tbody tr:hover {\n    background-color: rgba(15, 52, 96, 0.2);\n}\n\n/* Alerts */\n.alert {\n    border-radius: 8px;\n    border: none;\n    font-weight: 500;\n}\n\n.alert-success {\n    background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05));\n    color: var(--success);\n    border: 1px solid rgba(0, 255, 136, 0.3);\n}\n\n.alert-warning {\n    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 107, 53, 0.05));\n    color: var(--warning);\n    border: 1px solid rgba(255, 107, 53, 0.3);\n}\n\n.alert-danger {\n    background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05));\n    color: #dc3545;\n    border: 1px solid rgba(220, 53, 69, 0.3);\n}\n\n.alert-info {\n    background: linear-gradient(135deg, rgba(15, 52, 96, 0.1), rgba(15, 52, 96, 0.05));\n    color: var(--accent);\n    border: 1px solid rgba(15, 52, 96, 0.3);\n}\n\n/* Badges */\n.badge {\n    font-weight: 600;\n    letter-spacing: 0.3px;\n    padding: 0.5em 0.75em;\n}\n\n/* Authentication Pages */\n.auth-page {\n    height: 100vh;\n    background: linear-gradient(135deg, var(--background) 0%, var(--primary) 100%);\n}\n\n.auth-page .gaming-card {\n    max-width: 100%;\n    backdrop-filter: blur(10px);\n}\n\n/* Admin Layout */\n.main-content {\n    padding: 2rem;\n    min-height: 100vh;\n}\n\n.sidebar {\n    background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);\n    border-right: 2px solid var(--accent);\n    min-height: 100vh;\n    position: sticky;\n    top: 0;\n    padding-top: 80px;\n}\n\n.sidebar .nav-link {\n    color: var(--text-75);\n    padding: 1rem 1.5rem;\n    transition: all 0.3s ease;\n    border-left: 3px solid transparent;\n}\n\n.sidebar .nav-link:hover {\n    color: var(--accent);\n    background: rgba(15, 52, 96, 0.2);\n    border-left-color: var(--accent);\n}\n\n.sidebar .nav-link.active {\n    color: var(--accent);\n    background: rgba(15, 52, 96, 0.3);\n    border-left-color: var(--accent);\n}\n\n/* Avatar */\n.avatar-sm {\n    width: 32px;\n    height: 32px;\n    line-height: 32px;\n    font-size: 14px;\n}\n\n/* Wallet Display */\n.wallet-display {\n    background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05));\n    border: 1px solid rgba(0, 255, 136, 0.3);\n    border-radius: 8px;\n    padding: 1rem;\n    text-align: center;\n}\n\n/* Payment Methods */\n.payment-methods .method-item {\n    padding: 0.5rem;\n    border-radius: 6px;\n    background: rgba(15, 52, 96, 0.1);\n    border: 1px solid rgba(15, 52, 96, 0.3);\n}\n\n/* Screenshot Preview */\n.screenshot-preview {\n    border: 2px dashed var(--accent);\n    border-radius: 8px;\n    padding: 1rem;\n    text-align: center;\n    background: rgba(15, 52, 96, 0.1);\n}\n\n.screenshot-preview img {\n    border-radius: 8px;\n}\n\n/* Upload Item */\n.upload-item {\n    padding: 0.5rem;\n    border-radius: 6px;\n    background: rgba(15, 52, 96, 0.05);\n}\n\n/* Match Details */\n.match-details-view th {\n    width: 30%;\n    font-weight: 600;\n    color: var(--text-75);\n}\n\n.screenshot-section {\n    padding: 1rem;\n    border-radius: 8px;\n    background: rgba(15, 52, 96, 0.05);\n    border: 1px solid rgba(15, 52, 96, 0.2);\n    margin-bottom: 1rem;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    .gaming-card {\n        padding: 1.5rem;\n    }\n    \n    .main-content {\n        padding: 1rem;\n    }\n    \n    .sidebar {\n        position: static;\n        min-height: auto;\n        padding-top: 0;\n    }\n    \n    .hero-section {\n        padding: 2rem 0;\n    }\n    \n    .tournament-card, .match-card {\n        margin-bottom: 1rem;\n    }\n    \n    .stat-card h3, .stat-card h4 {\n        font-size: 1.5rem;\n    }\n}\n\n@media (max-width: 576px) {\n    .navbar-brand {\n        font-size: 1.2rem;\n    }\n    \n    .btn {\n        font-size: 0.9rem;\n        padding: 0.5rem 1rem;\n    }\n    \n    .gaming-card {\n        padding: 1rem;\n        margin-bottom: 1rem;\n    }\n    \n    .table-responsive {\n        font-size: 0.9rem;\n    }\n}\n\n/* Animation */\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.gaming-card {\n    animation: fadeInUp 0.6s ease;\n}\n\n/* Loading States */\n.loading {\n    position: relative;\n    pointer-events: none;\n}\n\n.loading:after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 20px;\n    height: 20px;\n    margin: -10px 0 0 -10px;\n    border: 2px solid var(--accent);\n    border-radius: 50%;\n    border-top-color: transparent;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n/* Progress Bars */\n.progress {\n    background-color: rgba(15, 52, 96, 0.2);\n    border-radius: 4px;\n    overflow: hidden;\n}\n\n.progress-bar {\n    background: linear-gradient(90deg, var(--accent), var(--success));\n    transition: width 0.6s ease;\n}\n\n/* Custom Scrollbar */\n::-webkit-scrollbar {\n    width: 8px;\n}\n\n::-webkit-scrollbar-track {\n    background: var(--background);\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--accent);\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--success);\n}\n\n/* Focus States */\n.btn:focus,\n.gaming-input:focus,\n.form-select:focus {\n    outline: none;\n    box-shadow: 0 0 0 0.2rem rgba(15, 52, 96, 0.25);\n}\n\n/* Dropdown Menus */\n.dropdown-menu-dark {\n    background: var(--primary);\n    border: 1px solid var(--accent);\n    border-radius: 8px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n}\n\n.dropdown-item:hover {\n    background: rgba(15, 52, 96, 0.3);\n    color: var(--accent);\n}\n\n/* Modal */\n.modal-content {\n    border: 1px solid var(--accent);\n    border-radius: 12px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n}\n\n.modal-header {\n    border-bottom: 1px solid rgba(15, 52, 96, 0.3);\n}\n\n/* Utility Classes */\n.border-accent {\n    border-color: var(--accent) !important;\n}\n\n.bg-primary {\n    background: var(--primary) !important;\n}\n\n.bg-secondary {\n    background: var(--secondary) !important;\n}\n\n.bg-accent {\n    background: var(--accent) !important;\n}\n\n.text-primary {\n    color: var(--primary) !important;\n}\n\n.text-secondary {\n    color: var(--secondary) !important;\n}\n\n/* Print Styles */\n@media print {\n    body {\n        background: white !important;\n        color: black !important;\n    }\n    \n    .gaming-card {\n        background: white !important;\n        border: 1px solid #ccc !important;\n        box-shadow: none !important;\n    }\n    \n    .navbar, .sidebar {\n        display: none !important;\n    }\n}\n","size_bytes":12177},"assets/js/main.js":{"content":"/**\n * eSports Tournament Management System - Main JavaScript\n */\n\n// Global configurations\nconst CONFIG = {\n    ajaxTimeout: 30000,\n    uploadMaxSize: 5 * 1024 * 1024, // 5MB\n    animationDuration: 300\n};\n\n// Initialize application\ndocument.addEventListener('DOMContentLoaded', function() {\n    initializeApp();\n});\n\n/**\n * Initialize the application\n */\nfunction initializeApp() {\n    // Initialize components\n    initializeTooltips();\n    initializeModals();\n    initializeFormValidation();\n    initializeFileUploads();\n    initializeAjaxForms();\n    initializeNotifications();\n    \n    // Auto-hide alerts after 5 seconds\n    setTimeout(hideAlerts, 5000);\n    \n    // Initialize page-specific functionality\n    const page = getCurrentPage();\n    switch(page) {\n        case 'dashboard':\n            initializeDashboard();\n            break;\n        case 'tournaments':\n            initializeTournaments();\n            break;\n        case 'matches':\n            initializeMatches();\n            break;\n        case 'payments':\n            initializePayments();\n            break;\n        case 'upload':\n            initializeUpload();\n            break;\n        case 'admin':\n            initializeAdmin();\n            break;\n    }\n}\n\n/**\n * Get current page identifier\n */\nfunction getCurrentPage() {\n    const path = window.location.pathname;\n    if (path.includes('dashboard')) return 'dashboard';\n    if (path.includes('tournament')) return 'tournaments';\n    if (path.includes('match')) return 'matches';\n    if (path.includes('payment')) return 'payments';\n    if (path.includes('upload')) return 'upload';\n    if (path.includes('admin')) return 'admin';\n    return 'home';\n}\n\n/**\n * Initialize Bootstrap tooltips\n */\nfunction initializeTooltips() {\n    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle=\"tooltip\"]'));\n    tooltipTriggerList.map(function(tooltipTriggerEl) {\n        return new bootstrap.Tooltip(tooltipTriggerEl);\n    });\n}\n\n/**\n * Initialize Bootstrap modals\n */\nfunction initializeModals() {\n    const modalElements = document.querySelectorAll('.modal');\n    modalElements.forEach(modalElement => {\n        modalElement.addEventListener('shown.bs.modal', function() {\n            const firstInput = modalElement.querySelector('input, textarea, select');\n            if (firstInput) {\n                firstInput.focus();\n            }\n        });\n    });\n}\n\n/**\n * Initialize form validation\n */\nfunction initializeFormValidation() {\n    const forms = document.querySelectorAll('.needs-validation');\n    \n    forms.forEach(form => {\n        form.addEventListener('submit', function(event) {\n            if (!form.checkValidity()) {\n                event.preventDefault();\n                event.stopPropagation();\n                \n                // Focus on first invalid field\n                const firstInvalid = form.querySelector(':invalid');\n                if (firstInvalid) {\n                    firstInvalid.focus();\n                    showNotification('Please correct the highlighted errors', 'error');\n                }\n            }\n            \n            form.classList.add('was-validated');\n        });\n    });\n    \n    // Real-time validation\n    const inputs = document.querySelectorAll('input, textarea, select');\n    inputs.forEach(input => {\n        input.addEventListener('blur', function() {\n            validateField(this);\n        });\n        \n        input.addEventListener('input', function() {\n            if (this.classList.contains('is-invalid')) {\n                validateField(this);\n            }\n        });\n    });\n}\n\n/**\n * Validate individual field\n */\nfunction validateField(field) {\n    if (field.checkValidity()) {\n        field.classList.remove('is-invalid');\n        field.classList.add('is-valid');\n    } else {\n        field.classList.remove('is-valid');\n        field.classList.add('is-invalid');\n    }\n}\n\n/**\n * Initialize file upload components\n */\nfunction initializeFileUploads() {\n    const fileInputs = document.querySelectorAll('input[type=\"file\"]');\n    \n    fileInputs.forEach(input => {\n        input.addEventListener('change', function() {\n            validateFile(this);\n            previewFile(this);\n        });\n        \n        // Drag and drop\n        const dropZone = input.closest('.file-drop-zone');\n        if (dropZone) {\n            initializeDragDrop(dropZone, input);\n        }\n    });\n}\n\n/**\n * Validate file upload\n */\nfunction validateFile(input) {\n    const file = input.files[0];\n    if (!file) return true;\n    \n    // Check file size\n    if (file.size > CONFIG.uploadMaxSize) {\n        showNotification(`File size exceeds ${formatFileSize(CONFIG.uploadMaxSize)} limit`, 'error');\n        input.value = '';\n        return false;\n    }\n    \n    // Check file type for images\n    if (input.accept && input.accept.includes('image/')) {\n        const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\n        if (!validTypes.includes(file.type)) {\n            showNotification('Please select a valid image file (JPG, PNG, GIF, WEBP)', 'error');\n            input.value = '';\n            return false;\n        }\n    }\n    \n    return true;\n}\n\n/**\n * Preview uploaded file\n */\nfunction previewFile(input) {\n    const file = input.files[0];\n    if (!file) return;\n    \n    const previewContainer = document.getElementById('filePreview') || \n                           input.parentElement.querySelector('.file-preview');\n    \n    if (!previewContainer) return;\n    \n    if (file.type.startsWith('image/')) {\n        const reader = new FileReader();\n        reader.onload = function(e) {\n            previewContainer.innerHTML = `\n                <img src=\"${e.target.result}\" class=\"img-fluid rounded\" style=\"max-height: 200px;\">\n                <button type=\"button\" class=\"btn btn-sm btn-danger mt-2\" onclick=\"clearFilePreview('${input.id}')\">\n                    <i class=\"fas fa-trash\"></i> Remove\n                </button>\n            `;\n            previewContainer.style.display = 'block';\n        };\n        reader.readAsDataURL(file);\n    } else {\n        previewContainer.innerHTML = `\n            <div class=\"file-info\">\n                <i class=\"fas fa-file fa-2x mb-2\"></i>\n                <div>${file.name}</div>\n                <small class=\"text-muted\">${formatFileSize(file.size)}</small>\n            </div>\n        `;\n        previewContainer.style.display = 'block';\n    }\n}\n\n/**\n * Clear file preview\n */\nfunction clearFilePreview(inputId) {\n    const input = document.getElementById(inputId);\n    const previewContainer = input.parentElement.querySelector('.file-preview');\n    \n    input.value = '';\n    previewContainer.style.display = 'none';\n    previewContainer.innerHTML = '';\n}\n\n/**\n * Initialize drag and drop\n */\nfunction initializeDragDrop(dropZone, fileInput) {\n    dropZone.addEventListener('dragover', function(e) {\n        e.preventDefault();\n        dropZone.classList.add('drag-over');\n    });\n    \n    dropZone.addEventListener('dragleave', function() {\n        dropZone.classList.remove('drag-over');\n    });\n    \n    dropZone.addEventListener('drop', function(e) {\n        e.preventDefault();\n        dropZone.classList.remove('drag-over');\n        \n        const files = e.dataTransfer.files;\n        if (files.length > 0) {\n            fileInput.files = files;\n            fileInput.dispatchEvent(new Event('change'));\n        }\n    });\n}\n\n/**\n * Initialize AJAX forms\n */\nfunction initializeAjaxForms() {\n    const ajaxForms = document.querySelectorAll('.ajax-form');\n    \n    ajaxForms.forEach(form => {\n        form.addEventListener('submit', function(e) {\n            e.preventDefault();\n            submitAjaxForm(this);\n        });\n    });\n}\n\n/**\n * Submit AJAX form\n */\nfunction submitAjaxForm(form) {\n    const submitBtn = form.querySelector('button[type=\"submit\"]');\n    const originalBtnText = submitBtn.innerHTML;\n    \n    // Show loading state\n    submitBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Processing...';\n    submitBtn.disabled = true;\n    \n    const formData = new FormData(form);\n    \n    fetch(form.action || window.location.href, {\n        method: 'POST',\n        body: formData,\n        headers: {\n            'X-Requested-With': 'XMLHttpRequest'\n        }\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            showNotification(data.message || 'Operation completed successfully', 'success');\n            \n            // Handle redirect\n            if (data.redirect) {\n                setTimeout(() => {\n                    window.location.href = data.redirect;\n                }, 1500);\n            }\n            \n            // Handle modal close\n            const modal = form.closest('.modal');\n            if (modal) {\n                const modalInstance = bootstrap.Modal.getInstance(modal);\n                modalInstance.hide();\n            }\n            \n            // Handle form reset\n            if (data.reset_form) {\n                form.reset();\n            }\n        } else {\n            showNotification(data.error || 'An error occurred', 'error');\n        }\n    })\n    .catch(error => {\n        console.error('Error:', error);\n        showNotification('Network error occurred', 'error');\n    })\n    .finally(() => {\n        // Restore button state\n        submitBtn.innerHTML = originalBtnText;\n        submitBtn.disabled = false;\n    });\n}\n\n/**\n * Show notification\n */\nfunction showNotification(message, type = 'info', duration = 5000) {\n    // Remove existing notifications\n    const existingNotifications = document.querySelectorAll('.toast-notification');\n    existingNotifications.forEach(notification => notification.remove());\n    \n    // Create notification element\n    const notification = document.createElement('div');\n    notification.className = `toast-notification alert alert-${getBootstrapAlertClass(type)} alert-dismissible fade show`;\n    notification.innerHTML = `\n        ${getNotificationIcon(type)} ${message}\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\n    `;\n    \n    // Style notification\n    notification.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 9999;\n        min-width: 300px;\n        max-width: 500px;\n        animation: slideInRight 0.3s ease;\n    `;\n    \n    document.body.appendChild(notification);\n    \n    // Auto-hide notification\n    if (duration > 0) {\n        setTimeout(() => {\n            if (notification.parentNode) {\n                notification.classList.remove('show');\n                setTimeout(() => notification.remove(), 150);\n            }\n        }, duration);\n    }\n}\n\n/**\n * Get Bootstrap alert class for notification type\n */\nfunction getBootstrapAlertClass(type) {\n    const classMap = {\n        'success': 'success',\n        'error': 'danger',\n        'warning': 'warning',\n        'info': 'info'\n    };\n    return classMap[type] || 'info';\n}\n\n/**\n * Get notification icon\n */\nfunction getNotificationIcon(type) {\n    const iconMap = {\n        'success': '<i class=\"fas fa-check-circle\"></i>',\n        'error': '<i class=\"fas fa-exclamation-triangle\"></i>',\n        'warning': '<i class=\"fas fa-exclamation-circle\"></i>',\n        'info': '<i class=\"fas fa-info-circle\"></i>'\n    };\n    return iconMap[type] || iconMap['info'];\n}\n\n/**\n * Initialize notifications\n */\nfunction initializeNotifications() {\n    // Auto-dismiss alerts with close button\n    document.addEventListener('click', function(e) {\n        if (e.target.matches('.alert .btn-close') || e.target.closest('.alert .btn-close')) {\n            const alert = e.target.closest('.alert');\n            if (alert) {\n                alert.classList.remove('show');\n                setTimeout(() => alert.remove(), 150);\n            }\n        }\n    });\n}\n\n/**\n * Hide alerts automatically\n */\nfunction hideAlerts() {\n    const alerts = document.querySelectorAll('.alert:not(.alert-permanent)');\n    alerts.forEach(alert => {\n        if (!alert.querySelector('.btn-close')) return;\n        \n        alert.classList.add('fade');\n        setTimeout(() => {\n            if (alert.parentNode) {\n                alert.remove();\n            }\n        }, 150);\n    });\n}\n\n/**\n * Initialize dashboard functionality\n */\nfunction initializeDashboard() {\n    // Update statistics periodically\n    updateStatistics();\n    setInterval(updateStatistics, 60000); // Update every minute\n    \n    // Initialize chart if present\n    initializeDashboardCharts();\n}\n\n/**\n * Update dashboard statistics\n */\nfunction updateStatistics() {\n    fetch('../api/dashboard_stats.php')\n        .then(response => response.json())\n        .then(data => {\n            if (data.success) {\n                updateStatCards(data.stats);\n            }\n        })\n        .catch(error => console.error('Error updating statistics:', error));\n}\n\n/**\n * Update statistic cards\n */\nfunction updateStatCards(stats) {\n    Object.keys(stats).forEach(key => {\n        const element = document.querySelector(`[data-stat=\"${key}\"]`);\n        if (element) {\n            animateNumber(element, stats[key]);\n        }\n    });\n}\n\n/**\n * Animate number change\n */\nfunction animateNumber(element, newValue) {\n    const currentValue = parseInt(element.textContent) || 0;\n    const increment = (newValue - currentValue) / 20;\n    let current = currentValue;\n    \n    const timer = setInterval(() => {\n        current += increment;\n        if ((increment > 0 && current >= newValue) || (increment < 0 && current <= newValue)) {\n            current = newValue;\n            clearInterval(timer);\n        }\n        element.textContent = Math.round(current).toLocaleString();\n    }, 50);\n}\n\n/**\n * Initialize dashboard charts\n */\nfunction initializeDashboardCharts() {\n    // This would integrate with Chart.js if charts are needed\n    const chartElements = document.querySelectorAll('.chart-container');\n    chartElements.forEach(element => {\n        // Initialize chart based on data attributes\n        const chartType = element.dataset.chartType;\n        const chartData = JSON.parse(element.dataset.chartData || '{}');\n        \n        if (typeof Chart !== 'undefined') {\n            createChart(element, chartType, chartData);\n        }\n    });\n}\n\n/**\n * Initialize tournaments page\n */\nfunction initializeTournaments() {\n    // Filter functionality\n    initializeTournamentFilters();\n    \n    // Registration modal handling\n    initializeTournamentRegistration();\n}\n\n/**\n * Initialize tournament filters\n */\nfunction initializeTournamentFilters() {\n    const filterForm = document.querySelector('.tournament-filters');\n    if (!filterForm) return;\n    \n    const filterInputs = filterForm.querySelectorAll('select, input');\n    filterInputs.forEach(input => {\n        input.addEventListener('change', debounce(filterTournaments, 300));\n    });\n}\n\n/**\n * Filter tournaments\n */\nfunction filterTournaments() {\n    const formData = new FormData(document.querySelector('.tournament-filters'));\n    const params = new URLSearchParams(formData);\n    \n    fetch(`?${params.toString()}`)\n        .then(response => response.text())\n        .then(html => {\n            const parser = new DOMParser();\n            const newDoc = parser.parseFromString(html, 'text/html');\n            const newContent = newDoc.querySelector('.tournaments-container');\n            const currentContent = document.querySelector('.tournaments-container');\n            \n            if (newContent && currentContent) {\n                currentContent.innerHTML = newContent.innerHTML;\n            }\n        })\n        .catch(error => console.error('Error filtering tournaments:', error));\n}\n\n/**\n * Initialize tournament registration\n */\nfunction initializeTournamentRegistration() {\n    const registrationForms = document.querySelectorAll('.tournament-registration-form');\n    registrationForms.forEach(form => {\n        form.addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const tournamentName = form.dataset.tournamentName;\n            const entryFee = form.dataset.entryFee;\n            \n            if (entryFee > 0) {\n                const confirmMsg = `This tournament requires an entry fee of ৳${entryFee}. Do you want to proceed?`;\n                if (!confirm(confirmMsg)) {\n                    return;\n                }\n            }\n            \n            submitAjaxForm(form);\n        });\n    });\n}\n\n/**\n * Initialize matches page\n */\nfunction initializeMatches() {\n    // Auto-refresh match status\n    setInterval(refreshMatchStatus, 30000); // Refresh every 30 seconds\n    \n    // Initialize match screenshot modal\n    initializeScreenshotModal();\n}\n\n/**\n * Refresh match status\n */\nfunction refreshMatchStatus() {\n    const matchCards = document.querySelectorAll('.match-card[data-match-id]');\n    \n    matchCards.forEach(card => {\n        const matchId = card.dataset.matchId;\n        \n        fetch(`../api/match_status.php?match_id=${matchId}`)\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    updateMatchCard(card, data.match);\n                }\n            })\n            .catch(error => console.error('Error refreshing match status:', error));\n    });\n}\n\n/**\n * Update match card with new data\n */\nfunction updateMatchCard(card, matchData) {\n    // Update status badge\n    const statusBadge = card.querySelector('.match-status');\n    if (statusBadge) {\n        statusBadge.className = `badge bg-${getMatchStatusClass(matchData.status)}`;\n        statusBadge.textContent = matchData.status.charAt(0).toUpperCase() + matchData.status.slice(1);\n    }\n    \n    // Update scores if match is completed\n    if (matchData.status === 'completed' && matchData.score1 !== null) {\n        const score1Element = card.querySelector('.team1-score');\n        const score2Element = card.querySelector('.team2-score');\n        \n        if (score1Element) score1Element.textContent = matchData.score1;\n        if (score2Element) score2Element.textContent = matchData.score2;\n    }\n}\n\n/**\n * Get match status CSS class\n */\nfunction getMatchStatusClass(status) {\n    const classMap = {\n        'scheduled': 'info',\n        'live': 'danger',\n        'completed': 'success',\n        'cancelled': 'secondary'\n    };\n    return classMap[status] || 'secondary';\n}\n\n/**\n * Initialize screenshot modal\n */\nfunction initializeScreenshotModal() {\n    const screenshotLinks = document.querySelectorAll('.screenshot-link');\n    \n    screenshotLinks.forEach(link => {\n        link.addEventListener('click', function(e) {\n            e.preventDefault();\n            showScreenshotModal(this.href, this.dataset.title);\n        });\n    });\n}\n\n/**\n * Show screenshot in modal\n */\nfunction showScreenshotModal(imageUrl, title) {\n    const modalHtml = `\n        <div class=\"modal fade\" id=\"screenshotModal\" tabindex=\"-1\">\n            <div class=\"modal-dialog modal-lg\">\n                <div class=\"modal-content bg-secondary\">\n                    <div class=\"modal-header border-0\">\n                        <h5 class=\"modal-title text-accent\">${title || 'Match Screenshot'}</h5>\n                        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n                    </div>\n                    <div class=\"modal-body text-center\">\n                        <img src=\"${imageUrl}\" class=\"img-fluid rounded\" alt=\"Match Screenshot\">\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    \n    // Remove existing modal\n    const existingModal = document.getElementById('screenshotModal');\n    if (existingModal) {\n        existingModal.remove();\n    }\n    \n    // Add new modal\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\n    \n    // Show modal\n    const modal = new bootstrap.Modal(document.getElementById('screenshotModal'));\n    modal.show();\n    \n    // Remove modal from DOM when hidden\n    document.getElementById('screenshotModal').addEventListener('hidden.bs.modal', function() {\n        this.remove();\n    });\n}\n\n/**\n * Initialize payments page\n */\nfunction initializePayments() {\n    // Initialize payment method selection\n    initializePaymentMethods();\n    \n    // Initialize receipt generation\n    initializeReceiptGeneration();\n}\n\n/**\n * Initialize payment methods\n */\nfunction initializePaymentMethods() {\n    const methodSelect = document.getElementById('payment_method');\n    if (!methodSelect) return;\n    \n    methodSelect.addEventListener('change', function() {\n        updatePaymentInstructions(this.value);\n    });\n    \n    // Initialize with current selection\n    if (methodSelect.value) {\n        updatePaymentInstructions(methodSelect.value);\n    }\n}\n\n/**\n * Update payment instructions based on method\n */\nfunction updatePaymentInstructions(method) {\n    const instructionsContainer = document.getElementById('payment_instructions');\n    if (!instructionsContainer) return;\n    \n    const instructions = {\n        'bkash': {\n            number: '01XXXXXXXXX',\n            steps: [\n                'Go to your bKash app',\n                'Select \"Send Money\"',\n                'Enter merchant number: 01XXXXXXXXX',\n                'Enter exact amount',\n                'Complete transaction',\n                'Copy transaction ID from SMS'\n            ]\n        },\n        'nagad': {\n            number: '01XXXXXXXXX',\n            steps: [\n                'Go to your Nagad app',\n                'Select \"Send Money\"',\n                'Enter merchant number: 01XXXXXXXXX',\n                'Enter exact amount',\n                'Complete transaction',\n                'Copy transaction ID from SMS'\n            ]\n        },\n        'rocket': {\n            number: '01XXXXXXXXX',\n            steps: [\n                'Dial *322# or use Rocket app',\n                'Select \"Send Money\"',\n                'Enter merchant number: 01XXXXXXXXX',\n                'Enter exact amount',\n                'Complete transaction',\n                'Copy transaction ID from SMS'\n            ]\n        }\n    };\n    \n    const methodData = instructions[method];\n    if (!methodData) {\n        instructionsContainer.innerHTML = '<p class=\"text-light-50\">Select a payment method to see instructions</p>';\n        return;\n    }\n    \n    const instructionsHtml = `\n        <div class=\"payment-instructions\">\n            <h6 class=\"text-accent\">Merchant Number: ${methodData.number}</h6>\n            <ol class=\"text-light-50\">\n                ${methodData.steps.map(step => `<li>${step}</li>`).join('')}\n            </ol>\n        </div>\n    `;\n    \n    instructionsContainer.innerHTML = instructionsHtml;\n}\n\n/**\n * Initialize receipt generation\n */\nfunction initializeReceiptGeneration() {\n    window.generateReceipt = function(paymentId) {\n        const receiptWindow = window.open('', '_blank');\n        receiptWindow.document.write('<html><body><h1>Loading receipt...</h1></body></html>');\n        \n        fetch(`../api/receipt.php?payment_id=${paymentId}`)\n            .then(response => response.text())\n            .then(html => {\n                receiptWindow.document.open();\n                receiptWindow.document.write(html);\n                receiptWindow.document.close();\n            })\n            .catch(error => {\n                receiptWindow.document.write('<h1>Error loading receipt</h1>');\n                console.error('Error generating receipt:', error);\n            });\n    };\n}\n\n/**\n * Initialize upload page\n */\nfunction initializeUpload() {\n    // Initialize drag and drop\n    const uploadArea = document.querySelector('.upload-area');\n    if (uploadArea) {\n        initializeUploadDragDrop(uploadArea);\n    }\n    \n    // Initialize file validation\n    const fileInput = document.getElementById('screenshot');\n    if (fileInput) {\n        fileInput.addEventListener('change', function() {\n            validateUploadFile(this);\n        });\n    }\n    \n    // Initialize progress tracking\n    initializeUploadProgress();\n}\n\n/**\n * Initialize upload drag and drop\n */\nfunction initializeUploadDragDrop(uploadArea) {\n    const fileInput = uploadArea.querySelector('input[type=\"file\"]');\n    \n    uploadArea.addEventListener('dragover', function(e) {\n        e.preventDefault();\n        uploadArea.classList.add('drag-over');\n    });\n    \n    uploadArea.addEventListener('dragleave', function() {\n        uploadArea.classList.remove('drag-over');\n    });\n    \n    uploadArea.addEventListener('drop', function(e) {\n        e.preventDefault();\n        uploadArea.classList.remove('drag-over');\n        \n        const files = e.dataTransfer.files;\n        if (files.length > 0 && fileInput) {\n            fileInput.files = files;\n            fileInput.dispatchEvent(new Event('change'));\n        }\n    });\n}\n\n/**\n * Validate upload file\n */\nfunction validateUploadFile(input) {\n    const file = input.files[0];\n    if (!file) return;\n    \n    // Validate file type\n    const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\n    if (!validTypes.includes(file.type)) {\n        showNotification('Please select a valid image file (JPG, PNG, GIF, WEBP)', 'error');\n        input.value = '';\n        return false;\n    }\n    \n    // Validate file size\n    if (file.size > CONFIG.uploadMaxSize) {\n        showNotification(`File size must be less than ${formatFileSize(CONFIG.uploadMaxSize)}`, 'error');\n        input.value = '';\n        return false;\n    }\n    \n    return true;\n}\n\n/**\n * Initialize upload progress\n */\nfunction initializeUploadProgress() {\n    const uploadForms = document.querySelectorAll('.upload-form');\n    \n    uploadForms.forEach(form => {\n        form.addEventListener('submit', function(e) {\n            e.preventDefault();\n            uploadWithProgress(form);\n        });\n    });\n}\n\n/**\n * Upload with progress tracking\n */\nfunction uploadWithProgress(form) {\n    const formData = new FormData(form);\n    const progressBar = document.getElementById('upload_progress');\n    const submitBtn = form.querySelector('button[type=\"submit\"]');\n    \n    if (progressBar) {\n        progressBar.style.display = 'block';\n        progressBar.querySelector('.progress-bar').style.width = '0%';\n    }\n    \n    if (submitBtn) {\n        submitBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Uploading...';\n        submitBtn.disabled = true;\n    }\n    \n    const xhr = new XMLHttpRequest();\n    \n    xhr.upload.addEventListener('progress', function(e) {\n        if (e.lengthComputable && progressBar) {\n            const percentComplete = (e.loaded / e.total) * 100;\n            progressBar.querySelector('.progress-bar').style.width = percentComplete + '%';\n        }\n    });\n    \n    xhr.addEventListener('load', function() {\n        try {\n            const response = JSON.parse(xhr.responseText);\n            if (response.success) {\n                showNotification(response.message || 'Upload successful!', 'success');\n                if (response.redirect) {\n                    setTimeout(() => window.location.href = response.redirect, 1500);\n                }\n            } else {\n                showNotification(response.error || 'Upload failed', 'error');\n            }\n        } catch (e) {\n            showNotification('Upload completed but response invalid', 'warning');\n        }\n    });\n    \n    xhr.addEventListener('error', function() {\n        showNotification('Network error during upload', 'error');\n    });\n    \n    xhr.addEventListener('loadend', function() {\n        if (progressBar) {\n            progressBar.style.display = 'none';\n        }\n        if (submitBtn) {\n            submitBtn.innerHTML = '<i class=\"fas fa-upload\"></i> Upload Screenshot';\n            submitBtn.disabled = false;\n        }\n    });\n    \n    xhr.open('POST', form.action);\n    xhr.send(formData);\n}\n\n/**\n * Initialize admin functionality\n */\nfunction initializeAdmin() {\n    // Initialize data tables\n    initializeDataTables();\n    \n    // Initialize admin modals\n    initializeAdminModals();\n    \n    // Initialize bulk actions\n    initializeBulkActions();\n}\n\n/**\n * Initialize data tables\n */\nfunction initializeDataTables() {\n    const tables = document.querySelectorAll('.data-table');\n    \n    tables.forEach(table => {\n        // Add sorting functionality\n        addTableSorting(table);\n        \n        // Add search functionality\n        addTableSearch(table);\n    });\n}\n\n/**\n * Add table sorting\n */\nfunction addTableSorting(table) {\n    const headers = table.querySelectorAll('th[data-sort]');\n    \n    headers.forEach(header => {\n        header.style.cursor = 'pointer';\n        header.addEventListener('click', function() {\n            const column = this.dataset.sort;\n            const currentSort = this.dataset.sortDirection || 'asc';\n            const newSort = currentSort === 'asc' ? 'desc' : 'asc';\n            \n            sortTable(table, column, newSort);\n            \n            // Update sort indicators\n            headers.forEach(h => {\n                h.classList.remove('sort-asc', 'sort-desc');\n                delete h.dataset.sortDirection;\n            });\n            \n            this.dataset.sortDirection = newSort;\n            this.classList.add(`sort-${newSort}`);\n        });\n    });\n}\n\n/**\n * Sort table by column\n */\nfunction sortTable(table, column, direction) {\n    const tbody = table.querySelector('tbody');\n    const rows = Array.from(tbody.querySelectorAll('tr'));\n    \n    rows.sort((a, b) => {\n        const aValue = a.querySelector(`[data-sort-value=\"${column}\"]`)?.textContent || \n                      a.cells[parseInt(column)]?.textContent || '';\n        const bValue = b.querySelector(`[data-sort-value=\"${column}\"]`)?.textContent || \n                      b.cells[parseInt(column)]?.textContent || '';\n        \n        const comparison = aValue.localeCompare(bValue, undefined, { numeric: true });\n        return direction === 'asc' ? comparison : -comparison;\n    });\n    \n    // Re-append rows in sorted order\n    rows.forEach(row => tbody.appendChild(row));\n}\n\n/**\n * Add table search\n */\nfunction addTableSearch(table) {\n    const searchInput = document.querySelector(`[data-table-search=\"${table.id}\"]`);\n    if (!searchInput) return;\n    \n    searchInput.addEventListener('input', debounce(function() {\n        filterTable(table, this.value);\n    }, 300));\n}\n\n/**\n * Filter table by search term\n */\nfunction filterTable(table, searchTerm) {\n    const tbody = table.querySelector('tbody');\n    const rows = tbody.querySelectorAll('tr');\n    const term = searchTerm.toLowerCase();\n    \n    rows.forEach(row => {\n        const text = row.textContent.toLowerCase();\n        row.style.display = text.includes(term) ? '' : 'none';\n    });\n}\n\n/**\n * Initialize admin modals\n */\nfunction initializeAdminModals() {\n    // Confirmation modals\n    const confirmButtons = document.querySelectorAll('[data-confirm]');\n    \n    confirmButtons.forEach(button => {\n        button.addEventListener('click', function(e) {\n            e.preventDefault();\n            \n            const message = this.dataset.confirm;\n            const href = this.href;\n            \n            if (confirm(message)) {\n                window.location.href = href;\n            }\n        });\n    });\n}\n\n/**\n * Initialize bulk actions\n */\nfunction initializeBulkActions() {\n    const bulkActionForm = document.querySelector('.bulk-action-form');\n    if (!bulkActionForm) return;\n    \n    const selectAllCheckbox = bulkActionForm.querySelector('.select-all');\n    const itemCheckboxes = bulkActionForm.querySelectorAll('.select-item');\n    const actionSelect = bulkActionForm.querySelector('.bulk-action-select');\n    const submitBtn = bulkActionForm.querySelector('.bulk-action-submit');\n    \n    // Select all functionality\n    if (selectAllCheckbox) {\n        selectAllCheckbox.addEventListener('change', function() {\n            itemCheckboxes.forEach(checkbox => {\n                checkbox.checked = this.checked;\n            });\n            updateBulkActionButton();\n        });\n    }\n    \n    // Update button state when individual items are selected\n    itemCheckboxes.forEach(checkbox => {\n        checkbox.addEventListener('change', updateBulkActionButton);\n    });\n    \n    function updateBulkActionButton() {\n        const selectedCount = bulkActionForm.querySelectorAll('.select-item:checked').length;\n        \n        if (submitBtn) {\n            submitBtn.disabled = selectedCount === 0 || !actionSelect?.value;\n            submitBtn.textContent = selectedCount > 0 ? \n                `Apply to ${selectedCount} item(s)` : \n                'Select items';\n        }\n    }\n    \n    // Handle action select change\n    if (actionSelect) {\n        actionSelect.addEventListener('change', updateBulkActionButton);\n    }\n}\n\n/**\n * Utility Functions\n */\n\n/**\n * Debounce function\n */\nfunction debounce(func, wait, immediate) {\n    let timeout;\n    return function executedFunction(...args) {\n        const later = () => {\n            timeout = null;\n            if (!immediate) func.apply(this, args);\n        };\n        const callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(this, args);\n    };\n}\n\n/**\n * Format file size\n */\nfunction formatFileSize(bytes) {\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    if (bytes === 0) return '0 Bytes';\n    const i = Math.floor(Math.log(bytes) / Math.log(1024));\n    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];\n}\n\n/**\n * Format currency\n */\nfunction formatCurrency(amount) {\n    return '৳' + parseFloat(amount).toLocaleString('en-BD', {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n    });\n}\n\n/**\n * Copy text to clipboard\n */\nfunction copyToClipboard(text) {\n    if (navigator.clipboard) {\n        navigator.clipboard.writeText(text).then(() => {\n            showNotification('Copied to clipboard!', 'success');\n        });\n    } else {\n        // Fallback for older browsers\n        const textarea = document.createElement('textarea');\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        document.execCommand('copy');\n        document.body.removeChild(textarea);\n        showNotification('Copied to clipboard!', 'success');\n    }\n}\n\n/**\n * Smooth scroll to element\n */\nfunction scrollToElement(element, offset = 0) {\n    const targetElement = typeof element === 'string' ? \n        document.querySelector(element) : element;\n    \n    if (targetElement) {\n        const elementPosition = targetElement.getBoundingClientRect().top;\n        const offsetPosition = elementPosition + window.pageYOffset - offset;\n        \n        window.scrollTo({\n            top: offsetPosition,\n            behavior: 'smooth'\n        });\n    }\n}\n\n/**\n * Check if element is in viewport\n */\nfunction isInViewport(element) {\n    const rect = element.getBoundingClientRect();\n    return (\n        rect.top >= 0 &&\n        rect.left >= 0 &&\n        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n        rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n    );\n}\n\n/**\n * Export functions for global use\n */\nwindow.eSports = {\n    showNotification,\n    copyToClipboard,\n    scrollToElement,\n    formatCurrency,\n    formatFileSize,\n    debounce\n};\n","size_bytes":35449},"admin/tournament_results.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$tournamentId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\nif (!$tournamentId) {\n    redirect('tournaments.php', 'Tournament not found', 'error');\n}\n\n// Get tournament details\n$stmt = $pdo->prepare(\"SELECT * FROM tournaments WHERE id = ?\");\n$stmt->execute([$tournamentId]);\n$tournament = $stmt->fetch();\n\nif (!$tournament) {\n    redirect('tournaments.php', 'Tournament not found', 'error');\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $winnerId = (int)($_POST['winner_id'] ?? 0);\n        $runnerUpId = (int)($_POST['runner_up_id'] ?? 0);\n        $thirdPlaceId = (int)($_POST['third_place_id'] ?? 0);\n        $winnerPrize = (float)($_POST['winner_prize'] ?? 0);\n        $runnerUpPrize = (float)($_POST['runner_up_prize'] ?? 0);\n        $thirdPlacePrize = (float)($_POST['third_place_prize'] ?? 0);\n        \n        if ($winnerId && $runnerUpId && $thirdPlaceId) {\n            try {\n                $pdo->beginTransaction();\n                \n                // Update tournament with results\n                $stmt = $pdo->prepare(\"\n                    UPDATE tournaments \n                    SET winner_id = ?, runner_up_id = ?, third_place_id = ?, \n                        winner_prize = ?, runner_up_prize = ?, third_place_prize = ?,\n                        status = 'completed', updated_at = CURRENT_TIMESTAMP\n                    WHERE id = ?\n                \");\n                $stmt->execute([$winnerId, $runnerUpId, $thirdPlaceId, $winnerPrize, $runnerUpPrize, $thirdPlacePrize, $tournamentId]);\n                \n                // Add prize money to winner's wallet\n                if ($winnerPrize > 0) {\n                    $stmt = $pdo->prepare(\"UPDATE users SET wallet_balance = wallet_balance + ? WHERE id = ?\");\n                    $stmt->execute([$winnerPrize, $winnerId]);\n                    \n                    // Create notification for winner\n                    $stmt = $pdo->prepare(\"\n                        INSERT INTO notifications (user_id, title, message, type) \n                        VALUES (?, ?, ?, ?)\n                    \");\n                    $stmt->execute([$winnerId, 'Congratulations! You Won!', \n                        \"You won the tournament '{$tournament['name']}' and earned $\" . number_format($winnerPrize, 2) . \"! The amount has been added to your wallet.\", 'success']);\n                }\n                \n                // Add prize money to runner-up's wallet\n                if ($runnerUpPrize > 0) {\n                    $stmt = $pdo->prepare(\"UPDATE users SET wallet_balance = wallet_balance + ? WHERE id = ?\");\n                    $stmt->execute([$runnerUpPrize, $runnerUpId]);\n                    \n                    // Create notification for runner-up\n                    $stmt = $pdo->prepare(\"\n                        INSERT INTO notifications (user_id, title, message, type) \n                        VALUES (?, ?, ?, ?)\n                    \");\n                    $stmt->execute([$runnerUpId, 'Great Job! You\\'re Runner-up!', \n                        \"You came 2nd in the tournament '{$tournament['name']}' and earned $\" . number_format($runnerUpPrize, 2) . \"! The amount has been added to your wallet.\", 'success']);\n                }\n                \n                // Add prize money to third place's wallet\n                if ($thirdPlacePrize > 0) {\n                    $stmt = $pdo->prepare(\"UPDATE users SET wallet_balance = wallet_balance + ? WHERE id = ?\");\n                    $stmt->execute([$thirdPlacePrize, $thirdPlaceId]);\n                    \n                    // Create notification for third place\n                    $stmt = $pdo->prepare(\"\n                        INSERT INTO notifications (user_id, title, message, type) \n                        VALUES (?, ?, ?, ?)\n                    \");\n                    $stmt->execute([$thirdPlaceId, 'Excellent Performance! Third Place!', \n                        \"You came 3rd in the tournament '{$tournament['name']}' and earned $\" . number_format($thirdPlacePrize, 2) . \"! The amount has been added to your wallet.\", 'success']);\n                }\n                \n                $pdo->commit();\n                $success = 'Tournament results published successfully! Prize money has been distributed.';\n                \n                // Refresh tournament data\n                $stmt = $pdo->prepare(\"SELECT * FROM tournaments WHERE id = ?\");\n                $stmt->execute([$tournamentId]);\n                $tournament = $stmt->fetch();\n                \n            } catch (PDOException $e) {\n                $pdo->rollback();\n                $error = 'Database error: ' . $e->getMessage();\n            }\n        } else {\n            $error = 'Please select all three positions';\n        }\n    }\n}\n\n// Get registered users for this tournament\n$stmt = $pdo->prepare(\"\n    SELECT u.id, u.username, u.full_name, tr.team_name \n    FROM users u \n    JOIN tournament_registrations tr ON u.id = tr.user_id \n    WHERE tr.tournament_id = ? AND tr.status = 'approved'\n    ORDER BY u.username\n\");\n$stmt->execute([$tournamentId]);\n$registeredUsers = $stmt->fetchAll();\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Tournament Results - <?= htmlspecialchars($tournament['name']) ?></title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body class=\"admin-page\">\n    <?php include 'includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include 'includes/sidebar.php'; ?>\n            \n            <main class=\"col-md-9 ms-sm-auto col-lg-10 px-md-4\">\n                <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n                    <h1 class=\"text-accent\">\n                        <i class=\"fas fa-trophy\"></i> Tournament Results\n                    </h1>\n                    <a href=\"tournaments.php\" class=\"btn btn-outline-secondary\">\n                        <i class=\"fas fa-arrow-left\"></i> Back to Tournaments\n                    </a>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <div class=\"row\">\n                    <div class=\"col-lg-6\">\n                        <div class=\"gaming-card\">\n                            <h4 class=\"text-accent mb-3\">\n                                <i class=\"fas fa-info-circle\"></i> Tournament Details\n                            </h4>\n                            <div class=\"mb-2\"><strong>Name:</strong> <?= htmlspecialchars($tournament['name']) ?></div>\n                            <div class=\"mb-2\"><strong>Game:</strong> <?= htmlspecialchars($tournament['game_type']) ?></div>\n                            <div class=\"mb-2\"><strong>Status:</strong> \n                                <span class=\"badge bg-<?= $tournament['status'] === 'completed' ? 'success' : 'warning' ?>\">\n                                    <?= ucfirst($tournament['status']) ?>\n                                </span>\n                            </div>\n                            <div class=\"mb-2\"><strong>Prize Pool:</strong> $<?= number_format($tournament['prize_pool'], 2) ?></div>\n                            <div class=\"mb-2\"><strong>Registered Teams:</strong> <?= count($registeredUsers) ?></div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-lg-6\">\n                        <?php if ($tournament['status'] === 'completed'): ?>\n                            <div class=\"gaming-card\">\n                                <h4 class=\"text-accent mb-3\">\n                                    <i class=\"fas fa-crown\"></i> Final Results\n                                </h4>\n                                <?php \n                                // Get winner details\n                                if ($tournament['winner_id']) {\n                                    $stmt = $pdo->prepare(\"SELECT username, full_name FROM users WHERE id = ?\");\n                                    $stmt->execute([$tournament['winner_id']]);\n                                    $winner = $stmt->fetch();\n                                }\n                                if ($tournament['runner_up_id']) {\n                                    $stmt = $pdo->prepare(\"SELECT username, full_name FROM users WHERE id = ?\");\n                                    $stmt->execute([$tournament['runner_up_id']]);\n                                    $runnerUp = $stmt->fetch();\n                                }\n                                if ($tournament['third_place_id']) {\n                                    $stmt = $pdo->prepare(\"SELECT username, full_name FROM users WHERE id = ?\");\n                                    $stmt->execute([$tournament['third_place_id']]);\n                                    $thirdPlace = $stmt->fetch();\n                                }\n                                ?>\n                                \n                                <div class=\"mb-3\">\n                                    <div class=\"d-flex align-items-center\">\n                                        <i class=\"fas fa-trophy text-warning me-2\" style=\"font-size: 1.5rem;\"></i>\n                                        <div>\n                                            <strong>Winner:</strong> <?= isset($winner) ? htmlspecialchars($winner['full_name']) . ' (@' . htmlspecialchars($winner['username']) . ')' : 'Not set' ?><br>\n                                            <small class=\"text-success\">Prize: $<?= number_format($tournament['winner_prize'], 2) ?></small>\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"mb-3\">\n                                    <div class=\"d-flex align-items-center\">\n                                        <i class=\"fas fa-medal text-info me-2\" style=\"font-size: 1.5rem;\"></i>\n                                        <div>\n                                            <strong>Runner-up:</strong> <?= isset($runnerUp) ? htmlspecialchars($runnerUp['full_name']) . ' (@' . htmlspecialchars($runnerUp['username']) . ')' : 'Not set' ?><br>\n                                            <small class=\"text-success\">Prize: $<?= number_format($tournament['runner_up_prize'], 2) ?></small>\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"mb-3\">\n                                    <div class=\"d-flex align-items-center\">\n                                        <i class=\"fas fa-award text-secondary me-2\" style=\"font-size: 1.5rem;\"></i>\n                                        <div>\n                                            <strong>Third Place:</strong> <?= isset($thirdPlace) ? htmlspecialchars($thirdPlace['full_name']) . ' (@' . htmlspecialchars($thirdPlace['username']) . ')' : 'Not set' ?><br>\n                                            <small class=\"text-success\">Prize: $<?= number_format($tournament['third_place_prize'], 2) ?></small>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                </div>\n                \n                <?php if ($tournament['status'] !== 'completed'): ?>\n                <div class=\"gaming-card mt-4\">\n                    <h4 class=\"text-accent mb-3\">\n                        <i class=\"fas fa-clipboard-list\"></i> Publish Final Tournament Results\n                    </h4>\n                    \n                    <div class=\"alert alert-warning mb-4\">\n                        <h6 class=\"text-warning\"><i class=\"fas fa-exclamation-triangle\"></i> Important:</h6>\n                        <p class=\"mb-2\">This page is for selecting the <strong>overall tournament winners</strong> (Champion, Runner-up, 3rd Place) - the final tournament ranking.</p>\n                        <p class=\"mb-0\">For individual match results and screenshot reviews, use the <a href=\"results.php\" class=\"text-accent\">Match Results</a> page.</p>\n                    </div>\n                    \n                    <form method=\"POST\">\n                        <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                        \n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <div class=\"mb-3\">\n                                    <label for=\"winner_id\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-trophy text-warning\"></i> Champion (1st Place) *\n                                    </label>\n                                    <select class=\"form-select gaming-input\" id=\"winner_id\" name=\"winner_id\" required>\n                                        <option value=\"\">Select Champion</option>\n                                        <?php foreach ($registeredUsers as $user): ?>\n                                            <option value=\"<?= $user['id'] ?>\"><?= htmlspecialchars($user['full_name']) ?> (@<?= htmlspecialchars($user['username']) ?>) - <?= htmlspecialchars($user['team_name']) ?></option>\n                                        <?php endforeach; ?>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"mb-3\">\n                                    <label for=\"winner_prize\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-coins\"></i> Champion Prize Amount ($)\n                                    </label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"winner_prize\" \n                                           name=\"winner_prize\" step=\"0.01\" min=\"0\" \n                                           value=\"<?= $tournament['winner_prize'] ?: '' ?>\">\n                                </div>\n                            </div>\n                            \n                            <div class=\"col-md-6\">\n                                <div class=\"mb-3\">\n                                    <label for=\"runner_up_id\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-medal text-info\"></i> Runner-up (2nd Place) *\n                                    </label>\n                                    <select class=\"form-select gaming-input\" id=\"runner_up_id\" name=\"runner_up_id\" required>\n                                        <option value=\"\">Select Runner-up</option>\n                                        <?php foreach ($registeredUsers as $user): ?>\n                                            <option value=\"<?= $user['id'] ?>\"><?= htmlspecialchars($user['full_name']) ?> (@<?= htmlspecialchars($user['username']) ?>) - <?= htmlspecialchars($user['team_name']) ?></option>\n                                        <?php endforeach; ?>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"mb-3\">\n                                    <label for=\"runner_up_prize\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-coins\"></i> Runner-up Prize Amount ($)\n                                    </label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"runner_up_prize\" \n                                           name=\"runner_up_prize\" step=\"0.01\" min=\"0\" \n                                           value=\"<?= $tournament['runner_up_prize'] ?: '' ?>\">\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <div class=\"mb-3\">\n                                    <label for=\"third_place_id\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-award text-secondary\"></i> Third Place *\n                                    </label>\n                                    <select class=\"form-select gaming-input\" id=\"third_place_id\" name=\"third_place_id\" required>\n                                        <option value=\"\">Select Third Place</option>\n                                        <?php foreach ($registeredUsers as $user): ?>\n                                            <option value=\"<?= $user['id'] ?>\"><?= htmlspecialchars($user['full_name']) ?> (@<?= htmlspecialchars($user['username']) ?>) - <?= htmlspecialchars($user['team_name']) ?></option>\n                                        <?php endforeach; ?>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            <div class=\"col-md-6\">\n                                <div class=\"mb-3\">\n                                    <label for=\"third_place_prize\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-coins\"></i> Third Place Prize Amount ($)\n                                    </label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"third_place_prize\" \n                                           name=\"third_place_prize\" step=\"0.01\" min=\"0\" \n                                           value=\"<?= $tournament['third_place_prize'] ?: '' ?>\">\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"text-center\">\n                            <button type=\"submit\" class=\"btn btn-accent btn-lg\">\n                                <i class=\"fas fa-trophy\"></i> Publish Results & Distribute Prizes\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                <?php endif; ?>\n            </main>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script>\n        // Prevent selecting the same user for multiple positions\n        document.querySelectorAll('select[name$=\"_id\"]').forEach(select => {\n            select.addEventListener('change', function() {\n                const selectedValues = Array.from(document.querySelectorAll('select[name$=\"_id\"]'))\n                    .map(s => s.value)\n                    .filter(v => v !== '');\n                \n                document.querySelectorAll('select[name$=\"_id\"]').forEach(otherSelect => {\n                    if (otherSelect !== this) {\n                        Array.from(otherSelect.options).forEach(option => {\n                            if (option.value && selectedValues.includes(option.value) && option.value !== otherSelect.value) {\n                                option.disabled = true;\n                            } else {\n                                option.disabled = false;\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    </script>\n</body>\n</html>","size_bytes":20799},"admin/withdrawals.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireAdminLogin();\n\n$action = $_GET['action'] ?? 'list';\n$withdrawalId = $_GET['id'] ?? null;\n$error = '';\n$success = '';\n\n// Handle withdrawal approval/rejection\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        if ($action === 'process' && $withdrawalId) {\n            $status = sanitizeInput($_POST['status'] ?? '');\n            $adminNotes = sanitizeInput($_POST['admin_notes'] ?? '');\n            \n            if (in_array($status, ['approved', 'rejected'])) {\n                try {\n                    $pdo->beginTransaction();\n                    \n                    // Get withdrawal details\n                    $stmt = $pdo->prepare(\"SELECT * FROM withdrawal_requests WHERE id = ?\");\n                    $stmt->execute([$withdrawalId]);\n                    $withdrawal = $stmt->fetch();\n                    \n                    if ($withdrawal && $withdrawal['status'] === 'pending') {\n                        // Update withdrawal status\n                        $stmt = $pdo->prepare(\"\n                            UPDATE withdrawal_requests \n                            SET status = ?, admin_notes = ?, processed_at = CURRENT_TIMESTAMP, processed_by = ?\n                            WHERE id = ?\n                        \");\n                        $stmt->execute([$status, $adminNotes, $_SESSION['admin_id'], $withdrawalId]);\n                        \n                        // If rejected, return money to user's wallet\n                        if ($status === 'rejected') {\n                            $stmt = $pdo->prepare(\"UPDATE users SET wallet_balance = wallet_balance + ? WHERE id = ?\");\n                            $stmt->execute([$withdrawal['amount'], $withdrawal['user_id']]);\n                            \n                            // Create notification for rejection\n                            $stmt = $pdo->prepare(\"\n                                INSERT INTO notifications (user_id, title, message, type) \n                                VALUES (?, ?, ?, ?)\n                            \");\n                            $message = \"Your withdrawal request of $\" . number_format($withdrawal['amount'], 2) . \" has been rejected.\";\n                            if ($adminNotes) {\n                                $message .= \" Reason: \" . $adminNotes;\n                            }\n                            $message .= \" The amount has been returned to your wallet.\";\n                            $stmt->execute([$withdrawal['user_id'], 'Withdrawal Request Rejected', $message, 'warning']);\n                        } else {\n                            // Create notification for approval\n                            $stmt = $pdo->prepare(\"\n                                INSERT INTO notifications (user_id, title, message, type) \n                                VALUES (?, ?, ?, ?)\n                            \");\n                            $message = \"Your withdrawal request of $\" . number_format($withdrawal['amount'], 2) . \" has been approved! You will receive the money via \" . ucfirst($withdrawal['payment_method']) . \" shortly.\";\n                            if ($adminNotes) {\n                                $message .= \" Note: \" . $adminNotes;\n                            }\n                            $stmt->execute([$withdrawal['user_id'], 'Withdrawal Request Approved', $message, 'success']);\n                        }\n                        \n                        $pdo->commit();\n                        $success = 'Withdrawal request ' . $status . ' successfully';\n                        $action = 'list';\n                    } else {\n                        $error = 'Withdrawal request not found or already processed';\n                    }\n                } catch (PDOException $e) {\n                    $pdo->rollback();\n                    $error = 'Database error: ' . $e->getMessage();\n                }\n            } else {\n                $error = 'Invalid status';\n            }\n        }\n    }\n}\n\n// Get withdrawal requests based on action\nif ($action === 'view' && $withdrawalId) {\n    $stmt = $pdo->prepare(\"\n        SELECT wr.*, u.username, u.full_name, u.email, admin.username as processed_by_name\n        FROM withdrawal_requests wr \n        JOIN users u ON wr.user_id = u.id \n        LEFT JOIN users admin ON wr.processed_by = admin.id\n        WHERE wr.id = ?\n    \");\n    $stmt->execute([$withdrawalId]);\n    $withdrawal = $stmt->fetch();\n    \n    if (!$withdrawal) {\n        redirect('withdrawals.php', 'Withdrawal request not found', 'error');\n    }\n} else {\n    // Get all withdrawal requests\n    $status = $_GET['status'] ?? 'all';\n    $whereClause = '';\n    $params = [];\n    \n    if ($status !== 'all') {\n        $whereClause = ' WHERE wr.status = ?';\n        $params[] = $status;\n    }\n    \n    $stmt = $pdo->prepare(\"\n        SELECT wr.*, u.username, u.full_name, u.email \n        FROM withdrawal_requests wr \n        JOIN users u ON wr.user_id = u.id \n        $whereClause\n        ORDER BY wr.requested_at DESC\n    \");\n    $stmt->execute($params);\n    $withdrawals = $stmt->fetchAll();\n    \n    // Get statistics\n    $stmt = $pdo->query(\"\n        SELECT \n            COUNT(*) as total,\n            SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending,\n            SUM(CASE WHEN status = 'approved' THEN 1 ELSE 0 END) as approved,\n            SUM(CASE WHEN status = 'rejected' THEN 1 ELSE 0 END) as rejected,\n            SUM(CASE WHEN status = 'approved' THEN amount ELSE 0 END) as total_approved_amount\n        FROM withdrawal_requests\n    \");\n    $stats = $stmt->fetch();\n}\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Withdrawal Management - Admin Panel</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body class=\"admin-page\">\n    <?php include 'includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include 'includes/sidebar.php'; ?>\n            \n            <main class=\"col-md-9 ms-sm-auto col-lg-10 px-md-4\">\n                <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n                    <h1 class=\"text-accent\">\n                        <i class=\"fas fa-money-bill-wave\"></i> Withdrawal Management\n                    </h1>\n                    <?php if ($action === 'view'): ?>\n                        <a href=\"withdrawals.php\" class=\"btn btn-outline-secondary\">\n                            <i class=\"fas fa-arrow-left\"></i> Back to List\n                        </a>\n                    <?php endif; ?>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($action === 'list'): ?>\n                    <!-- Statistics -->\n                    <div class=\"row mb-4\">\n                        <div class=\"col-md-3\">\n                            <div class=\"gaming-card text-center\">\n                                <h3 class=\"text-accent\"><?= $stats['total'] ?></h3>\n                                <p class=\"mb-0\">Total Requests</p>\n                            </div>\n                        </div>\n                        <div class=\"col-md-3\">\n                            <div class=\"gaming-card text-center\">\n                                <h3 class=\"text-warning\"><?= $stats['pending'] ?></h3>\n                                <p class=\"mb-0\">Pending</p>\n                            </div>\n                        </div>\n                        <div class=\"col-md-3\">\n                            <div class=\"gaming-card text-center\">\n                                <h3 class=\"text-success\"><?= $stats['approved'] ?></h3>\n                                <p class=\"mb-0\">Approved</p>\n                            </div>\n                        </div>\n                        <div class=\"col-md-3\">\n                            <div class=\"gaming-card text-center\">\n                                <h3 class=\"text-accent\">$<?= number_format($stats['total_approved_amount'], 2) ?></h3>\n                                <p class=\"mb-0\">Total Paid</p>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Filter Tabs -->\n                    <div class=\"gaming-card mb-4\">\n                        <ul class=\"nav nav-tabs nav-fill\">\n                            <li class=\"nav-item\">\n                                <a class=\"nav-link <?= $status === 'all' ? 'active' : '' ?>\" href=\"?status=all\">\n                                    All Requests\n                                </a>\n                            </li>\n                            <li class=\"nav-item\">\n                                <a class=\"nav-link <?= $status === 'pending' ? 'active' : '' ?>\" href=\"?status=pending\">\n                                    Pending (<?= $stats['pending'] ?>)\n                                </a>\n                            </li>\n                            <li class=\"nav-item\">\n                                <a class=\"nav-link <?= $status === 'approved' ? 'active' : '' ?>\" href=\"?status=approved\">\n                                    Approved\n                                </a>\n                            </li>\n                            <li class=\"nav-item\">\n                                <a class=\"nav-link <?= $status === 'rejected' ? 'active' : '' ?>\" href=\"?status=rejected\">\n                                    Rejected\n                                </a>\n                            </li>\n                        </ul>\n                    </div>\n                    \n                    <!-- Withdrawal Requests List -->\n                    <div class=\"gaming-card\">\n                        <h4 class=\"text-accent mb-3\">Withdrawal Requests</h4>\n                        \n                        <?php if (empty($withdrawals)): ?>\n                            <div class=\"text-center text-light-50 py-4\">\n                                <i class=\"fas fa-inbox fa-3x mb-3 opacity-50\"></i>\n                                <p>No withdrawal requests found</p>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-dark\">\n                                    <thead>\n                                        <tr>\n                                            <th>User</th>\n                                            <th>Amount</th>\n                                            <th>Method</th>\n                                            <th>Account</th>\n                                            <th>Status</th>\n                                            <th>Date</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($withdrawals as $wr): ?>\n                                            <tr>\n                                                <td>\n                                                    <div>\n                                                        <strong><?= htmlspecialchars($wr['full_name']) ?></strong><br>\n                                                        <small class=\"text-light-50\">@<?= htmlspecialchars($wr['username']) ?></small>\n                                                    </div>\n                                                </td>\n                                                <td class=\"fw-bold\">$<?= number_format($wr['amount'], 2) ?></td>\n                                                <td><?= ucfirst($wr['payment_method']) ?></td>\n                                                <td><?= htmlspecialchars($wr['account_number']) ?></td>\n                                                <td>\n                                                    <span class=\"badge bg-<?= \n                                                        $wr['status'] === 'approved' ? 'success' : \n                                                        ($wr['status'] === 'rejected' ? 'danger' : 'warning') \n                                                    ?>\">\n                                                        <?= ucfirst($wr['status']) ?>\n                                                    </span>\n                                                </td>\n                                                <td><?= formatDate($wr['requested_at'], 'M d, Y H:i') ?></td>\n                                                <td>\n                                                    <a href=\"?action=view&id=<?= $wr['id'] ?>\" class=\"btn btn-sm btn-outline-info\">\n                                                        <i class=\"fas fa-eye\"></i> View\n                                                    </a>\n                                                </td>\n                                            </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                \n                <?php elseif ($action === 'view'): ?>\n                    <!-- View Withdrawal Details -->\n                    <div class=\"row\">\n                        <div class=\"col-lg-6\">\n                            <div class=\"gaming-card\">\n                                <h4 class=\"text-accent mb-3\">\n                                    <i class=\"fas fa-receipt\"></i> Withdrawal Details\n                                </h4>\n                                \n                                <div class=\"mb-3\">\n                                    <strong>Request ID:</strong> #<?= $withdrawal['id'] ?>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <strong>Amount:</strong> \n                                    <span class=\"text-accent fs-5\">$<?= number_format($withdrawal['amount'], 2) ?></span>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <strong>Payment Method:</strong> <?= ucfirst($withdrawal['payment_method']) ?>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <strong>Account Number:</strong> <?= htmlspecialchars($withdrawal['account_number']) ?>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <strong>Status:</strong> \n                                    <span class=\"badge bg-<?= \n                                        $withdrawal['status'] === 'approved' ? 'success' : \n                                        ($withdrawal['status'] === 'rejected' ? 'danger' : 'warning') \n                                    ?>\">\n                                        <?= ucfirst($withdrawal['status']) ?>\n                                    </span>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <strong>Requested At:</strong> <?= formatDate($withdrawal['requested_at'], 'M d, Y H:i') ?>\n                                </div>\n                                <?php if ($withdrawal['processed_at']): ?>\n                                    <div class=\"mb-3\">\n                                        <strong>Processed At:</strong> <?= formatDate($withdrawal['processed_at'], 'M d, Y H:i') ?>\n                                    </div>\n                                    <div class=\"mb-3\">\n                                        <strong>Processed By:</strong> <?= htmlspecialchars($withdrawal['processed_by_name']) ?>\n                                    </div>\n                                <?php endif; ?>\n                                <?php if ($withdrawal['admin_notes']): ?>\n                                    <div class=\"mb-3\">\n                                        <strong>Admin Notes:</strong><br>\n                                        <div class=\"alert alert-info mt-2\">\n                                            <?= nl2br(htmlspecialchars($withdrawal['admin_notes'])) ?>\n                                        </div>\n                                    </div>\n                                <?php endif; ?>\n                            </div>\n                        </div>\n                        \n                        <div class=\"col-lg-6\">\n                            <div class=\"gaming-card\">\n                                <h4 class=\"text-accent mb-3\">\n                                    <i class=\"fas fa-user\"></i> User Information\n                                </h4>\n                                \n                                <div class=\"mb-3\">\n                                    <strong>Name:</strong> <?= htmlspecialchars($withdrawal['full_name']) ?>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <strong>Username:</strong> @<?= htmlspecialchars($withdrawal['username']) ?>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <strong>Email:</strong> <?= htmlspecialchars($withdrawal['email']) ?>\n                                </div>\n                                \n                                <?php if ($withdrawal['status'] === 'pending'): ?>\n                                    <hr>\n                                    <h5 class=\"text-accent mb-3\">Process Request</h5>\n                                    \n                                    <form method=\"POST\" action=\"?action=process&id=<?= $withdrawal['id'] ?>\">\n                                        <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                                        \n                                        <div class=\"mb-3\">\n                                            <label for=\"status\" class=\"form-label text-light\">Decision *</label>\n                                            <select class=\"form-select gaming-input\" id=\"status\" name=\"status\" required>\n                                                <option value=\"\">Select Decision</option>\n                                                <option value=\"approved\">Approve</option>\n                                                <option value=\"rejected\">Reject</option>\n                                            </select>\n                                        </div>\n                                        \n                                        <div class=\"mb-3\">\n                                            <label for=\"admin_notes\" class=\"form-label text-light\">Notes (Optional)</label>\n                                            <textarea class=\"form-control gaming-input\" id=\"admin_notes\" name=\"admin_notes\" \n                                                      rows=\"3\" placeholder=\"Add any notes for the user...\"></textarea>\n                                        </div>\n                                        \n                                        <div class=\"d-grid gap-2\">\n                                            <button type=\"submit\" class=\"btn btn-accent\">\n                                                <i class=\"fas fa-check\"></i> Process Request\n                                            </button>\n                                        </div>\n                                    </form>\n                                <?php endif; ?>\n                            </div>\n                        </div>\n                    </div>\n                <?php endif; ?>\n            </main>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>","size_bytes":21227},"user/withdraw.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequireLogin();\n\n$error = '';\n$success = '';\n\n// Get user's current wallet balance\n$stmt = $pdo->prepare(\"SELECT wallet_balance FROM users WHERE id = ?\");\n$stmt->execute([$_SESSION['user_id']]);\n$user = $stmt->fetch();\n$walletBalance = $user['wallet_balance'] ?? 0;\n\n// Handle withdrawal request\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {\n        $error = 'Invalid security token';\n    } else {\n        $amount = (float)($_POST['amount'] ?? 0);\n        $paymentMethod = sanitizeInput($_POST['payment_method'] ?? '');\n        $accountNumber = sanitizeInput($_POST['account_number'] ?? '');\n        \n        // Validation\n        if ($amount <= 0) {\n            $error = 'Please enter a valid amount';\n        } elseif ($amount > $walletBalance) {\n            $error = 'Insufficient balance. Your current balance is $' . number_format($walletBalance, 2);\n        } elseif ($amount < 10) {\n            $error = 'Minimum withdrawal amount is $10.00';\n        } elseif (empty($paymentMethod)) {\n            $error = 'Please select a payment method';\n        } elseif (empty($accountNumber)) {\n            $error = 'Please enter your account number';\n        } else {\n            try {\n                $pdo->beginTransaction();\n                \n                // Deduct amount from user's wallet\n                $stmt = $pdo->prepare(\"UPDATE users SET wallet_balance = wallet_balance - ? WHERE id = ?\");\n                $stmt->execute([$amount, $_SESSION['user_id']]);\n                \n                // Create withdrawal request\n                $stmt = $pdo->prepare(\"\n                    INSERT INTO withdrawal_requests (user_id, amount, payment_method, account_number, status) \n                    VALUES (?, ?, ?, ?, 'pending')\n                \");\n                $stmt->execute([$_SESSION['user_id'], $amount, $paymentMethod, $accountNumber]);\n                \n                $pdo->commit();\n                $success = 'Withdrawal request submitted successfully! Amount has been deducted from your wallet. You will receive the money once admin approves your request.';\n                \n                // Update wallet balance\n                $walletBalance -= $amount;\n                \n            } catch (PDOException $e) {\n                $pdo->rollback();\n                $error = 'Database error: ' . $e->getMessage();\n            }\n        }\n    }\n}\n\n// Get user's withdrawal history\n$stmt = $pdo->prepare(\"\n    SELECT wr.*, u.username as processed_by_username \n    FROM withdrawal_requests wr \n    LEFT JOIN users u ON wr.processed_by = u.id \n    WHERE wr.user_id = ? \n    ORDER BY wr.requested_at DESC\n\");\n$stmt->execute([$_SESSION['user_id']]);\n$withdrawalHistory = $stmt->fetchAll();\n\n$flash = getFlashMessage();\nif ($flash) {\n    if ($flash['type'] === 'success') $success = $flash['message'];\n    else $error = $flash['message'];\n}\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Withdraw Money - eSports Tournament</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"../assets/css/style.css\">\n</head>\n<body class=\"dashboard-page\">\n    <?php include '../includes/navbar.php'; ?>\n    \n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <?php include '../includes/sidebar.php'; ?>\n            \n            <main class=\"col-md-9 ms-sm-auto col-lg-10 px-md-4\">\n                <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n                    <h1 class=\"text-accent\">\n                        <i class=\"fas fa-money-bill-wave\"></i> Withdraw Money\n                    </h1>\n                    <a href=\"dashboard.php\" class=\"btn btn-outline-secondary\">\n                        <i class=\"fas fa-arrow-left\"></i> Back to Dashboard\n                    </a>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"alert alert-danger\">\n                        <i class=\"fas fa-exclamation-triangle\"></i> <?= htmlspecialchars($error) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"alert alert-success\">\n                        <i class=\"fas fa-check-circle\"></i> <?= htmlspecialchars($success) ?>\n                    </div>\n                <?php endif; ?>\n                \n                <div class=\"row\">\n                    <div class=\"col-lg-6\">\n                        <div class=\"gaming-card\">\n                            <h4 class=\"text-accent mb-3\">\n                                <i class=\"fas fa-wallet\"></i> Current Balance\n                            </h4>\n                            <div class=\"text-center mb-4\">\n                                <h2 class=\"text-success\">$<?= number_format($walletBalance, 2) ?></h2>\n                                <p class=\"text-light-50\">Available for withdrawal</p>\n                            </div>\n                            \n                            <h5 class=\"text-accent mb-3\">Request Withdrawal</h5>\n                            \n                            <form method=\"POST\">\n                                <input type=\"hidden\" name=\"csrf_token\" value=\"<?= generateCSRFToken() ?>\">\n                                \n                                <div class=\"mb-3\">\n                                    <label for=\"amount\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-dollar-sign\"></i> Amount ($) *\n                                    </label>\n                                    <input type=\"number\" class=\"form-control gaming-input\" id=\"amount\" \n                                           name=\"amount\" step=\"0.01\" min=\"10\" max=\"<?= $walletBalance ?>\" required>\n                                    <small class=\"text-light-50\">Minimum: $10.00 | Maximum: $<?= number_format($walletBalance, 2) ?></small>\n                                </div>\n                                \n                                <div class=\"mb-3\">\n                                    <label for=\"payment_method\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-credit-card\"></i> Payment Method *\n                                    </label>\n                                    <select class=\"form-select gaming-input\" id=\"payment_method\" name=\"payment_method\" required>\n                                        <option value=\"\">Select Payment Method</option>\n                                        <option value=\"bkash\">bKash</option>\n                                        <option value=\"nagad\">Nagad</option>\n                                        <option value=\"rocket\">Rocket</option>\n                                        <option value=\"bank\">Bank Transfer</option>\n                                    </select>\n                                </div>\n                                \n                                <div class=\"mb-4\">\n                                    <label for=\"account_number\" class=\"form-label text-light\">\n                                        <i class=\"fas fa-hashtag\"></i> Account Number *\n                                    </label>\n                                    <input type=\"text\" class=\"form-control gaming-input\" id=\"account_number\" \n                                           name=\"account_number\" required placeholder=\"Enter your account number\">\n                                    <small class=\"text-light-50\">Enter your mobile number for mobile banking or account number for bank transfer</small>\n                                </div>\n                                \n                                <div class=\"alert alert-info\">\n                                    <i class=\"fas fa-info-circle\"></i>\n                                    <strong>Important:</strong> The withdrawal amount will be immediately deducted from your wallet. You will receive the money once admin approves your request.\n                                </div>\n                                \n                                <button type=\"submit\" class=\"btn btn-accent w-100\" <?= $walletBalance < 10 ? 'disabled' : '' ?>>\n                                    <i class=\"fas fa-paper-plane\"></i> Submit Withdrawal Request\n                                </button>\n                                \n                                <?php if ($walletBalance < 10): ?>\n                                    <div class=\"text-center mt-2\">\n                                        <small class=\"text-warning\">Minimum balance of $10.00 required for withdrawal</small>\n                                    </div>\n                                <?php endif; ?>\n                            </form>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-lg-6\">\n                        <div class=\"gaming-card\">\n                            <h4 class=\"text-accent mb-3\">\n                                <i class=\"fas fa-history\"></i> Withdrawal History\n                            </h4>\n                            \n                            <?php if (empty($withdrawalHistory)): ?>\n                                <div class=\"text-center text-light-50 py-4\">\n                                    <i class=\"fas fa-inbox fa-3x mb-3 opacity-50\"></i>\n                                    <p>No withdrawal requests yet</p>\n                                </div>\n                            <?php else: ?>\n                                <div class=\"table-responsive\">\n                                    <table class=\"table table-dark\">\n                                        <thead>\n                                            <tr>\n                                                <th>Amount</th>\n                                                <th>Method</th>\n                                                <th>Status</th>\n                                                <th>Date</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            <?php foreach ($withdrawalHistory as $withdrawal): ?>\n                                                <tr>\n                                                    <td>$<?= number_format($withdrawal['amount'], 2) ?></td>\n                                                    <td><?= ucfirst($withdrawal['payment_method']) ?></td>\n                                                    <td>\n                                                        <span class=\"badge bg-<?= \n                                                            $withdrawal['status'] === 'approved' ? 'success' : \n                                                            ($withdrawal['status'] === 'rejected' ? 'danger' : 'warning') \n                                                        ?>\">\n                                                            <?= ucfirst($withdrawal['status']) ?>\n                                                        </span>\n                                                    </td>\n                                                    <td><?= formatDate($withdrawal['requested_at'], 'M d, Y') ?></td>\n                                                </tr>\n                                                <?php if ($withdrawal['admin_notes']): ?>\n                                                    <tr>\n                                                        <td colspan=\"4\">\n                                                            <small class=\"text-light-50\">\n                                                                <i class=\"fas fa-comment\"></i> <?= htmlspecialchars($withdrawal['admin_notes']) ?>\n                                                            </small>\n                                                        </td>\n                                                    </tr>\n                                                <?php endif; ?>\n                                            <?php endforeach; ?>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            <?php endif; ?>\n                        </div>\n                    </div>\n                </div>\n            </main>\n        </div>\n    </div>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script>\n        // Update account number placeholder based on payment method\n        document.getElementById('payment_method').addEventListener('change', function() {\n            const accountInput = document.getElementById('account_number');\n            const method = this.value;\n            \n            switch(method) {\n                case 'bkash':\n                case 'nagad':\n                case 'rocket':\n                    accountInput.placeholder = 'Enter your mobile number (e.g., 01712345678)';\n                    break;\n                case 'bank':\n                    accountInput.placeholder = 'Enter your bank account number';\n                    break;\n                default:\n                    accountInput.placeholder = 'Enter your account number';\n            }\n        });\n    </script>\n</body>\n</html>","size_bytes":13866}}}